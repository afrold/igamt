<div ng-controller="DatatypeListCtrl" ng-init="init()">


<div ng-show="loading" style="text-align:center">
    <img class="ajax-loading" ng-src="images/ajax.gif" alt="loading..."/>
</div>

<div ng-show="!loading">
    <div class="row">
        <div class="page-header">
            <h3>Datatypes List</h3>
        </div>
        <div class="igl-table">
            <table st-table="datatypes" st-safe-src="datatypes"
                   class="table table-striped table-bordered">
                <thead>
                <tr class="tbl-header">
                    <th></th>
                    <th st-sort="label">Label</th>
                    <th st-sort="name">Name</th>
                    <th st-sort="description">Description</th>
                    <!--<th></th>-->
                </tr>
                <!--<tr>-->
                    <!--<th colspan="4">-->
                        <!--<input st-search placeholder="Search" class="input-sm form-control" type="search"/>-->
                    <!--</th>-->
                <!--</tr>-->
                </thead>
                <tbody>
                <tr st-select-row="row" st-select-mode="single" ng-repeat="row in tmpDatatypes">
                    <td cs-select="row"><input ng-click="select(row)"
                                               ng-checked="datatype != null && row.id == datatype.id"
                                               type="radio"></td>
                    <td ng-bind="row.label"></td>
                    <td ng-bind-html="row.name"></td>
                    <td ng-bind-html="row.description"></td>
                    <!--<td>-->
                    <!--<button title="Clone" ng-disabled="datatype != null" type="button" class="btn btn-xs btn-default"-->
                    <!--ng-click="clone(row)">-->
                    <!--<span><i class="fa fa-files-o fa-fw"></i>&nbsp; Clone</span>-->
                    <!--</button>-->
                    <!--<button ng-disabled="datatype != null" ng-show="isFlavor(row.label)" title="Edit" type="button"-->
                    <!--class="btn btn-xs btn-primary"-->
                    <!--ng-click="edit(row)">-->
                    <!--<span><i class="fa fa-pencil fa-fw"></i>&nbsp; Edit</span>-->
                    <!--</button>-->
                    <!--<button ng-disabled="datatype != null" title="Delete" type="button" class="btn btn-xs btn-danger"-->
                    <!--ng-click="delete(row)">-->
                    <!--<span><i class="fa fa-trash-o fa-fw">&nbsp; </i>Delete</span>-->
                    <!--</button>-->
                    <!--</td>-->
                </tr>
                </tbody>
                <!--<tfoot>-->
                <!--<tr>-->
                    <!--<td colspan="4" class="text-center">-->
                        <!--<div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="7"></div>-->
                    <!--</td>-->
                <!--</tr>-->
                <!--</tfoot>-->
            </table>
        </div>
    </div>

    <div ng-show="error !== null">
        <div class="alert alert-danger" role="alert" ng-bind="error"></div>
        <br/>
    </div>

    <div ng-show="loadingSelection" style="text-align:center">
        <i class="fa fa-spinner fa-spin"></i>
    </div>
    <div ng-show="!loadingSelection" style="padding-top:40px">
        <div ng-show="datatype !== null">
            <div class="row">
                <div>
                    <span class="igl-title">Edit Datatype : {{datatype.label}}</span>
                        <span class="pull-right">

                        <button title="Clone" type="button" class="btn btn-xs btn-info"
                                ng-click="clone()">
                            <span><i class="fa fa-plus-circle fa-fw"></i>&nbsp; Clone</span>
                        </button>

                        <button title="Close" type="button" class="btn btn-xs btn-primary"
                                ng-click="close()">
                            <span><i class="fa fa-times fa-fw"></i>&nbsp; Close</span>
                        </button>

                        <!--<button title="Reset" type="button" class="btn btn-xs btn-warning"-->
                                <!--ng-click="reset()" ng-disabled="true">-->
                            <!--<span><i class="fa fa-times fa-fw">&nbsp; </i>Reset</span>-->
                        <!--</button>-->

                        <button title="Delete" type="button"
                                class="btn btn-xs btn-danger"
                                ng-click="delete()">
                            <span><i class="fa fa-trash-o fa-fw">&nbsp; </i>Delete</span>
                        </button>
                        </span>
                    <hr/>
                    <!--<button title="Save" type="button" class="btn btn-xs btn-success"-->
                    <!--ng-click="save()">-->
                    <!--<span><i class="fa fa-check-circle fa-fw">&nbsp; </i>Save</span>-->
                    <!--</button>-->



                </div>

                <form style="margin-top: 20px" class="form-horizontal" name="editDatatypeForm">
                    <!--<div>-->
                    <!--<label for="datatypeLabel">Name:</label>-->
                    <!--<input type="text" ng-model="datatype.label" ng-disabled="isFlavor(datatype.label)"-->
                    <!--ng-focus="isFlavor(datatype.label)" class="form-control" id="datatypeLabel">-->
                    <!--</div>-->
                    <div style="margin-top: 20px">
                        <div class="table-responsive">
                            <table tt-table tt-params="params" class="table table-striped table-bordered">
                                <thead>
                                <tr class="tbl-header row">
                                    <th class="col-md-4">Name</th>
                                    <th class="col-md-1">Usage</th>
                                    <th class="col-md-1">Length</th>
                                    <th class="col-md-1">ConfLength</th>
                                    <th class="col-md-1">Datatype</th>
                                    <th class="col-md-1">ValueSet</th>
                                    <th class="col-md-1">Predicate</th>
                                    <th class="col-md-1">Conformance Statement</th>
                                    <th class="col-md-1">Comment</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                            <script type="text/ng-template" id="DatatypeEditTree.html">
                                <tr tt-node is-branch="hasChildren(node)" class="row">
                                    <td class="col-md-4">
                                        <span ng-show="node.type === 'datatype'" ng-controller="DatatypeRowCtrl">
                                            <span ng-form name="{{formName}}">
                                            <input style="width:60%" type="text"
                                                   name="label"
                                                   ng-class="{ 'has-error' : {{formName}}.label.$invalid}"
                                                   class="igl-input"
                                                   ng-change="recordChange(node,'label')"
                                                   ng-model="node.label" required>
                                            </span>
                                            <span ng-bind="node.description"></span>
                                         </span>
                                        <span ng-show="node.type !== 'datatype'">
                                            <img style="width:15px; height:15px"
                                                 ng-src="images/{{node.type}}.png">
                                            <span ng-show="node.type !== 'datatype'">{{node.position}}:{{node.name}}</span>
                                        </span>
                                    </td>
                                    <td class="col-md-1">
                                        <div ng-show="node.type !== 'datatype'">
                                            <span ng-show="!node.predicates || node.predicates == null || node.predicates.length == 0">
                                                <select class="form-control input-sm"
                                                        name="usage"
                                                        ng-change="recordChange(node,'usage')"
                                                        required
                                                        ng-model="node.usage"
                                                        ng-options="usage for usage in usages">
                                                </select>
                                            </span>
                                            <span ng-show="node.predicates != null && node.predicates.length > 0">C({{node.predicates[0].trueUsage}}, {{node.predicates[0].falseUsage}})</span>
                                        </div>
                                        <div ng-show="node.type === 'datatype'">-</div>
                                    </td>
                                    <td class="col-md-1">
                                        <div ng-show="node.type !== 'datatype'" ng-controller="DatatypeRowCtrl">
                                            <span ng-form name="{{formName}}">
                                                <input style="width:45%" class="igl-input"
                                                       name="minLength"
                                                       ng-change="recordChange(node,'minLength')"
                                                       ng-pattern="/^\d+$/"
                                                       ng-class="{ 'has-error' : {{formName}}.minLength.$invalid}"
                                                       ng-model="node.minLength" required ng-minlength="1">
                                                <input style="width:45%" class="igl-input" type="text"
                                                       name="maxLength"
                                                       ng-change="recordChange(node,'maxLength')"
                                                       ng-class="{ 'has-error' : {{formName}}.maxLength.$invalid}"
                                                       ng-pattern="/^\d+$|^\*?$/"
                                                       ng-model="node.maxLength" required>
                                            </span>
                                        </div>
                                        <div ng-show="node.type === 'datatype'">-</div>
                                    </td>
                                    <td class="col-md-1">
                                        <div ng-show="node.type !== 'datatype'" ng-controller="DatatypeRowCtrl">
                                            <span  ng-form name="{{formName}}">
                                            <input style="width:50%" class="igl-input" type="text"
                                                   name="confLength"
                                                   ng-change="recordChange(node,'confLength')"
                                                   ng-class="{ 'has-error' : {{formName}}.confLength.$invalid}"
                                                   ng-pattern="/^\d+$/"
                                                   ng-model="node.confLength">
                                            </span>
                                        </div>
                                        <div ng-show="node.type === 'datatype'">-</div>
                                    </td>

                                    <td class="col-md-1">
                                        <div ng-show="node.type !== 'datatype'">
                                            <select class="form-control input-sm"
                                                    name="datatype"
                                                    ng-change="onDatatypeChange(node)"
                                                    required
                                                    ng-model="node.datatype"
                                                    ng-options="dt as dt.label for dt in datatypes | flavors:node.datatype.name">
                                            </select>
                                            <!--<a class="point"-->
                                               <!--ng-click="goToDatatype(node.datatype)"-->
                                               <!--ng-bind="node.datatype.label"></a>-->
                                        </div>
                                        <div ng-show="node.type === 'datatype'">-</div>
                                    </td>

                                    <td class="col-md-1">
										<div ng-show="node.type !== 'datatype'">
											<span ng-show="node.table != undefined">
												<div class="btn-group" dropdown>
													<button type="button" ng-click="goToTable(node.table)" class="btn btn-info btn-xs">{{node.table.mappingId}}</button>
      												<button type="button" class="btn btn-info btn-xs dropdown-toggle" dropdown-toggle>
        												<span class="caret"></span>
        												<span class="sr-only">Split button!</span>
      												</button>
      												<ul class="dropdown-menu" role="menu">
        												<li><a ng-click="mapTable(node)">Change Table</a></li>
        												<li><a ng-click="deleteTable(node)">Release Table</a></li>
        												<li class="divider"></li>
        												<li><a ng-click="goToTable(node.table)">Details</a></li>
      												</ul>
    											</div>
                                            </span>
											<span ng-show="node.table == undefined"> 
												<button ng-click="mapTable(node)" class="btn btn-xs btn-info">
													<span><i class="fa fa-plus fa-fw"></i></span>
												</button> 
                                            </span>
                                    	</div>
                                    	<div ng-show="node.type === 'datatype'">-</div>
                                    </td>
                                    <td class="col-md-1"></td>
                                    <td class="col-md-1"></td>
                                    <td class="col-md-1">
                                        <div ng-show="node.type !== 'datatype'">
                                        <input style="width:100%" class="igl-input" type="text"
                                               name="comment"
                                               ng-change="recordChange(node,'comment')"
                                               ng-model="node.comment">
                                        </div>
                                        <div ng-show="node.type === 'datatype'">-</div>
                                    </td>
                                </tr>
                            </script>

                        </div>
                    </div>

                </form>


            </div>
        </div>
    </div>
    
    <modal title="Select Table" visible="showTableMapModal">
		<div class="row">
		<form role="form">
			<div class="col-sm-6">
				<h5>List of Tables</h5>
				<div class="igl-table">
					<table st-table="displayedTableCollection" st-safe-src="tables" class="table table-striped table-bordered">
						<thead>
							<tr class="tbl-header">
								<th st-sort="mappingId">ID</th>
								<th st-sort="Name">Name</th>
							</tr>
							<tr>
                    			<th colspan="2">
                    				<input st-search="" class="form-control" placeholder="search table..." type="text"/>
                    			</th>
                			</tr>
						</thead>

						<tbody>
							<tr ng-repeat="row in displayedTableCollection">
								<td>
									<a ng-click="selectTable(row)">{{row.mappingId}}</a>
								</td>
								<td ng-bind-html="row.name"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
	 		<div class="col-sm-6">
	 			<span ng-show="selectedTable != undefined">
	 				<button type="button" ng-click="mappingTable()" class="btn btn-warning">Select this Table</button>
	 				<hr />
	 				<div class="row">
  						<div class="col-sm-4">
  							<p>ID:</p>
  							<p>Name:</p>
  							<p>Type:</p>
  							<p>Stability:</p>
  							<p>Extensibility:</p>
  							<p>List of Codes:</p>
  						</div>
  						<div class="col-sm-8">
  							<p>{{selectedTable.mappingId}}</p>
  							<p>{{selectedTable.name}}</p>
  							<p>{{selectedTable.tableType}}</p>
  							<p>{{selectedTable.stability}}</p>
  							<p>{{selectedTable.extensibility}}</p>
  						</div>
					</div>
					<div class="igl-table">
						<table st-table="displayedCodeCollection" st-safe-src="selectedTable.codes" class="table table-striped table-bordered">
							<thead>
								<tr class="tbl-header">
									<th st-sort="Code">Code</th>
									<th st-sort="Label">Label</th>
									<th>Codesys</th>
									<th>Usage</th>
								</tr>
								<tr>
                    				<th colspan="2">
                    					<input st-search="" class="form-control" placeholder="search code..." type="text"/>
                    				</th>
                				</tr>
							</thead>

						<tbody>
							<tr ng-repeat="row in displayedCodeCollection">
								<td ng-bind-html="row.code"></td>
								<td ng-bind-html="row.label"></td>
								<td ng-bind-html="row.codesys"></td>
								<td ng-bind-html="row.codeUsage"></td>
							</tr>
						</tbody>
					</table>
				</div>
					
	 			</span>
	 		</div>
		</form>
		</div>
	</modal>
    
</div>
</div>

<pre>
                        {{changes | json}}
                </pre>