<style id="antiClickjack">
    body {
        display: none !important;
    }
</style>
<script type="text/javascript">
    if (self === top) {
        var antiClickjack = document.getElementById("antiClickjack");
        antiClickjack.parentNode.removeChild(antiClickjack);
    } else {
        top.location = self.location;
    }
</script>
<script type="text/ng-template" id="EditDatatypes.html">
    <div ng-controller="DatatypeListCtrl" ng-init="init()" class="container" ng-cloak>
        <div ng-show="loadingSelection" style="text-align: center;">
            <div layout="row" layout-sm="column" layout-align="space-around">
                <md-progress-circular class="md-hue-2" md-diameter="40px"></md-progress-circular>
            </div>
        </div>
        <div ng-show="!loadingSelection">
            <!--<div ng-if="versionAndUseMap[datatype.id].deprecated" uib-alert ng-repeat="alert in alerts" ng-class="'alert-' + (alert.type || 'warning')" close="closeAlert($index)">{{alert.msg}}</div>-->
            <!--<div ng-if="versionAndUseMap[datatype.id].deprecated" class="alert alert-warning">New version of this-->
                <!--datatype is available-->
            <!--</div>-->
            <div ng-show="datatype !== null" id="executionPanel">
                <div class="container">
                    <div class="page-header" style="margin-bottom: 20px">
                        <span class="header4">Data Type: {{getDatatypeLabel(datatype)}}
                        <span class="pull-right" ng-if="!typeOfSharing">
                            <div class="btn-group" ng-hide="viewSettings.tableReadonly || datatype.scope !== 'USER'||datatype.status=='UNPUBLISHED'"
                                 style="margin-bottom: 0px;" ng-if="!igdocument">
                              <md-button   type="button" class="btn btn-raised btn-primary btn-sm" ng-class=""
                                      ng-click="shareModal(datatype)">
                                <i class="fa fa-share-alt" aria-hidden="true"></i> Share
                                <span class="badge" ng-bind="datatype.shareParticipantIds.length"
                                      style="margin-right:5px;"></span>
                              </md-button>
                    </div>



                    <md-button title="Save Changes" type="button" class="btn btn-raised btn-sm btn-success"
                            ng-disabled="editForm.$invalid||!editForm.$dirty||datatype.status === 'PUBLISHED'"
                            ng-hide="viewSettings.tableReadonly||datatype.status==='PUBLISHED'"
                            ng-click="saveDatatype()">
                              <span><i class="fa fa-check fa-fw"></i> Save</span>
                    </md-button>
                    <!--<md-button title="Save Changes" type="button" class="btn btn-raised btn-sm btn-success"-->
                            <!--ng-disabled="!editForm.$dirty"-->
                            <!--ng-show="datatype.status==='PUBLISHED'&& editForm.$dirty"-->
                            <!--ng-click="saveBindingForDatatype()">-->
                              <!--<span><i class="fa fa-check fa-fw"></i> Save</span>-->
                    <!--</md-button>-->
                    <!--<md-button title="Reset Changes" type="button" class="btn btn-raised btn-sm btn-warning"-->
                            <!--ng-show="datatype.status==='PUBLISHED'"-->
                            <!--ng-disabled="!editForm.$dirty || datatype.status === 'PUBLISHED'" ng-click="reset()">-->
                                  <!--<span><i class="fa fa-times fa-fw"></i> Reset</span>-->
                    <!--</md-button>-->
                    <md-button title="Reset Changes" type="button" class="btn btn-raised btn-sm btn-warning"
                            ng-hide="viewSettings.tableReadonly || datatype.status==='PUBLISHED'"
                            ng-disabled="!editForm.$dirty || datatype.status === 'PUBLISHED'" ng-click="reset()">
                                  <span><i class="fa fa-times fa-fw"></i> Reset</span>
                    </md-button>
                    <md-button title="commit" type="button" class="btn btn-raised btn-sm btn-info"
                            ng-click="publishDatatype(datatype)" ng-if="datatype.status !== 'PUBLISHED'&&!igdocument">
                              <i class="fa fa-check" aria-hidden="true"></i>
                              <span> Publish </span>
                    </md-button>
                    </span>
                        </span>
                    </div>

                    <div class="static_info">
                        <!--<display-label of="datatype" desc="true"></display-label>-->
                        <!--<display-label of="datatype" desc="false"></display-label>-->
                      <span  ng-if="datatype.scope!=='HL7STANDARD'">
                      <i  class="fa fa-calendar" aria-hidden="true"></i>
                        Updated :{{datatype.dateUpdated | date:dateFormat}}
                      </span>
                        <span ng-if="datatype.owner" style="font-style: italic;">
                     <span > Author : <img style="max-width:30px !important;border-radius: 50%" src="{{generateHash(datatype.owner.email)}}"/> {{datatype.owner.fullname}}</span>
                     </span>
                        <span ng-if="datatype.hl7Version!=='*'"> HL7 Version: {{datatype.hl7Version}}</span>
                        <span ng-if="datatype.publicationVersion"> Version: {{datatype.publicationVersion}}</span>

                    </div>
                    <div class="" ng-controller="cmpDatatypeCtrl as cmp">
                        <md-tabs md-dynamic-height md-border-bottom md-selected="tabStatus.active">
                            <md-tab md-on-select="setDeltaToF(0)">
                                <md-tab-label>
                                    <i class="fa fa-info-circle fa-fw" aria-hidden="true"></i>MetaData
                                </md-tab-label>
                                <md-tab-body>

                                    <div style="margin-top: 20px" ng-cloak class="md-inline-form" layout="column">
                                        <md-content layout-padding>

                                            <label class="input-left igamt-label">Name*</label>

                                            <md-input-container class="md-block igamt-input-block" flex-gt-sm>
                                                <input type="text" disabled name="name" ng-model="datatype.name"
                                                       required>
                                                <div ng-messages="editForm.name.$error">
                                                    <div ng-message="required">Name is required.</div>
                                                </div>
                                            </md-input-container>

                                            <label class="input-left igamt-label">Description*</label>

                                            <md-input-container class="md-block igamt-input-block" flex-gt-sm>
                                                <input type="text" disabled ng-change="setDirty()" name="description"
                                                       ng-model="datatype.description" required>
                                                <div ng-messages="editForm.description.$error">
                                                    <div ng-message="required">description is required.</div>
                                                </div>
                                            </md-input-container>

                                            <label class="input-left igamt-label" ng-hide="datatype.status==='PUBLISHED'">Extension*</label>
                                            <md-input-container class="md-block igamt-input-block" flex-gt-sm
                                                                ng-hide="datatype.status==='PUBLISHED'">
                                                <input type="text" ng-change="updateLabel(datatype);recordChanged()"
                                                       ng-disabled="viewSettings.tableReadonly || datatype.status==='PUBLISHED'||versionAndUseMap[datatype.id]"
                                                       name="ext" id="ext" ng-model="datatype.ext" required>
                                                <div role="alert" style="color:red" ng-if="isDuplicated(datatype,datatypes)">
                                                    <div class="my-message">Extension is already used.</div>
                                                </div>
                                                <div ng-messages="editForm.ext.$error">
                                                    <div ng-message="required">Extension is required.</div>
                                                 </div>

                                            </md-input-container>


                                            <label class="input-left igamt-label" ng-if="datatype.scope==='MASTER'">Compatibility Versions*</label>
                                            <md-input-container class="md-block igamt-input-block" flex-gt-sm
                                                                ng-if="datatype.scope==='MASTER'">
                                                <input type="text" disabled name="hl7versions" id="hl7Versions"
                                                       ng-model="datatype.hl7versions" required>

                                                <div ng-messages="editForm.hl7Version.$error">
                                                    <div ng-message="required">Compatibility version is required.</div>
                                                </div>

                                            </md-input-container>

                                            <label ng-if="versionAndUseMap[datatype.id].publicationDate" class="input-left igamt-label">Publication Date*</label>

                                            <md-input-container class="md-block igamt-input-block"  flex-gt-sm  ng-if="versionAndUseMap[datatype.id].publicationDate">
                                                    <input type="text" disabled ng-change="setDirty()"
                                                           name="publicationDate"
                                                           id="publicationDate"
                                                           ng-model="versionAndUseMap[datatype.id].publicationDate"
                                                           required>
                                                    <div ng-messages="editForm.publicationDate.$error">
                                                        <div ng-message="required">Publication Date is required.</div>
                                                    </div>
                                                </md-input-container>

                                            <label class="input-left igamt-label">Purpose and Use</label>

                                            <md-input-container class="md-block igamt-input-block" flex-gt-sm >
                                                    <textarea rows="3"  md-select-on-focus
                                                              ng-disabled="viewSettings.tableReadonly || datatype.status==='PUBLISHED'"
                                                              ng-change="setDirty()" name="purposeUse" id="purposeUse"
                                                              ng-model="datatype.purposeAndUse"
                                                    />
                                                </md-input-container>

                                            <label class="input-left igamt-label">Usage Note</label>

                                            <md-input-container flex-gt-sm class="md-block igamt-input-block">
                                                    <div  ng-show="!viewSettings.tableReadonly && datatype.status!=='PUBLISHED'">
                                                         <textarea style="margin-top:20px" froala="froalaEditorOptions" md-select-on-focus
                                                                  ng-model="datatype.usageNote" name="usageNote"
                                                                  id="usageNote" ng-change="setDirty()"></textarea>
                                                      </div>
                                                         <div class="fr-view" ng-show="viewSettings.tableReadonly || datatype.status==='PUBLISHED'">
                                                            <div froala-view="datatype.usageNote"></div>
                                                     </div>
                                            </md-input-container>

                                            <label class="input-left igamt-label" ng-show="!viewSettings.tableReadonly">Author Notes</label>

                                            <div ng-if="!viewSettings.tableReadonly">
                                                <textarea froala="froalaEditorOptions" ng-model="datatype.authorNotes" name="text" id="authorNotes"></textarea>
                                            </div>
                                            <div ng-if="viewSettings.tableReadonly">
                                                <div class="fr-view">
                                                    <div froala-view="datatype.authorNotes"></div>
                                                </div>
                                            </div>


                                            <label class="input-left igamt-label"  ng-show="datatype.scope === 'HL7STANDARD' && datatype.hl7Section != null && datatype.hl7Section != ''">HL7 Section</label>

                                            <md-input-container class="md-block igamt-input-block" flex-gt-sm
                                                 ng-show="datatype.scope === 'HL7STANDARD' && datatype.hl7Section != null && datatype.hl7Section != ''">
                                                <input type="text" disabled
                                                       name="hl7Section"
                                                       id="hl7Section"
                                                       ng-model="datatype.hl7Section"
                                                       >
                                            </md-input-container>
                                        </md-content>
                                    </div>
                                 </md-tab-body>
                            </md-tab>
                            <md-tab md-on-select="setDeltaToF(0);refreshSlider();">
                                <md-tab-label>
                                    <i class="fa fa-table" aria-hidden="true"></i>Definition
                                </md-tab-label>
                                <md-tab-body>
                                    <div class="el-def" style="margin-top: 5px">
                                        <md-tabs md-dynamic-height md-border-bottom md-selected="defTabStatus.active">
                                            <md-tab>
                                                <md-tab-label>
                                                    <span>Pre-Text </span>
                                                </md-tab-label>
                                                <md-tab-body>
                                            <div class="panel-primary">
                                                <div class="panel-body">

                                                    <div ng-show="!viewSettings.tableReadonly && datatype.status!=='PUBLISHED'">
                                                        <textarea froala="froalaEditorOptions"
                                                                  ng-model="datatype.defPreText" name="text"
                                                                  id="defPreText" ng-change="setDirty()"></textarea>
                                                      </div>
                                                    <div ng-show="viewSettings.tableReadonly || datatype.status==='PUBLISHED'">
                                                        <div class="fr-view">
                                                            <div froala-view="datatype.defPreText"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                                </md-tab-body>
                                            </md-tab>
                                            <md-tab md-on-select="refreshSlider();">
                                                <md-tab-label>
                                                    <span >Structure </span>
                                                </md-tab-label>
                                                <md-tab-body>
                                                    <div layout="column">
                                                        <div flex layout="row" layout-align="start start">
                                                            <div class="table-context">
                                                                <strong> Context :</strong>
                                                                <span class="label-component-icon"><i class="fa fa-circle fa-fw"/></span>
                                                                Field
                                                                <span class="label-sub-component-icon"><i class="fa fa-circle fa-fw"/></span>
                                                                Component
                                                            </div>
                                                            <div flex class="pull-right">

                                                                <md-button ng-if="igdocument && datatype.scope!=='HL7STANDARD' && datatype.components && datatype.components.length > 0"
                                                                            class="pull-right btn btn-sm btn-raised menu-table menu-table-verify" title="Verify Data type" type="button"
                                                                            ng-click="validateDatatype()">
                                                                    <i class="fa fa-check fa-fw"></i> Verify
                                                                </md-button>
                                                                <md-select ng-show="datatype.components && datatype.components.length > 0"  class="pull-right"  ng-model="viewSettings.visibleColumns"  md-selected-text="viewSettings.getPlaceHolder()" multiple ng-model-options="{trackBy: '$value.id'}" no-dirty-check>
                                                                    <md-optgroup label="Columns">
                                                                        <md-option ng-repeat="opt in  viewSettings.columnOptions track by $index" ng-value="opt">{{opt.label}}</md-option>
                                                                    </md-optgroup>
                                                                </md-select>

                                                                <!--<span class="pull-right" ng-dropdown-multiselect=""-->
                                                                     <!--ng-show="datatype.components && datatype.components.length > 0"-->
                                                                     <!--options="viewSettings.columnOptions"-->
                                                                     <!--selected-model="viewSettings.visibleColumns"-->
                                                                     <!--events="viewSettings.events"-->
                                                                     <!--extra-settings="viewSettings.extra"-->
                                                                     <!--translation-texts="viewSettings.translations"></span>-->
                                                            </div>
                                                        </div>
                                                    </div>

                                            <div  class="panel-primary">

                                                <div class="" style="margin:5px 5px 5px 5px">

                                                    <div class="row"
                                                         ng-show="showErrorCount(datatype.id)  && showDtErrorNotification"
                                                         style="margin-right: 15px;margin-left: 5px;">
                                                        <div class="alert has-error"
                                                             ng-show="errorCount(datatype.id)>0">
                                                            <button type="button" ng-click="setErrorNotification();"
                                                                    class="close" aria-label="Close">
                                                                <span>&times;</span></button>
                                                            {{errorCount(datatype.id)}} Errors

                                                        </div>
                                                        <div class="alert alert-success"
                                                             ng-show="errorCount(datatype.id)===0">
                                                            <button type="button" ng-click="setErrorNotification();"
                                                                    class="close" aria-label="Close">
                                                                <span>&times;</span></button>
                                                            {{errorCount(datatype.id)}} Errors

                                                        </div>
                                                    </div>
                                                    <div ng-show="datatype.components && datatype.components.length > 0"
                                                         class="igl-def-table-container panel-primary" style="overflow-x:scroll">
                                                        <table id="treeTable" tt-table tt-params="datatypesParams"
                                                               class="table table-bordered table-fix-header table-condensed profile-table">
                                                            <thead>
                                                            <tr class="tbl-header">
                                                                <th class="col-fixed-name">Name</th>
                                                                <th class="col-fixed-usage"
                                                                    style="text-align:center">Usage
                                                                    <button type="button"
                                                                            class="btn btn-raised  btn-default btn-xs"
                                                                            ng-show="(datatype.scope==='USER' )&& !viewSettings.tableReadonly && (datatype.components.length>0)"
                                                                            ng-hide="typeOfSharing || datatype.status==='PUBLISHED'"
                                                                            ng-click="OtoX(datatype)">O to X
                                                                    </button>
                                                                </th>
                                                                <th ng-show="viewSettings.isVisibleColumn('length')" class="col-fixed-length"
                                                                    style="text-align:center">Length
                                                                </th>
                                                                <th class="col-fixed-confLength"
                                                                    ng-show="showConfLength() && viewSettings.isVisibleColumn('confLength')"
                                                                    style="text-align:center">Conf. Length
                                                                </th>
                                                                <th class="col-fixed-dataType"
                                                                    ng-show="viewSettings.isVisibleColumn('datatype')"
                                                                    style="text-align:center">Data Type
                                                                </th>
                                                                <th ng-if="igdocument" class="col-fixed-valueSet"
                                                                    ng-show="igdocument&&viewSettings.isVisibleColumn('valueSet')"
                                                                    style="text-align:center">Value Set/Single Code
                                                                </th>
                                                                <th ng-if="!igdocument" class="col-fixed-valueSet"
                                                                    ng-show="igdocument&&viewSettings.isVisibleColumn('valueSet')"
                                                                    style="text-align:center">Concept Domain
                                                                </th>
                                                                <th class="col-fixed-constantValue"
                                                                    ng-show="viewSettings.isVisibleColumn('singleElm')&&igdocument"
                                                                    style="text-align:center">Constant Value
                                                                </th>
                                                                <th class="col-fixed-predicate"
                                                                    ng-show="viewSettings.isVisibleColumn('predicate')"
                                                                    style="text-align:center">Predicate
                                                                </th>
                                                                <th class="col-fixed-definitionText"
                                                                    ng-show="viewSettings.isVisibleColumn('defText')"
                                                                    style="text-align:center">Definition Text
                                                                </th>
                                                                <th class="col-fixed-comment"
                                                                    ng-show="viewSettings.isVisibleColumn('comment')"
                                                                    style="text-align:center">Comment
                                                                </th>
                                                            </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>

                                                    <div ng-hide="(datatype.components && datatype.components.length > 0) || datatype.name === 'DTM'">
                                                        Primitive Data Type
                                                    </div>

                                                    <div ng-show="datatype.name === 'DTM'" class="igl-def-table-container">
                                                        <div class="panel panel-primary">
                                                            <div class="panel-heading">Date, Time, and TimeZone Format</div>
                                                            <div class="panel-body">
                                                                <table class="table table-striped table-bordered">
                                                                    <thead>
                                                                    <tr class="tbl-header">
                                                                        <th class="col-md-1" align="center">#</th>
                                                                        <th class="col-md-1" align="center">Component Name</th>
                                                                        <th class="col-md-2" align="center">Component Desc</th>
                                                                        <th class="col-md-1" align="center">Usage</th>
                                                                        <th class="col-md-1" align="center">True Usage</th>
                                                                        <th class="col-md-1" align="center">False Usage</th>
                                                                        <th class="col-md-5" align="center">Predicate</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    <tr ng-repeat="dtmComponentDefinition in datatype.dtmConstraints.dtmComponentDefinitions track by $index">
                                                                        <td class="col-md-1" align="center">
                                                                            <span ng-bind="::dtmComponentDefinition.position"/>
                                                                        </td>
                                                                        <td class="col-md-1" align="center">
                                                                            <span ng-bind="::dtmComponentDefinition.name"/>
                                                                        </td>
                                                                        <td class="col-md-2" align="center">
                                                                            <span ng-bind="::dtmComponentDefinition.description"/>
                                                                        </td>
                                                                        <td class="col-md-1" align="center">
                                                                            <md-select placeholder="Select Usage" ng-change="updateDTMConstraints(dtmComponentDefinition); setDirty();" class="inside-table" required ng-model="dtmComponentDefinition.usage" >
                                                                                <md-option ng-repeat="usage in config.usages track by $index" ng-value="usage">
                                                                                    {{usage}}
                                                                                </md-option>
                                                                            </md-select>
                                                                        </td>

                                                                        <td class="col-md-1" align="center">
                                                                            <div ng-if="dtmComponentDefinition.usage ==='C'">
                                                                                <md-select placeholder="Select Usage" class="inside-table" required ng-change="setDirty()" ng-model="dtmComponentDefinition.dtmPredicate.trueUsage" >
                                                                                    <md-option ng-repeat="usage in config.usages track by $index" ng-value="usage">
                                                                                        {{usage}}
                                                                                    </md-option>
                                                                                </md-select>
                                                                            </div>
                                                                        </td>

                                                                        <td class="col-md-1" align="center">
                                                                            <div ng-if="dtmComponentDefinition.usage ==='C'">
                                                                                <md-select placeholder="Select Usage" class="inside-table" required ng-change="setDirty()" ng-model="dtmComponentDefinition.dtmPredicate.falseUsage" >
                                                                                    <md-option ng-repeat="usage in config.usages track by $index" ng-value="usage">
                                                                                        {{usage}}
                                                                                    </md-option>
                                                                                </md-select>
                                                                            </div>
                                                                        </td>

                                                                        <td class="col-md-5" align="center">
                                                                            <div ng-if="dtmComponentDefinition.usage === 'C'">
                                                                                If {{dtmComponentDefinition.dtmPredicate.target.name}}({{dtmComponentDefinition.dtmPredicate.target.description}}) {{dtmComponentDefinition.dtmPredicate.verb}} <span ng-if="dtmComponentDefinition.dtmPredicate.value">'{{dtmComponentDefinition.dtmPredicate.value}}'</span>

                                                                                <span title="Edit predicate" ng-click="dtmComponentDefinition.dtmPredicate.editable = true;"><i class="fa fa-pencil fa-fw edit-icon"></i></span>
                                                                            </div>

                                                                            <div ng-if="dtmComponentDefinition.usage === 'C' && dtmComponentDefinition.dtmPredicate.editable">
                                                                                <div class="panel panel-primary">
                                                                                    <div class="panel-heading">DTM Predicate Builder <button class="pull-right" ng-click="dtmComponentDefinition.dtmPredicate.editable=false;">X</button></div>
                                                                                    <div class="panel-body" style="min-height:130px; max-height:130px;overflow-y: scroll;">
                                                                                        <table class="table table-striped table-bordered">
                                                                                            <thead>
                                                                                            <tr class="tbl-header">
                                                                                                <th class="col-md-4">Target</th>
                                                                                                <th class="col-md-4">Verb</th>
                                                                                                <th class="col-md-4">Value</th>
                                                                                            </tr>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                            <tr>
                                                                                                <td class="col-md-4">
                                                                                                    <md-select placeholder="Select Target" ng-change="setDirty()" ng-model="dtmComponentDefinition.dtmPredicate.target" >
                                                                                                        <md-option ng-repeat="def in datatype.dtmConstraints.dtmComponentDefinitions track by $index" ng-value="def">
                                                                                                            {{def.name}}({{def.description}})
                                                                                                        </md-option>
                                                                                                    </md-select>
                                                                                                </td>
                                                                                                <td class="col-md-4">
                                                                                                    <md-select placeholder="Select Verb" ng-change="setDirty()" ng-model="dtmComponentDefinition.dtmPredicate.verb" >
                                                                                                        <md-option value="is valued">
                                                                                                            is valued
                                                                                                        </md-option>
                                                                                                        <md-option value="is not valued">
                                                                                                            is not valued
                                                                                                        </md-option>
                                                                                                        <md-option value="is literal value">
                                                                                                            is literal value:
                                                                                                        </md-option>
                                                                                                        <md-option value="is not literal value">
                                                                                                            is not literal value:
                                                                                                        </md-option>
                                                                                                    </md-select>
                                                                                                </td>
                                                                                                <td class="col-md-4" ng-class="{'emptyCol':dtmComponentDefinition.dtmPredicate.verb !== 'is literal value' && dtmComponentDefinition.dtmPredicate.verb !== 'is not literal value'}">
                                                                                                    <md-input-container ng-if="dtmComponentDefinition.dtmPredicate.verb === 'is literal value' || dtmComponentDefinition.dtmPredicate.verb === 'is not literal value'" style="margin-top: 0px;">
                                                                                                        <input  ng-change="setDirty()" type="text"
                                                                                                                ng-model="dtmComponentDefinition.dtmPredicate.value"/>
                                                                                                    </md-input-container>
                                                                                                </td>
                                                                                            </tr>
                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                                </md-tab-body>
                                            </md-tab>


                                            <md-tab >
                                                <md-tab-label>
                                                    <span >Post-Text</span>
                                                </md-tab-label>
                                                <md-tab-body>
                                            <div  class="panel-primary">
                                                <div class="panel-body">

                                                    <div ng-show="!viewSettings.tableReadonly && datatype.status!=='PUBLISHED'">
                                                        <textarea froala="froalaEditorOptions"
                                                                  ng-model="datatype.defPostText" name="text"
                                                                  id="defPostText" ng-change="setDirty()"></textarea>
                                                      </div>
                                                    <div ng-show="viewSettings.tableReadonly || datatype.status==='PUBLISHED'">
                                                        <div class="fr-view">
                                                            <div froala-view="datatype.defPostText"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                                </md-tab-body>
                                            </md-tab>

                                            <md-tab >
                                                <md-tab-label>
                                                    <span >Conf. Statements</span>
                                                </md-tab-label>
                                                <md-tab-body>

                                            <div class="panel-primary" >

                                                <div class="panel-body">
                                                    <div class="col-md-12 igl-page-header" style="">

                                                <span class="pull-right">
                                                        <button class="btn btn-raised btn-primary btn-xs"
                                                                ng-click="manageConformanceStatement(null);"
                                                                type="button"
                                                                ng-hide="viewSettings.tableReadonly || (datatype.status==='PUBLISHED') || !datatype.components || datatype.components.length==0"><span><i
                                                                class="fa fa-plus fa-fw">
                                                            &nbsp; </i>Add Conf.Statement</span></button>
                                                </span>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <span ng-hide="datatype.conformanceStatements.length> 0">No conformance statement created</span>
                                                        <table st-table="displayedCS"
                                                               st-safe-src="datatype.conformanceStatements"
                                                               class="table table-striped table-bordered"
                                                               ng-show="datatype.conformanceStatements.length > 0">
                                                            <thead>
                                                            <tr class="tbl-header">
                                                                <th st-sort="constraintId" class="col-md-1">ID</th>
                                                                <!--<th st-sort="constraintTarget" class="col-md-3">Location</th>-->
                                                                <th class="col-md-10">Description</th>
                                                                <th class="col-md-1"></th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr ng-repeat="c in displayedCS track by $index">
                                                                <td class="col-md-1">
                                                                    {{c.constraintId}}
                                                                </td>
                                                                <!--<td class="col-md-3">-->
                                                                <!--<span ng-bind="displayLocationForDatatype(datatype, c.constraintTarget)" />-->
                                                                <!--</td>-->
                                                                <td class="col-md-7">
                                                                    {{c.description}}
                                                                </td>
                                                                <td class="col-md-1" align="center">
                                                                    <button class="btn btn-raised btn-danger btn-xxs"
                                                                            ng-click="deleteConformanceStatementFromList(c);"
                                                                            ng-disabled="viewSettings.tableReadonly">
                                                                        <span><i class="fa fa-trash fa-fw"></i></span>
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                        </table>

                                                    </div>

                                                </div>
                                            </div>
                                                </md-tab-body>
                                            </md-tab>

                                            <md-tab >
                                                <md-tab-label>
                                                    <span >Predicates</span>
                                                </md-tab-label>
                                                <md-tab-body>

                                                <div class="panel-primary">
                                                <div class="panel-body">
                                                    <div class="col-md-12">
                                                        <span ng-hide="datatype.predicates.length > 0">No conditional predicate created</span>
                                                        <table st-table="displayedCP" st-safe-src="datatype.predicates"
                                                               class="table table-striped table-bordered"
                                                               ng-show="datatype.predicates.length > 0">
                                                            <thead>
                                                            <tr class="tbl-header">
                                                                <th st-sort="constraintTarget" class="col-md-3">
                                                                    Location
                                                                </th>
                                                                <th class="col-md-6">Description</th>
                                                                <th class="col-md-1">True usage</th>
                                                                <th class="col-md-1">False usage</th>
                                                                <th class="col-md-1"></th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr ng-repeat="p in displayedCP track by $index">
                                                                <td class="col-md-3">
                                                                    <span ng-bind="displayLocationForDatatype(datatype, p.constraintTarget)"/>
                                                                </td>
                                                                <td class="col-md-6">
                                                                    {{p.description}}
                                                                </td>
                                                                <td class="col-md-1">
                                                                    {{p.trueUsage}}
                                                                </td>
                                                                <td class="col-md-1">
                                                                    {{p.falseUsage}}
                                                                </td>
                                                                <td class="col-md-1" align="center">
                                                                    <button class="btn btn-raised btn-danger btn-xxs"
                                                                            ng-click="deletePredicateFromList(p);"
                                                                            ng-disabled="viewSettings.tableReadonly"><span><i
                                                                            class="fa fa-trash fa-fw">
                            &nbsp; </i>Del</span>
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                                </md-tab-body>
                                            </md-tab>
                                        </md-tabs>
                                    </div>
                                </md-tab-body>
                            </md-tab>
                            <md-tab md-on-select="setDeltaToF()">
                                <md-tab-label>
                                    <i class="fa fa-link" aria-hidden="true"></i>Cross-References
                                </md-tab-label>
                                <md-tab-body>

                                    <div class="el-def metadata-scroll" style="margin-top:20px">
                                        <div ng-show="crossRef.fieldFounds != null && crossRef.fieldFounds.length > 0" ng-show="!loadingReferences">
                                            <h4>Fields</h4>


                                            <table class="table table-striped table-bordered table-condensed">
                                                <thead>
                                                <tr class="tbl-header">
                                                    <td st-ratio="5">#</td>
                                                    <th st-ratio="25">Path</th>
                                                    <th st-ratio="40">Name</th>
                                                    <th st-ratio="30">Segment</th>
                                                </tr>

                                                </thead>

                                                <tbody>
                                                <tr ng-repeat="ref in crossRef.fieldFounds track by $index">
                                                    <td st-ratio="5">{{$index + 1}}
                                                    </td>
                                                    <td st-ratio="25">
                                                        <span>{{ref.segmentFound.label}}.{{ref.position}}</span>
                                                    </td>
                                                    <td st-ratio="40">
                                                        <span ng-bind="ref.name"></span>
                                                    </td>
                                                    <td st-ratio="30">
                                                        <display-label of="segmentsMap[ref.segmentFound.id]" desc="true"></display-label>
                                                    </td>


                                                </tr>
                                                </tbody>

                                            </table>
                                        </div>

                                        <div ng-show="crossRef.componentFounds != null && crossRef.componentFounds.length > 0">
                                            <h4>Components</h4>


                                            <table class="table table-striped table-bordered table-condensed">
                                                <thead>
                                                <tr class="tbl-header">
                                                    <td st-ratio="5">#</td>
                                                    <th st-ratio="25">Path</th>
                                                    <th st-ratio="40">Name</th>
                                                    <th st-ratio="30">Data Type</th>
                                                </tr>

                                                </thead>

                                                <tbody>
                                                <tr ng-repeat="ref in crossRef.componentFounds track by $index">
                                                    <td st-ratio="5">{{$index + 1}}
                                                    </td>
                                                    <td st-ratio="25">
                                                        <span>{{ref.datatypeFound.label}}.{{ref.position}}</span>
                                                    </td>
                                                    <td st-ratio="40">
                                                        <span ng-bind="ref.name"></span>
                                                    </td>
                                                    <td st-ratio="30">
                                                        <display-label of="datatypesMap[ref.datatypeFound.id]" desc="true"></display-label>
                                                    </td>


                                                </tr>
                                                </tbody>

                                            </table>
                                        </div>
                                        <div ng-show="crossRef.profileComponentFound != null && crossRef.profileComponentFound.length > 0">
                                                <h4>Profile Components</h4>


                                                <table class="table table-striped table-bordered table-condensed">
                                                    <thead>
                                                    <tr class="tbl-header">
                                                        <td st-ratio="5">#</td>
                                                        <th st-ratio="25">Name</th>
                                                        <th st-ratio="40">Description</th>
                                                        <th st-ratio="10">Target Position</th>
                                                        <th st-ratio="20">Where</th>
                                                    </tr>

                                                    </thead>

                                                    <tbody>
                                                    <tr ng-repeat="ref in crossRef.profileComponentFound track by $index">
                                                        <td st-ratio="5">{{$index + 1}}
                                                        </td>
                                                        <td st-ratio="25">
                                                            <span ng-bind="ref.name"></span>
                                                        </td>
                                                        <td st-ratio="40">
                                                            <span ng-bind="ref.description"></span>
                                                        </td>
                                                        <td st-ratio="10">
                                                            {{::ref.targetPosition}}
                                                        </td>
                                                        <td st-ratio="20">
                                                            {{::ref.where}}
                                                        </td>


                                                    </tr>
                                                    </tbody>

                                                </table>
                                        </div>
                                        <div ng-show="crossRef.coConstraintFounds != null && crossRef.coConstraintFounds.length > 0">
                                            <h4> Segments Co-Constraints</h4>
                                            <display-label  ng-repeat="ref in crossRef.coConstraintFounds track by $index" of="segmentsMap[ref.segmentFound.id]" desc="true"></display-label>
                                            <br/>


                                        </div>
                                        <div ng-show="crossRef.dynamicMappingFounds != null && crossRef.dynamicMappingFounds.length > 0">
                                            <h4> Segments Dynamic Mapping</h4>
                                            <display-label  ng-repeat="ref in crossRef.dynamicMappingFounds track by $index" of="segmentsMap[ref.segmentFound.id]" desc="true"></display-label>
                                            <br/>


                                        </div>
                                    </div>

                                </md-tab-body>
                            </md-tab>
                            <md-tab md-on-select="setDeltaToF(); getAllVersionsOfDT(datatype.parentVersion)" ng-if="datatype.parentVersion&&versionAndUseMap[datatype.parentVersion]">
                                <md-tab-label>
                                    <i class="fa fa-area-chart" aria-hidden="true"></i> Version History
                                </md-tab-label>
                                <md-tab-body>
                                    <div class="panel-body metadata-scroll">



                                        <table class="table table-bordered table-stripped">
                                            <thead>
                                            <tr class="tbl-header">
                                                <th class="col-md-3">Publication Version</th>
                                                <th class="col-md-4">Publication Date</th>
                                                <th class="col-md-5">Actions</th>


                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr ng-repeat="inf in availbleVersionOfDt track by $index" ng-if="inf.publicationDate">
                                                <td class="col-md-3">
                                                    <input ng-if="inf.id !==datatype.parentVersion" type="radio" name="inforadio" value="availbleVersionOfDt" ng-model="inf.checked" ng-click="compareWithCurrent(inf.id);" />

                                                    <input type="radio" name="inforadio1" value="datatype.id" ng-model="datatype.parentVersion" disabled ng-if="inf.id ===datatype.parentVersion" />

                                                    <span class="badge" ng-class="{'selected2' :checked===inf.id}" style="color:black !important" ng-if="inf.id !==datatype.parentVersion">v{{inf.publicationVersion}}</span>
                                                    <span class="badge selected1" style="color:black !important" ng-if="inf.id ===datatype.id">v{{inf.publicationVersion}}</span>
                                                    <span ng-if="datatype.parentVersion===inf.id" tooltip="This is the version of the current datatype"><strong>(current)</strong></span>

                                                </td>
                                                <td class="col-md-4">
                                                    <span>{{inf.publicationDate}}</span>
                                                </td>
                                                <td class="col-md-5">
                                                    <!--<button ng-if="references.length>0&&datatype.parentVersion!==inf.id" ng-click="changeDatatype(inf.id);" type="button" class="btn btn-raised btn-raised btn-xs btn-success">-->
                                                        <!--<i class="fa fa-refresh fa-fw"></i>-->

                                                        <!--<span ng-if="inf.publicationVersion>datatype.publicationVersion">Upgrade To</span><span ng-if="inf.publicationVersion<datatype.publicationVersion">Downgrade To</span>-->
                                                    <!--</button>-->
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>


                                        <table tt-table tt-params="dynamicDt_Evolution" class=" table-marginless table-bordered table-condensed" ng-if="!hideEvolution">
                                            <thead>
                                            <tr class="tbl-header">
                                                <th class="col-md-1" rowspan="2" style="width:14%;">Position</th>
                                                <th class="col-md-2" rowspan="2" style="width:37%;">Name</th>
                                                <th class="col-md-1" rowspan="2" style="width:2%">Usage</th>
                                                <th class="col-md-1" colspan="2" style="width:4%">Cardinality</th>
                                                <th class="col-md-1" colspan="2" style="width:4%">Length</th>
                                                <th class="col-md-1" rowspan="2" style="width:2%">Conf. Length</th>
                                                <th class="col-md-1" rowspan="2" style="width:21%">Data Type</th>
                                                <th class="col-md-1" rowspan="2" style="width:16%">Value Set</th>
                                            </tr>
                                            <tr class="tbl-header">
                                                <th class="col-md-1 col-fixed-10" style="width:2%">min</th>
                                                <th class="col-md-1 col-fixed-10" style="width:2%">max</th>
                                                <th class="col-md-1 col-fixed-10" style="width:2%">min</th>
                                                <th class="col-md-1 col-fixed-10" style="width:2%">max</th>
                                            </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>

                                    </div>

                                </md-tab-body>
                            </md-tab>
                        </md-tabs>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
<script type="text/ng-template" id="DatatypeComponentEditTree.html">
    <tr tt-node is-branch="hasChildren(node)"
        ng-show="(isVisible(node) &&( node.usage==='R' ||node.usage==='RE' ||node.usage==='C' )&& $root.usageF) || (isVisible(node) && !$root.usageF)"
        ng-class="{ 'new': isChildNew(node),'selected': isChildSelected(node)}">
        <td ng-controller="FormRowCtrl" ng-init="init(node)">
            <!--<a ng-show="editableSeg!==node.id" ng-click="editComponent(node,datatype)" class="point">-->
            <!--<span><i class="fa fa-pencil fa-fw"></i></span>-->
            <!--</a>-->
            <!--<a ng-show="editableSeg!==node.id" ng-click="deleteComponent(node,datatype)" class="point">-->
            <!--<span><i class="glyphicon glyphicon-trash"></i></span>-->
            <!--</a>-->
            <ng-form name="{{formName}}" class="form-inline">
                <!--<input type="checkbox" ng-checked="isChildSelected(node)" ng-click="selectChild($event,node)">-->

                <span ng-show="hasError(node.id) && validationResult && isDatatypeValidated()"><i
                        class="fa fa-exclamation-triangle" style="color:red;"></i></span>
                <span ng-show="!hasError(node.id) && validationResult && isDatatypeValidated()"><i
                        class="fa fa-check-circle" style="color:green;"></i></span>

                <span class="label label-component label-icon">C</span>
                <span ng-show="editableComp!==node.id">
                <span ng-hide="isChildNew(node)" tooltip-html="getComponentNodeName(node)" tooltip-append-to-body="true"
                      tooltip-class="constraints-tooltip" ng-bind-html="getComponentNodeName(node)" tooltip-trigger
                      tooltip-animation="false" tooltip-placement="left"></span>
                <span ng-show="isChildNew(node)">
                  {{node.position}}.
                <input
                        class="form-control focus"
                        autofocus
                        style="width:65%"
                        name="name"
                        ng-change="setDirty()"
                        ng-class="{ 'has-error has-feedback' : {{formName}}.name.$invalid}"
                        ng-model="node.name" required>

            </span>
                </span>
                <span ng-show="editableComp===node.id">
              <select ng-model="position" ng-change="selectPos()" style="width:15%" class="form-control input-sm">
                  <option ng-repeat="child in datatype.components track by $index"
                          ng-selected="node.position===child.position">
                      {{child.position}}
              </select>
            <input style="width:55%" class="form-control" ng-model="compName" type="text"/>
            </span>

                <div align="center">
                    <a ng-show="editableComp===node.id && compName"
                       ng-click="applyComp(datatype,node,compName,position)" class="point">
                        <span><i class="glyphicon glyphicon-ok"></i></span>
                    </a>
                    <a ng-show="editableComp===node.id" ng-click="backComp()" class="point">
                        <span><i class="glyphicon glyphicon-remove"></i></span>
                    </a>
                </div>
            </ng-form>
        </td>
        <td ng-class="hasUsageError(node.id)" data-toggle="tooltip" title="{{displayMessageError(node.id,'USAGE')}}">
            <div>
                <span ng-if="node.usage !== 'C'  || (node.usage === 'C' && countPredicate(node.position) === 0)"
                      ng-controller="FormRowCtrl" ng-init="init(node)">
                    <ng-form name="{{formName}}" class="form-inline">
                        <!--<select class="form-control input-sm" name="usage" id="usage"-->
                                <!--ng-change="setUsage(node); openPredicateDialog(node);"-->
                                <!--ng-class="{ 'has-error has-feedback' : {{formName}}.usage.$invalid}"-->
                                <!--required ng-model="node.usage" ng-options="usage for usage in config.usages"/>-->
                             <md-select placeholder="Select Usage" name="usage" id="usage" class="inside-table"
                                        ng-change="setUsage(node); openPredicateDialog(node);"
                                        ng-class="{ 'has-error has-feedback' : {{formName}}.usage.$invalid}"
                                        required ng-model="node.usage" >

                                 <md-option ng-repeat="usage in config.usages track by $index" ng-value="usage">
                                     {{usage}}

                                 </md-option>
                             </md-select>


                    </ng-form>
                </span>


                <span ng-if="node.usage === 'C' && countPredicate(node.position) !== 0" >
                <p ng-repeat="p in datatype.predicates  | filter:{constraintTarget:node.position + '[1]'}:true track by $index">
                    <span class="badge label-white">
                        <span>C({{p.trueUsage}}/{{p.falseUsage}})</span>
                        <span ng-click="managePredicate(node)"><i class="fa fa-pencil fa-fw edit-icon"></i></span>
                        <span ng-click="deleteDatatypePredicate(node.position, datatype)"><i
                                    class="fa fa-times fa-fw edit-icon"></i></span>

                    </span>
                </p>
                </span>

            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('length')" ng-class="{'emptyCol':datatypesMap[node.datatype.id].components.length >0 || node.minLength === 'NA' || node.maxLength === 'NA','has-validation-error':hasLengthError(node.id)}"
            data-toggle="tooltip" title="{{displayMessageError(node.id,'LENGTH')}}">
            <div ng-if="datatypesMap[node.datatype.id].components.length == 0">
                <div ng-hide="node.minLength === 'NA' || node.maxLength === 'NA'">
                <ng-form name="{{formName}}" class="form-inline" ng-controller="FormRowCtrl" ng-init="init(node)" layout="row" layout-align="center center">
                    <md-input-container flex="40" class="withoutMargin">
                    <input  name="minLength" ng-change="setDirty()" type="text"
                           ng-pattern="/^\d+$|^NA$/"
                           ng-class="{ 'has-error has-feedback' : {{formName}}.minLength.$invalid}"
                           ng-model="node.minLength" required ng-minlength="1"/>
                    </md-input-container>
                    <md-input-container flex="40" class="withoutMargin">
                    <input  type="text" name="maxLength" ng-change="setDirty()"
                           ng-class="{ 'has-error has-feedback' : {{formName}}.maxLength.$invalid}"
                           ng-pattern="/^\d+$|^\*?$|^NA$/" ng-model="node.maxLength" required/>
                    </md-input-container>

                </ng-form>
                    <span flex="20" ng-click="clearLength(node)" class="point pull-right"><i class="fa fa-times fa-fw edit-icon"></i></span>

                </div>
                <div layout="row" ng-show="node.minLength === 'NA' || node.maxLength === 'NA'">
                    <span ng-click="editLength(node)" class="point"><i class="fa fa-pencil fa-fw edit-icon"></i></span>
                </div>
            </div>

        </td>
        <td ng-class="{'emptyCol':datatypesMap[node.datatype.id].components.length >0 || node.confLength === 'NA','has-validation-error':hasConfError(node.id) && datatypesMap[node.datatype.id].components.length===0}"
            ng-show="showConfLength() && viewSettings.isVisibleColumn('confLength')" data-toggle="tooltip" title="{{displayMessageError(node.id,'CONFLENGTH')}}">
            <div ng-if="datatypesMap[node.datatype.id].components.length == 0">
                <div ng-hide="node.confLength === 'NA'">
                <ng-form name="{{formName}}" class="form-inline" ng-controller="FormRowCtrl" ng-init="init(node)" layout="row" layout-align="center center">
                    <md-input-container flex="80" class="withoutMargin">
                        <input  autofocus
                                name="confLength"
                                ng-change="setDirty()"
                                ng-class="{ 'has-error' : {{formName}}.confLength.$invalid}"
                                ng-pattern="confLengthPattern"
                                ng-model="node.confLength">
                    </md-input-container>
                </ng-form>
                    <span flex="20" ng-click="clearConfLength(node)" class="point pull-right" ><i class="fa fa-times fa-fw edit-icon"></i></span>

                </div>
                <div ng-show="node.confLength === 'NA'" layout="row">
                    <span ng-click="editConfLength(node)" class="point"><i class="fa fa-pencil fa-fw edit-icon" ></i></span>
                </div>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('datatype')"
            ng-class="{'has-validation-error':hasDatatypeError(node.datatype.id)}" style="text-align:left">
            <ng-form name="innerForm" class="form-inline" ng-controller="FormRowCtrl" ng-init="init(node)">
                <div ng-if="node.datatype != null && datatypesMap[node.datatype.id] != null && datatypesMap[node.datatype.id] != undefined">
                    <span class="badge label-white" ng-show="editableDT!==node.id" style="text-align:left">
                        <span title="{{datatypesMap[node.datatype.id].hl7Version}}"
                              ng-click="redirectDT(node.datatype)">
                            <display-label of="datatypesMap[node.datatype.id]" desc="false"></display-label></span>
                        <span title="Change Datatype" ng-click="editDT(node)"><i
                                class="fa fa-pencil fa-fw edit-icon"></i></span>
                    </span>

                    <div ng-if="editableDT===node.id" style="text-align:left">
                        <!--<select ng-model="datatype" ng-change="selectDT(node,datatype)" class="form-control input-sm" ng-controller="FormRowCtrl" ng-init="init(node)">-->
                        <!--<option ng-repeat="datatype in results" value="{{datatype}}"-->
                        <!--ng-selected="node.datatype.ext===datatype.ext"> {{getDatatypeLabel(datatypesMap[datatype.id])}} {{datatypesMap[datatype.id].hl7Version}} {{getVersionToSelect(datatypesMap[datatype.id])}}-->
                        <!--</option>-->
                        <!--</select>-->


                        <md-select placeholder="Select Data type" ng-model="node.datatype" class="inside-table"
                                   ng-change="backDT();setDirty()">
                            <md-option ng-repeat="dt in results" ng-value="dt">
                                <display-label of="datatypesMap[dt.id]" desc="false"></display-label>
                            </md-option>
                            <md-option ng-click="otherDT(node)" ng-value="node.datatype"> Change Data Type root</md-option>
                        </md-select>

                    </div>

                    <div align="center">

                        <a ng-show="editableDT===node.id" ng-click="backDT()" class="point">
                            <span><i class="glyphicon glyphicon-remove"></i></span>
                        </a>
                    </div>
                </div>
            </ng-form>
        </td>
        <td ng-class="{'emptyCol':!isAvailableForValueSet(datatypesMap[node.datatype.id], datatype, node.position)}"
            ng-show="viewSettings.isVisibleColumn('valueSet')&&igdocument" style="text-align:center">
            <div ng-show="isAvailableForValueSet(datatypesMap[node.datatype.id], datatype, node.position)">
                <div ng-repeat="binding in findingBindings(node.path)  track by $index">
                    <span class="badge label-white">
                        <span ng-class="{'label-component-icon' : binding.isMain, 'label-sub-component-icon' : !binding.isMain}"><i
                                class="fa fa-circle fa-fw"/></span>
                        <span ng-show="binding.type == 'valueset'" title="For {{getDatatypeLabel(datatype)}}"
                              ng-click="redirectVS(binding)">{{getTableLabel(binding)}}</span>
                        <span ng-show="binding.type == 'singlecode'" title="For {{getDatatypeLabel(datatype)}}"
                              ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right"
                                                                                      aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="Delete ValueSet Binding" ng-show="binding.isMain"
                              ng-click="deleteBinding(binding)"><i class="fa fa-times fa-fw edit-icon"></i></span>
                    </span>
                </div>
                <a ng-click="editModalBindingForDT(node)" class="point">
                    <span><i class="fa fa-pencil fa-fw"></i></span>
                </a>
            </div>
        </td>
        <td ng-class="{'emptyCol':!isAvailableConstantValue(node)}" ng-show="viewSettings.isVisibleColumn('singleElm')&&igdocument"
            style="text-align:center">
            <div ng-show="isAvailableConstantValue(node)">
                <span ng-show="node.sev" class="badge label-white" ng-controller="FormRowCtrl" ng-init="init(node)">
                    <span ng-class="{'label-component-icon' : node.sev.isMain, 'label-sub-component-icon' : !node.sev.isMain}"><i
                            class="fa fa-circle fa-fw"/></span>
                    <span>{{node.sev.value}}</span>
                    <span title="Edit SingleElement" ng-show="node.sev.isMain" ng-click="openDialogForEditSev(node)"><i
                            class="fa fa-pencil fa-fw edit-icon"></i></span>
                    <span title="Add SingleElement" ng-show="!node.sev.isMain"
                          ng-click="confirmDatatypeSingleElementDuplicated(node)"><i
                            class="fa fa-plus fa-fw edit-icon"></i></span>
                    <span title="Delete SingleElement" ng-show="node.sev.isMain" ng-click="deleteSev(node)"><i
                            class="fa fa-times fa-fw edit-icon"></i></span>
                </span>
                <a ng-show="!node.sev" class="point" ng-click="openDialogForEditSev(node)">
                    <span><i class="fa fa-plus fa-fw"></i></span>
                </a>
            </div>
        </td>
        <td ng-class="{'has-error': node.usage === 'C' && countPredicate(node.position) != 1, 'emptyCol':node.usage !== 'C'}"
            ng-show="viewSettings.isVisibleColumn('predicate')">
            <div>
                <div ng-show="countPredicate(node.position) === 0 && node.usage === 'C'">
                    <a ng-click="managePredicate(node)" class="point">
                        <i class="fa fa-plus fa-fw"></i>

                        <p class="warning">Need predicate</p>
                    </a>
                </div>

                <div ng-show="countPredicate(node.position) !== 0 && node.usage === 'C'">
                    <p ng-repeat="p in datatype.predicates  | filter:{constraintTarget:node.position + '[1]'}:true track by $index">
                        <span title="{{getPredicateAsString(p)}}" class="badge label-white">
                            <span class="label-component-icon"><i class="fa fa-circle fa-fw"/></span>
                            <span ng-click="managePredicate(node)">{{getConstraintAsTruncatedString(p, 15)}}</span>
                            <span ng-click="managePredicate(node)"><i class="fa fa-pencil fa-fw edit-icon"></i></span>
                            <span ng-click="deleteDatatypePredicate(node.position, datatype)"><i
                                    class="fa fa-times fa-fw edit-icon"></i></span>
                        </span>
                    </p>
                    <div ng-show="countPredicate(node.position) > 1">
                        <p class="warning">Multiple predicates</p>
                    </div>
                </div>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('defText')" style="text-align:center">
            <div>
                <a ng-click="openRichTextDlg(node, 'text','Definition Text', false)" class="point">
                    <i class="fa fa-pencil fa-fw"
                       ng-show="node.text !== '' && node.text !==null && node.text !==undefined"></i>
                    <i class="fa fa-plus fa-fw" ng-show="node.text === '' || node.text === null"></i>
                </a>
                <a ng-click="node.text = '';recordChanged()" ng-show="node.text !== '' && node.text !==null && node.text !==undefined">
                    <i class="fa fa-times fa-fw"></i>
                </a>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('comment')" style="text-align:center">
            <div ng-repeat="comment in findingComments(node.path) track by $index">
                <span class="badge label-white">
                    <span ng-class="{'label-component-icon' : comment.isMain, 'label-sub-component-icon' : !comment.isMain}"><i
                            class="fa fa-circle fa-fw"/></span>
                    <span title="{{comment.description}}" ng-show="comment.isMain"
                          ng-click="editCommentDlg(node, comment, false, 'datatype')">{{comment.lastUpdatedDate|date:dateFormat}}</span>
                    <span title="Delete This Comments" ng-show="comment.isMain" ng-click="deleteComment(comment)"><i
                            class="fa fa-times fa-fw edit-icon"></i></span>
                </span>
            </div>
            <a ng-click="editCommentDlg(node, null, false, 'datatype')" class="point">
                <span><i class="fa fa-plus fa-fw"></i></span>
            </a>
        </td>
    </tr>
</script>
<script type="text/ng-template" id="DatatypeComponentReadTree.html">
    <tr tt-node is-branch="hasChildren(node)"
        ng-show="(isVisible(node) &&( node.usage==='R' ||node.usage==='RE' ||node.usage==='C' )&& $root.usageF) || (isVisible(node) && !$root.usageF)">
        <td>
            <span ng-show="hasError(node.id) && validationResult && isDatatypeValidated()"><i
                    class="fa fa-exclamation-triangle" style="color:red;"></i></span>
            <span ng-show="!hasError(node.id) && validationResult && isDatatypeValidated()"><i
                    class="fa fa-check-circle" style="color:green;"></i></span>

            <span class="label label-component label-icon">C</span>
            <span tooltip-html="getComponentNodeName(node)" tooltip-append-to-body="true"
                  tooltip-class="constraints-tooltip" ng-bind-html="getComponentNodeName(node)" tooltip-trigger
                  tooltip-animation="false" tooltip-placement="left"></span>
        </td>
        <td ng-class="hasUsageError(node.id)">
            <div>
                <span ng-show="node.usage !== 'C'  || (node.usage === 'C' && countPredicate(node.position) === 0)">
                    <span>{{::node.usage}}</span>
                </span>

                <div ng-show="node.usage === 'C' && countPredicate(node.position) !== 0">
                    <p ng-repeat="p in datatype.predicates  | filter:{constraintTarget:node.position + '[1]'}:true track by $index">
                        C({{::p.trueUsage}}/{{p.falseUsage}})
                    </p>
                </div>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('length')" ng-class="{'emptyCol':datatypesMap[node.datatype.id].components.length >0 || node.minLength === 'NA' || node.maxLength === 'NA'}">
            <div ng-show="datatypesMap[node.datatype.id].components.length == 0 && node.minLength !== 'NA' && node.maxLength !== 'NA'">
                [{{::node.minLength}},{{::node.maxLength}}]
            </div>
        </td>
        <td ng-class="{'emptyCol':datatypesMap[node.datatype.id].components.length >0 || node.confLength === 'NA'}" ng-show="showConfLength() && viewSettings.isVisibleColumn('confLength')">
            <div ng-show="datatypesMap[node.datatype.id].components.length == 0 && node.confLength !== 'NA'"><span
                    ng-bind="::node.confLength"></span></div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('datatype')" style="text-align:left">
            <a ng-click="redirectDT(node.datatype)" class="point">
                <display-label of="datatypesMap[node.datatype.id]" desc="false"></display-label>
            </a>
        </td>
        <td ng-class="{'emptyCol':!isAvailableForValueSet(datatypesMap[node.datatype.id], datatype, node.position)}"
            ng-show="viewSettings.isVisibleColumn('valueSet')&&igdocument" style="text-align:center">
            <div ng-show="isAvailableForValueSet(datatypesMap[node.datatype.id], datatype, node.position)">
                <div ng-repeat="binding in findingBindings(node.path) track by $index">
                    <span class="badge label-white">
                        <span ng-class="{'label-component-icon' : binding.isMain, 'label-sub-component-icon' : !binding.isMain}"><i
                                class="fa fa-circle fa-fw"/></span>
                        <span ng-show="binding.type == 'valueset'" title="For {{getDatatypeLabel(datatype)}}"
                              ng-click="redirectVS(binding)">{{getTableLabel(binding)}}</span>
                        <span ng-show="binding.type == 'singlecode'" title="For {{getDatatypeLabel(datatype)}}"
                              ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right"
                                                                                      aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                    </span>
                </div>
            </div>
        </td>
        <td ng-class="{'emptyCol':!isAvailableConstantValue(node)}" ng-show="viewSettings.isVisibleColumn('singleElm')&&igdocument"
            style="text-align:center">
            <div ng-show="isAvailableConstantValue(node)">
                <span ng-show="node.sev" class="badge label-white">
                    <span ng-class="{'label-component-icon' : node.sev.isMain, 'label-sub-component-icon' : !node.sev.isMain}"><i
                            class="fa fa-circle fa-fw"/></span>
                    <span>{{node.sev.value}}</span>
                </span>
            </div>
        </td>
        <td ng-class="{'has-error': node.usage === 'C' && countPredicate(node.position) != 1, 'emptyCol':node.usage !== 'C'}"
            ng-show="viewSettings.isVisibleColumn('predicate')">
            <div>
                <div ng-show="countPredicate(node.position) !== 0 && node.usage === 'C'">
                    <p ng-repeat="p in datatype.predicates  | filter:{constraintTarget:node.position + '[1]'}:true track by $index">
                        <span title="{{getPredicateAsString(p)}}" class="badge label-white">
                            <span class="label-component-icon"><i class="fa fa-circle fa-fw"/></span>
                            <span>{{getConstraintAsTruncatedString(p, 15)}}</span>
                        </span>
                    </p>
                </div>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('defText')">
            <a ng-show="node.text && node.text !== '' && node.text !==null && node.text !==undefined"
               ng-click="openRichTextDlg(node, 'text','Definition Text', true)" class="point">
                <i class="fa fa-eye fa-fw"></i>
            </a>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('comment')" style="text-align:center">
            <div ng-repeat="comment in findingComments(node.path) track by $index">
                <span class="badge label-white">
                    <span ng-class="{'label-component-icon' : comment.isMain, 'label-sub-component-icon' : !comment.isMain}"><i
                            class="fa fa-circle fa-fw"/></span>
                    <span title="{{comment.description}}" ng-show="comment.isMain"
                          ng-click="editCommentDlg(node, comment, true, 'datatype')">{{comment.lastUpdatedDate|date:dateFormat}}</span>
                </span>
            </div>
        </td>
    </tr>
</script>
<script type="text/ng-template" id="DatatypeSubComponentEditTree.html">
    <tr tt-node is-branch="hasChildren(node)" ng-show="isVisible(node)">
        <td>
            <span ng-show="hasError(node.id) && validationResult && isDatatypeValidated()"><i
                    class="fa fa-exclamation-triangle" style="color:red;"></i></span>
            <span ng-show="!hasError(node.id) && validationResult && isDatatypeValidated()"><i
                    class="fa fa-check-circle" style="color:green;"></i></span>
            <span>
                <span class="label label-sub-component label-icon">S</span>
                <span tooltip-html="getComponentNodeName(node)" tooltip-append-to-body="true"
                      tooltip-class="constraints-tooltip" ng-bind-html="getComponentNodeName(node)" tooltip-trigger
                      tooltip-animation="false" tooltip-placement="left"></span>
            </span>
        </td>
        <td ng-class="hasUsageError(node.id)" data-toggle="tooltip" title="{{displayMessageError(node.id,'USAGE')}}">
            <span ng-show="node.usage !== 'C'  || (node.usage === 'C' && countPredicateOnSubComponent(node.position, node.id) === 0)">
                {{::node.usage}}
            </span>

            <div ng-show="node.usage === 'C' && countPredicateOnSubComponent(node.position, node.id) !== 0">
                <p ng-repeat="p in parentsMap[node.id].predicates   | filter:{constraintTarget:node.position + '[1]'}:true track by $index">
                    C({{::p.trueUsage}}/{{::p.falseUsage}})
                </p>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('length')" ng-class="{'emptyCol':datatypesMap[node.datatype.id].components.length >0 || node.minLength === 'NA' || node.maxLength === 'NA','has-validation-error':hasLengthError(node.id)}"
            data-toggle="tooltip" title="{{displayMessageError(node.id,'LENGTH')}}">
            <div ng-show="datatypesMap[node.datatype.id].components.length == 0 && node.minLength !== 'NA' && node.maxLength !== 'NA'">
                [{{::node.minLength}},{{::node.maxLength}}]
            </div>
        </td>
        <td ng-class="{'emptyCol':datatypesMap[node.datatype.id].components.length >0 || node.maxLength === 'NA'}" ng-show="showConfLength() && viewSettings.isVisibleColumn('confLength')">
            <div ng-show="datatypesMap[node.datatype.id].components.length == 0 && node.maxLength !== 'NA'"><span
                    ng-bind="::node.confLength"></span></div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('datatype')" style="text-align:left">
            <span title="Go to datatype" ng-click="redirectDT(node.datatype)">
                <display-label of="datatypesMap[node.datatype.id]" desc="false"></display-label>
            </span>
        </td>
        <td ng-class="{'emptyCol':!isAvailableForValueSet(datatypesMap[node.datatype.id], parentsMap[node.id], node.position)}"
            ng-show="viewSettings.isVisibleColumn('valueSet')&&igdocument" style="text-align:center">
            <div ng-show="isAvailableForValueSet(datatypesMap[node.datatype.id], parentsMap[node.id], node.position)">
                <div ng-repeat="binding in findingBindings(node.path, parentsMap[node.id]) track by $index">
                    <span class="badge label-white">
                        <span ng-class="{'label-component-icon' : binding.isMain, 'label-sub-component-icon' : !binding.isMain}"><i
                                class="fa fa-circle fa-fw"/></span>
                        <span title="For {{getDatatypeLabel(datatype)}}"
                              ng-show="binding.isMain && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding)}}</span>
                        <span title="For {{getDatatypeLabel(parentsMap[node.id])}}"
                              ng-show="!binding.isMain && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding)}}</span>
                        <span title="For {{getDatatypeLabel(datatype)}}"
                              ng-show="binding.isMain && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i
                                class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getDatatypeLabel(parentsMap[node.id])}}"
                              ng-show="!binding.isMain && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i
                                class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="Delete ValueSet Binding" ng-show="binding.isMain"
                              ng-click="deleteBinding(binding)"><i class="fa fa-times fa-fw edit-icon"></i></span>
                    </span>
                </div>

                <a ng-click="editModalBindingForDT(node)" class="point">
                    <span><i class="fa fa-pencil fa-fw"></i></span>
                </a>
            </div>
        </td>
        <td ng-class="{'emptyCol':!isAvailableConstantValue(node, parentsMap[node.id])}"
            ng-show="viewSettings.isVisibleColumn('singleElm')&&igdocument" style="text-align:center">
            <div ng-show="isAvailableConstantValue(node, parentsMap[node.id])">
                <span ng-show="node.sev" class="badge label-white">
                    <span ng-class="{'label-component-icon' : node.sev.isMain, 'label-sub-component-icon' : !node.sev.isMain}"><i
                            class="fa fa-circle fa-fw"/></span>
                    <span>{{node.sev.value}}</span>
                    <span title="Edit SingleElement" ng-show="node.sev.isMain" ng-click="openDialogForEditSev(node)"><i
                            class="fa fa-pencil fa-fw edit-icon"></i></span>
                    <span title="Add SingleElement" ng-show="!node.sev.isMain"
                          ng-click="confirmDatatypeSingleElementDuplicated(node)"><i
                            class="fa fa-pencil fa-fw edit-icon"></i></span>
                    <span title="Delete SingleElement" ng-show="node.sev.isMain"
                          ng-click="deleteSev(node, parentsMap[node.id])"><i
                            class="fa fa-times fa-fw edit-icon"></i></span>
                </span>
                <a ng-show="!node.sev" class="point" ng-click="openDialogForEditSev(node)">
                    <span><i class="fa fa-plus fa-fw"></i></span>
                </a>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('predicate')" ng-class="{'emptyCol':node.usage !== 'C'}">
            <span ng-repeat="p in parentsMap[node.id].predicates|filter:{constraintTarget:node.position + '[1]'}:true track by $index">
                <span class="label-sub-component-icon"><i class="fa fa-circle fa-fw"/></span>
                <span title="{{getPredicateAsString(p)}}">{{getConstraintAsTruncatedString(p, 15)}}</span>
            </span>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('defText')">
            <div ng-show="node.text && node.text !== '' && node.text !==null && node.text !==undefined">
                <a ng-click="openRichTextDlg(node, 'text', 'Definition Text', true)" class="point">
                    <i class="fa fa-eye fa-fw"></i>
                </a>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('comment')" style="text-align:center">
            <div ng-repeat="comment in findingComments(node.path, parentsMap[node.id]) track by $index">
                <span class="badge label-white">
                    <span ng-class="{'label-component-icon' : comment.isMain, 'label-sub-component-icon' : !comment.isMain}"><i
                            class="fa fa-circle fa-fw"/></span>
                    <span title="{{comment.description}}" ng-show="comment.isMain"
                          ng-click="editCommentDlg(node, comment, false, 'datatype')">{{comment.lastUpdatedDate|date:dateFormat}}</span>
                    <span title="[{{getDatatypeLabel(parentsMap[node.id])}}]{{comment.description}}"
                          ng-show="!comment.isMain" ng-click="editCommentDlg(node, comment, true, 'datatype')">{{comment.lastUpdatedDate|date:dateFormat}}</span>
                    <span title="Delete This Comments" ng-show="comment.isMain" ng-click="deleteComment(comment)"><i
                            class="fa fa-times fa-fw edit-icon"></i></span>
                </span>
            </div>
            <a ng-click="editCommentDlg(node, null, false, 'datatype')" class="point">
                <span><i class="fa fa-plus fa-fw"></i></span>
            </a>
        </td>
    </tr>
</script>
<script type="text/ng-template" id="DatatypeSubComponentReadTree.html">
    <tr tt-node is-branch="hasChildren(node)" ng-show="isVisible(node)">
        <td>
            <span>
                <span class="label label-sub-component label-icon">S</span>
                <span tooltip-html="getComponentNodeName(node)" tooltip-append-to-body="true"
                      tooltip-class="constraints-tooltip" ng-bind-html="getComponentNodeName(node)" tooltip-trigger
                      tooltip-animation="false" tooltip-placement="left"></span>
            </span>
        </td>
        <td ng-class="hasUsageError(node.id)">
            <span ng-show="node.usage !== 'C'  || (node.usage === 'C' && countPredicateOnSubComponent(node.position, node.id) === 0)">
                {{::node.usage}}
            </span>

            <div ng-show="node.usage === 'C' && countPredicateOnSubComponent(node.position, node.id) !== 0">
                <p ng-repeat="p in parentsMap[node.id].predicates     | filter:{constraintTarget:node.position + '[1]'}:true track by $index">
                    C({{::p.trueUsage}}/{{::p.falseUsage}})
                </p>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('length')" ng-class="{'emptyCol':datatypesMap[node.datatype.id].components.length >0 || node.minLength === 'NA' || node.maxLength === 'NA'}" >
            <div ng-show="datatypesMap[node.datatype.id].components.length == 0 && node.minLength !== 'NA' && node.maxLength !== 'NA'">
                [{{::node.minLength}},{{::node.maxLength}}]
            </div>
        </td>
        <td ng-class="{'emptyCol':datatypesMap[node.datatype.id].components.length >0 || node.confLength === 'NA'}" ng-show="showConfLength() && viewSettings.isVisibleColumn('confLength')">
            <div ng-show="datatypesMap[node.datatype.id].components.length == 0 && node.confLength !== 'NA'"><span
                    ng-bind="::node.confLength"></span></div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('datatype')"
            ng-class="{'emptyCol':datatypesMap[node.datatype.id].components.length >0}" style="text-align:left">
            <a ng-click="redirectDT(node.datatype)" class="point">
                <display-label of="datatypesMap[node.datatype.id]" desc="false"></display-label>
            </a>
        </td>
        <td ng-class="{'emptyCol':!isAvailableForValueSet(datatypesMap[node.datatype.id], parentsMap[node.id], node.position)}"
            ng-show="viewSettings.isVisibleColumn('valueSet')&&igdocument" style="text-align:center">
            <div ng-show="isAvailableForValueSet(datatypesMap[node.datatype.id], parentsMap[node.id], node.position)">
                <div ng-repeat="binding in findingBindings(node.path, parentsMap[node.id]) track by $index">
                    <span class="badge label-white">
                        <span ng-class="{'label-component-icon' : binding.isMain, 'label-sub-component-icon' : !binding.isMain}"><i
                                class="fa fa-circle fa-fw"/></span>
                        <span title="For {{getDatatypeLabel(datatype)}}"
                              ng-show="binding.isMain && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding)}}</span>
                        <span title="For {{getDatatypeLabel(parentsMap[node.id])}}"
                              ng-show="!binding.isMain && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding)}}</span>
                        <span title="For {{getDatatypeLabel(datatype)}}"
                              ng-show="binding.isMain && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i
                                class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getDatatypeLabel(parentsMap[node.id])}}"
                              ng-show="!binding.isMain && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i
                                class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                    </span>
                </div>
            </div>
        </td>
        <td ng-class="{'emptyCol':!isAvailableConstantValue(node, parentsMap[node.id])}"
            ng-show="viewSettings.isVisibleColumn('singleElm')&&igdocument" style="text-align:center">
            <div ng-show="isAvailableConstantValue(node, parentsMap[node.id])">
                <span ng-show="node.sev" class="badge label-white">
                    <span ng-class="{'label-component-icon' : node.sev.isMain, 'label-sub-component-icon' : !node.sev.isMain}"><i
                            class="fa fa-circle fa-fw"/></span>
                    <span>{{node.sev.value}}</span>
                </span>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('predicate')" ng-class="{'emptyCol':node.usage !== 'C'}">
            <span ng-repeat="p in parentsMap[node.id].predicates|filter:{constraintTarget:node.position + '[1]'}:true track by $index">
                <span class="label-sub-component-icon"><i class="fa fa-circle fa-fw"/></span>
                <span title="{{getPredicateAsString(p)}}">{{getConstraintAsTruncatedString(p, 15)}}</span>
            </span>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('defText')">
            <a ng-show="node.text && node.text !== '' && node.text !==null && node.text !==undefined"
               ng-click="openRichTextDlg(node, 'text', 'Definition Text', true)" class="point">
                <i class="fa fa-eye fa-fw"></i>
            </a>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('comment')" style="text-align:center">
            <div ng-repeat="comment in findingComments(node.path, parentsMap[node.id]) track by $index">
                <span class="badge label-white">
                    <span ng-class="{'label-component-icon' : comment.isMain, 'label-sub-component-icon' : !comment.isMain}"><i
                            class="fa fa-circle fa-fw"/></span>
                    <span title="{{comment.description}}" ng-show="comment.isMain"
                          ng-click="editCommentDlg(node, comment, true, 'datatype')">{{comment.lastUpdatedDate|date:dateFormat}}</span>
                    <span title="[{{getDatatypeLabel(parentsMap[node.id])}}]{{comment.description}}"
                          ng-show="!comment.isMain" ng-click="editCommentDlg(node, comment, true, 'datatype')">{{comment.lastUpdatedDate|date:dateFormat}}</span>
                </span>
            </div>
        </td>
    </tr>
</script>
<script type="text/ng-template" id="SelectDatatypeFlavor.html">
    <div class="modal-header modal-wide">
        <div class="form-inline">
            <span class="header4 pull-left">Datatype Selection: {{getDatatypeLabel(currentDatatype)}} <span
                    class="version-badge-label" ng-if="datatypesMap[currentDatatype.id].publicationVersion">v{{datatypesMap[currentDatatype.id].publicationVersion}}</span></span>
        </div>
    </div>
    <div class="modal-body">
        <div class="row">
            <!--<div class="col-md-12">-->
            <!--<span class="btn-group btn-group-sm pull-left" data-toggle="buttons">-->
            <!--<label class="btn btn-raised  btn-primary btn-xs"-->
            <!--ng-click="loadLibrariesByFlavorName('USER')"-->
            <!--ng-class="{'active':selection.scope === 'USER'}">-->
            <!--<input type="radio" value="USER"-->
            <!--ng-model="$parent.selection.scope"><i class="fa fa-th-list"></i>MY IG DATA TYPES-->
            <!--</label>-->
            <!--<label class="btn btn-raised  btn-primary btn-xs"-->
            <!--ng-click="loadLibrariesByFlavorName('HL7STANDARD')"-->
            <!--ng-class="{'active':selection.scope === 'HL7STANDARD'}">-->
            <!--<input type="radio" value="HL7STANDARD"-->
            <!--ng-model="$parent.selection.scope"><i class="fa fa-th-list"></i>HL7 DATA TYPES-->
            <!--</label>-->
            <!--<label class="btn btn-raised  btn-primary btn-xs"-->
            <!--ng-click="loadLibrariesByFlavorName('MASTER')"-->
            <!--ng-class="{'active':selection.scope === 'MASTER'}">-->
            <!--<input type="radio" value="MASTER"-->
            <!--ng-model="$parent.selection.scope"><i class="fa fa-th-list"></i>MASTER DATA TYPES-->
            <!--</label>-->
            <!--</span>-->
            <!--</div>-->
            <div class="col-md-12">
                <!--<div class="panel panel-primary">-->
                <!--&lt;!&ndash; Default panel contents &ndash;&gt;-->
                <!--<div class="panel-heading panel-heading-collapsable">-->
                <!--<i class="glyphicon glyphicon-list"></i>Data Type Flavors-->
                <!--&lt;!&ndash;<button title="Hide Flavors" class="btn btn-raised btn-xs btn-primary pull-right"&ndash;&gt;-->
                <!--&lt;!&ndash;ng-click="collapsed = !collapsed">&ndash;&gt;-->
                <!--&lt;!&ndash;<i class="fa fa-caret-left"></i>&ndash;&gt;-->
                <!--&lt;!&ndash;</button>&ndash;&gt;-->
                <!--</div>-->
                <!--<div class="panel-body">-->
                <!--<div ng-show="!resultsLoading">-->
                <div class="container-testcase">
                    <div ng-show="results != null && results.length > 0">
                        <table st-table="tmpResults" st-safe-src="results"
                               class="table table-striped table-bordered table-condensed igl-list-table">
                            <thead>
                            <tr>
                                <th colspan="1" st-ratio="100">
                                    <input st-search placeholder="Search" class="input-sm form-control" type="search"/>
                                </th>
                            </tr>
                            <tr class="tbl-header">
                                <th st-ratio="100" st-sort="ext">Label</th>
                                <!--<th st-ratio="20" st-sort="hl7Version">Hl7 Version</th>-->
                                <!--<th st-ratio="40" st-sort="libraryName">From Library</th>-->
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="row in tmpResults | orderBy:'row.ext' track by $index"
                                ng-class="{'active':selection.selected != null && selection.selected === row.id}">
                                <td st-ratio="100">{{$index + 1}}
                                    <input type="radio" ng-model="selection.selected" ng-value="row.id"
                                           ng-click="showSelectedDetails(row)"> {{getDatatypeLabel(row)}}
                                </td>
                                <!--<td st-ratio="20">{{row.hl7Version}}</td>-->
                                <!--<td st-ratio="40">{{row.libraryName}}</td>-->
                            </tr>
                            </tbody>
                            <tfoot ng-show="results.length >= 10">
                            <tr>
                                <td colspan="1">
                                    <div st-pagination="" st-items-by-page="10" st-displayed-pages="7"></div>
                                </td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div ng-show="results == null || results.length == 0">
                        No Data Type Flavor Available
                    </div>
                </div>
                <!--</div>-->
                <!--<div ng-show="resultsLoading" style="text-align:center">-->
                <!--<i class="fa fa-circle-o-notch fa-spin fa-2x"></i>-->
                <!--</div>-->
                <!--</div>-->
                <!--</div>-->
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <div class="row">
            <div class="col-md-12">
                <div class="pull-right">
                    <button class="btn btn-raised tbn-default btn-sm" ng-click="cancel()"><span><i
                            class="fa fa-times fa-fw">
                        &nbsp; </i>Cancel</span>
                    </button>
                    <button class="btn btn-raised btn-primary btn-sm" ng-click="submit()"
                            ng-disabled="selection.selected === null || selection.selected.id === currentDatatype.id"><span><i
                            class="fa fa-play fa-fw">
                        &nbsp; </i>Bind</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</script>
<script type="text/ng-template" id="AddComponentModal.html">
    <div class="modal-header modal-wide">
        <div class="form-inline">
            <span class="header4">Add Component</span>
        </div>
    </div>
    <hr/>
    <div class="modal-body">
        <form name="addCompForm">
            <div class="row" style="margin-bottom: 20px">
                <div class="form-group control-group">
                    <label class="col-md-3 control-label col-md-offset-3">Name*</label>
                    <input style="width:30%" class="form-control col-md-4" ng-model="newComponent.name" required/>
                </div>
            </div>
            <div class="row" style="margin-bottom: 20px">
                <div class="form-group control-group">
                    <label class="col-md-3 control-label col-md-offset-3">Position*</label>

                    <div class="controls">
                        <select ng-model="position" ng-change="selectPos()" style="width:30%"
                                class="form-control input-sm" required>
                            <option ng-repeat="component in datatype.components track by $index">
                                {{component.position}}
                            <option value="{{datatype.components.length+1}}">{{datatype.components.length+1}}
                        </select>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-bottom: 20px">
                <div class="form-group control-group">
                    <label class="col-md-3 control-label col-md-offset-3">Usage*</label>

                    <div class="controls">
                        <select style="width:30%" class="form-control input-sm" name="usage"
                                ng-change="selectUsage(newComponent.usage)" ng-model="newComponent.usage"
                                ng-options="usage for usage in config.usages" required/>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-bottom: 20px">
                <div class="form-group control-group">
                    <label class="col-md-3 control-label col-md-offset-3">Length*</label>

                    <div class="controls" ng-controller="FormRowCtrl">
                        <span ng-form name="{{formName}}" class="form-inline">
                                                <input style="width:15%" class="form-control col-md-2"
                                                       placeholder="Min Length"
                                                       name="min"

                                                       ng-pattern="/^\d+$/"
                                                       ng-model="newComponent.minLength" ng-disabled="disableMin"
                                                       required>
                                                <input style="width:15%" class="form-control col-md-2" type="text"
                                                       placeholder="Max Length"
                                                       name="max"


                                                       ng-pattern="/^\d+$|^\*?$/"
                                                       ng-model="newComponent.maxLength" ng-disabled="disableMax"
                                                       required>
                                            </span>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-bottom: 20px">
                <div class="form-group control-group">
                    <label class="col-md-3 control-label col-md-offset-3">Conf Length</label>
                    <input style="width:30%" class="form-control col-md-4" name="confLength"
                           ng-pattern="confLengthPattern" ng-model="newComponent.confLength">
                </div>
            </div>
            <div class="row" style="margin-bottom: 20px">
                <div class="form-group control-group">
                    <label class="col-md-3 control-label col-md-offset-3">Datatype</label>

                    <div class="controls">
                        <input style="width:30%" class="form-control col-md-4" type="text" ng-model="searchDT.name"
                               ng-hide="selectedDT()"/>
                        <li style="width:30%" class="form-control col-md-4 col-md-offset-6" ng-show="selectedDT()">
                            {{::DT.name}} <span ng-show="DT.ext">_{{::DT.ext}}</span>
                            <button type="button" class="close" aria-label="Close" ng-click="unselectDT()">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </li>
                    </div>
                    <div ng-show="searchDT.name  && !selectedDT()">
                        <li style="width:30%" class="form-control col-md-4 col-md-offset-6"
                            ng-class="{'active':isDTActive(datatype.id)}" ng-click="selectDT(datatype)"
                            ng-repeat="datatype in datatypes | filter:searchDT track by $index">
                            {{::datatype.name}} <span ng-show="datatype.ext">_{{::datatype.ext}}</span>
                        </li>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-bottom: 20px">
                <div class="form-group control-group">
                    <label class="col-md-3 control-label col-md-offset-3">ValueSet</label>

                    <div class="controls">
                        <input style="width:30%" class="form-control col-md-4" type="text" ng-model="searchVS.name"
                               ng-hide="selectedVS()"/>
                        <li style="width:30%" class="form-control col-md-4 col-md-offset-6" ng-show="selectedVS()">
                            {{::VS.name}}
                            <button type="button" class="close" aria-label="Close" ng-click="unselectVS()">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </li>
                    </div>
                    <div ng-show="searchVS.name && !selectedVS()">
                        <li style="width:30%" class="form-control col-md-4 col-md-offset-6"
                            ng-class="{'active':isDTActive(valueSet.id)}" ng-click="selectVS(valueSet)"
                            ng-repeat="valueSet in valueSets | filter:searchVS track by $index">
                            {{::valueSet.name}}
                        </li>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-bottom: 20px">
                <div class="form-group control-group">
                    <label class="col-md-3 control-label col-md-offset-3">Comment</label>
                    <textarea style="width:30%" class="form-control col-md-4" ng-model="newComponent.comment">
                    </textarea>
                </div>
            </div>
        </form>
        <hr/>
        <div class="modal-footer">
            <button class="btn btn-raised btn-primary btn-sm" ng-click="addComponent()"
                    ng-disabled="addCompForm.$invalid"><span><i
                    class="fa fa-play fa-fw">
                &nbsp; </i>Add</span>
            </button>
            <button class="btn btn-raised btn-warning btn-sm" ng-click="cancel()"><span><i class="fa fa-times fa-fw">
                &nbsp; </i>Cancel</span>
            </button>
        </div>
    </div>
</script>
<script type="text/ng-template" id="ConfirmDatatypeDeleteCtrl.html">
<md-dialog aria-label="confirmation">
<form ng-cloak>
<md-toolbar>
<div class="md-toolbar-tools">
<h2> Delete Confirmation</h2>
<span flex><h2> Delete Confirmation</h2></span>
<md-button class="md-icon-button" ng-click="cancel()">
<i class="material-icons">clear</i>
</md-button>
</div>
</md-toolbar>
<md-dialog-content>
<div class="md-dialog-content">

<p>Are you sure you want to delete Datatype <display-label of ="dtToDelete"></display-label></p>
</div>
</md-dialog-content>
<md-dialog-actions layout="row">
<md-button  class="md-primary md-raised" md-autofocus ng-click="delete()">Delete
</md-button>
</md-dialog-actions>
</form>
</md-dialog>
</script>
<script type="text/ng-template" id="DeleteComponent.html">
    <div class="modal-header">
        <h3 class="modal-title">Delete Confirmation</h3>
    </div>
    <div class="modal-body">
        <p>Are you sure you want to delete Component: {{::componentToDelete.name}} ? </p>
    </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-raised btn-default btn-sm" ng-click="cancel()"><span><i
                class="fa fa-times fa-fw">&nbsp; </i>Cancel</span>
        </button>
        <button class="btn btn-raised btn-danger btn-sm" ng-click="delete()"><span><i
                class="fa fa-trash-o fa-fw">&nbsp; </i>Delete</span>
        </button>
    </div>
</script>

<script type="text/ng-template" id="AddBindingForDatatype.html">
    <div class="modal-header">
        <h3 class="modal-title">Add Binding for Datatype : {{::getDatatypeLabel(datatype)}} </h3>
    </div>
    <div class="modal-body">
        <span class="pull-right" ng-if="igdocument">
            <div class="btn-group btn-group-sm" data-toggle="buttons">
                <label class="btn btn-raised btn-primary btn-xs" ng-click="bindingTargetType = 'SEGMENT'; init();"
                       ng-class="{'active':bindingTargetType === 'SEGMENT'}">
                    <input type="radio" ng-value="SEGMENT" ng-model="bindingTargetType">To Segment
                </label>
                <label class="btn btn-raised btn-primary btn-xs" ng-click="bindingTargetType = 'DATATYPE'; init();"
                       ng-class="{'active':bindingTargetType === 'DATATYPE'}">
                    <input type="radio" ng-value="DATATYPE" ng-model="bindingTargetType">To Datatype
                </label>
            </div>
        </span>

        <div ng-show="bindingTargetType === 'SEGMENT'">
            <table class="table table-striped table-bordered table-condensed">
                <thead>
                <tr class="tbl-header">
                    <th class="col-md-3">Segment</th>
                    <th class="col-md-3">Field</th>
                    <th class="col-md-3">Used Datatype</th>
                    <th class="col-md-3">Value Set</th>

                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="col-md-3">
                        <select ng-model='selectedSegmentForBinding' class="form-control" ng-change="selectSegment();"
                                ng-options="seg as getSegmentLabel(seg) for seg in segments | filter:{ scope : 'USER' }"/>
                    </td>
                    <td class="col-md-3">
                        <select ng-show='selectedSegmentForBinding != null' ng-model='selectedFieldForBinding'
                                class="form-control" ng-change="selectField()">
                            <option ng-repeat="f in selectedSegmentForBinding.fields | orderBy:'+position' track by $index"
                                    value="{{f}}"
                                    ng-disabled="datatype.name!==datatypesMap[f.datatype.id].name ||checkDuplicated(getSegmentLabel(selectedSegmentForBinding) + '-' + f.position)">
                                {{::f.position}}. {{::f.name}}
                            </option>
                        </select>
                    </td>
                    <td class="col-md-3">
                        {{::datatypesMap[currentField.datatype.id].label}}
                    </td>
                    <td class="col-md-3">
                            <span ng-repeat="table in currentField.tables track by $index">
                                {{::getTableLabel(table)}}
                            </span>

                    </td>


                </tr>
                </tbody>
            </table>
        </div>

        <div ng-show="bindingTargetType === 'DATATYPE'">
            <table class="table table-striped table-bordered table-condensed">
                <thead>
                <tr class="tbl-header">
                    <th class="col-md-3">Datatype</th>
                    <th class="col-md-3">Component</th>
                    <th class="col-md-3">Used Datatype</th>
                    <th class="col-md-3">Value Set</th>

                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="col-md-3">
                        <select ng-model='selectedDatatypeForBinding' class="form-control" ng-change="selectDatatype();"
                                ng-options="dt as getDatatypeLabel(dt) for dt in datatypes | filter:{ status : 'UNPUBLISHED' }"/>
                    </td>
                    <td class="col-md-3">
                        <select ng-show='selectedDatatypeForBinding != null' ng-model='selectedComponentForBinding'
                                class="form-control" ng-change="selectComp()">
                            <option ng-repeat="c in selectedDatatypeForBinding.components | orderBy:'+position' track by $index"
                                    value="{{c}}"
                                    ng-disabled="datatype.name!==datatypesMap[c.datatype.id].name ||checkDuplicated(getDatatypeLabel(selectedDatatypeForBinding) + '.' + c.position)">
                                {{::c.position}}. {{::c.name}}
                            </option>
                        </select>
                    </td>
                    <td class="col-md-3">

                        {{datatypesMap[currentComp.datatype.id].label}}
                    </td>
                    <td class="col-md-3">
                            <span ng-repeat="table in currentComp.tables track by $index">
                                {{getTableLabel(table.id)}}
                            </span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-raised btn-default btn-sm" ng-click="cancel()"><span><i
                class="fa fa-times fa-fw">&nbsp; </i>Cancel</span>
        </button>
        <button class="btn btn-raised btn-info btn-sm"
                ng-disabled="selectedComponentForBinding == null && selectedFieldForBinding == null"
                ng-click="save(bindingTargetType)"><span><i class="fa fa-plus fa-fw">&nbsp; </i>ADD</span>
        </button>
    </div>
</script>
<script type="text/ng-template" id="DatatypeReferencesCtrlMd.html">
    <md-dialog aria-label="confirmation">
        <form ng-cloak>
            <md-toolbar>
                <div class="md-toolbar-tools">
                    <h2> Data Type Cross Reference Found</h2>
                    <span flex></span>
                    <md-button class="md-icon-button" ng-click="cancel()">
                        <i class="material-icons">clear</i>
                    </md-button>
                </div>
            </md-toolbar>

            <md-dialog-content>
                <div class="md-dialog-content">

                    <p>We cannot delete this data type because it is being referenced by elements below:</p>
                    <div class="igl-table">
                        <div ng-show="crossRefsForDelete.fieldFounds != null && crossRefsForDelete.fieldFounds.length > 0">
                            <h4>Fields</h4>


                            <table class="table table-striped table-bordered table-condensed">
                                <thead>
                                <tr class="tbl-header">
                                    <td st-ratio="5">#</td>
                                    <th st-ratio="25">Path</th>
                                    <th st-ratio="40">Name</th>
                                    <th st-ratio="30">Segment</th>
                                </tr>

                                </thead>

                                <tbody>
                                <tr ng-repeat="ref in crossRefsForDelete.fieldFounds track by $index">
                                    <td st-ratio="5">{{$index + 1}}
                                    </td>
                                    <td st-ratio="25">
                                        <span>{{ref.segmentFound.label}}.{{ref.position}}</span>
                                    </td>
                                    <td st-ratio="40">
                                        <span ng-bind="ref.name"></span>
                                    </td>
                                    <td st-ratio="30">
                                        <display-label of="segmentsMap[ref.segmentFound.id]" desc="true"></display-label>
                                    </td>


                                </tr>
                                </tbody>

                            </table>
                        </div>

                        <div ng-show="crossRefsForDelete.componentFounds != null && crossRefsForDelete.componentFounds.length > 0">
                            <h4>Components</h4>


                            <table class="table table-striped table-bordered table-condensed">
                                <thead>
                                <tr class="tbl-header">
                                    <td st-ratio="5">#</td>
                                    <th st-ratio="25">Path</th>
                                    <th st-ratio="40">Name</th>
                                    <th st-ratio="30">Data Type</th>
                                </tr>

                                </thead>

                                <tbody>
                                <tr ng-repeat="ref in crossRefsForDelete.componentFounds track by $index">
                                    <td st-ratio="5">{{$index + 1}}
                                    </td>
                                    <td st-ratio="25">
                                        <span>{{ref.datatypeFound.label}}.{{ref.position}}</span>
                                    </td>
                                    <td st-ratio="40">
                                        <span ng-bind="ref.name"></span>
                                    </td>
                                    <td st-ratio="10">
                                        {{::ref.position}}
                                    </td>
                                    <td st-ratio="30">
                                        <display-label of="datatypesMap[ref.datatypeFound.id]" desc="true"></display-label>
                                    </td>


                                </tr>
                                </tbody>

                            </table>
                        </div>
                        <div ng-show="crossRefsForDelete.profileComponentFound != null && crossRefsForDelete.profileComponentFound.length > 0">
                            <h4>Profile Components</h4>


                            <table class="table table-striped table-bordered table-condensed">
                                <thead>
                                <tr class="tbl-header">
                                    <td st-ratio="5">#</td>
                                    <th st-ratio="25">Name</th>
                                    <th st-ratio="40">Description</th>
                                    <th st-ratio="10">Target Position</th>
                                    <th st-ratio="20">Where</th>
                                </tr>

                                </thead>

                                <tbody>
                                <tr ng-repeat="ref in crossRefsForDelete.profileComponentFound track by $index">
                                    <td st-ratio="5">{{$index + 1}}
                                    </td>
                                    <td st-ratio="25">
                                        <span ng-bind="ref.name"></span>
                                    </td>
                                    <td st-ratio="40">
                                        <span ng-bind="ref.description"></span>
                                    </td>
                                    <td st-ratio="10">
                                        {{::ref.targetPosition}}
                                    </td>
                                    <td st-ratio="20">
                                        {{::ref.where}}
                                    </td>


                                </tr>
                                </tbody>

                            </table>
                        </div>
                        <div ng-show="crossRefsForDelete.coConstraintFounds != null && crossRefsForDelete.coConstraintFounds.length > 0">
                            <h4> Segments Co-Constraints</h4>
                            <display-label  ng-repeat="ref in crossRefsForDelete.coConstraintFounds track by $index" of="segmentsMap[ref.segmentFound.id]" desc="true"></display-label>
                            <br/>


                        </div>
                        <div ng-show="crossRefsForDelete.dynamicMappingFounds != null && crossRefsForDelete.dynamicMappingFounds.length > 0">
                            <h4> Segments Dynamic Mapping</h4>
                            <display-label  ng-repeat="ref in crossRefsForDelete.dynamicMappingFounds track by $index" of="segmentsMap[ref.segmentFound.id]" desc="true"></display-label>
                            <br/>
                        </div>
                    </div>
                    </div>
                </div>
            </md-dialog-content>
        </form>
    </md-dialog>
</script>
<script type="text/ng-template" id="TableMappingDatatypeCtrl.html">
    <md-dialog aria-label="table Mapping">
        <form ng-cloak role="form">
            <md-toolbar>
                <div class="md-toolbar-tools">
                    <h2>{{::datatype.name}}.{{::currentNode.path}} Value Set/SingleCode Bindings</h2>
                    <span flex></span>
                    <md-button class="md-icon-button" ng-click="ok()">
                        <i class="material-icons">clear</i>
                    </md-button>
                </div>
            </md-toolbar>

            <md-dialog-content>
                <div class="md-dialog-content">
                        <md-content>
                            <div ng-show="selectedValueSetBindings.length > 0">
                                <div ng-show="selectedValueSetBindings[0].type == 'singlecode'">
                                    <h4>Current binding(s) : Single Code</h4>
                                </div>
                                <div ng-show="selectedValueSetBindings[0].type == 'valueset'">
                                    <h4>Current binding(s) : {{selectedValueSetBindings.length}} Value Set(s)</h4>
                                </div>
                            </div>
                            <div ng-show="selectedValueSetBindings.length == 0">
                                <h4>No Binding currently</h4>
                            </div>

                            <div ng-if="selectedValueSetBindings.length > 0 && selectedValueSetBindings[0].type == 'valueset'" layout="column">
                                <table>
                                    <tr>
                                        <td style="width: 150px">
                                            <label>Binding Strength:</label>
                                        </td>
                                        <td style="width: 300px">
                                            <md-select style="margin: 20px 0 10px !important;" ng-model='bindingStrengthValue' ng-change="updateBindingStrength(bindingStrengthValue)">
                                                <md-option value="R">Required</md-option>
                                                <md-option value="S">Suggested</md-option>
                                                <md-option value="U">Unspecified</md-option>
                                            </md-select>
                                        </td>
                                        <td style="width: 100px"></td>
                                        <td style="width: 150px">
                                            <label ng-if="listOfBindingLocations">Binding Location:</label>
                                        </td>
                                        <td style="width: 300px">
                                            <md-select style="margin: 20px 0 10px !important;" ng-if="listOfBindingLocations" ng-model='bindingLocationValue' ng-change="updateBindingLocation(bindingLocationValue)">
                                                <md-option ng-repeat="bl in listOfBindingLocations track by $index" ng-value="bl">
                                                    {{bl}}
                                                </md-option>
                                            </md-select>
                                        </td>
                                    </tr>
                                </table>

                                <table st-table="displayedSelectedValueSetBindings" st-safe-src="selectedValueSetBindings" class="table table-striped table-bordered normal-table" ng-show="selectedValueSetBindings.length > 0">
                                    <thead>
                                    <tr class="tbl-header">
                                        <th class="col-md-1">Scope/Version</th>
                                        <th class="col-md-4">Binding Identifier</th>
                                        <th class="col-md-6">Name</th>
                                        <th class="col-md-1"></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="b in displayedSelectedValueSetBindings track by $index">
                                        <td class="col-md-1" style="padding-left: 5px!important;" >
                                            <span class="badge" ng-class="{'label-HL7' : getScopeLabel(tablesMap[b.tableId])==='HL7', 'label-USE': getScopeLabel(tablesMap[b.tableId])==='USR','label-MASTER':getScopeLabel(tablesMap[b.tableId])==='MAS','label-PRL':getScopeLabel(tablesMap[b.tableId])==='PRL','label-PVS':getScopeLabel(tablesMap[b.tableId])==='PVS'}">{{getScopeLabel(tablesMap[b.tableId])}} {{hasSameVersion(tablesMap[b.tableId])}}</span>
                                        </td>
                                        <td class="col-md-4">
                                            {{tablesMap[b.tableId].bindingIdentifier}}
                                        </td>
                                        <td class="col-md-6">
                                            {{tablesMap[b.tableId].name}}
                                        </td>
                                        <td class="col-md-1" align="center">
                                            <a ng-click="deleteBinding(b)" class="point">
                                                <span title="Delete ValueSet Binding"><i class="icon-size-15 fa-times fa"></i></span>
                                            </a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div ng-if="selectedValueSetBindings.length > 0 && selectedValueSetBindings[0].type == 'singlecode'">
                                <table st-table="displayedSelectedValueSetBindings"
                                       st-safe-src="selectedValueSetBindings"
                                       class="table table-bordered normal-table">
                                    <thead>
                                    <tr class="tbl-header">
                                        <th class="col-md-11">Conformance Statement for Single Code</th>
                                        <th class="col-md-1">Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="b in displayedSelectedValueSetBindings track by $index">
                                        <td class="col-md-11">
                                            {{::datatype.name}}.{{::currentNode.path}} ({{::currentNode.name}})
                                            SHALL contain the constant value '
                                            <md-input-container>
                                                <label>Code</label>
                                                <input ng-model="b.code.value" ng-change="setChanged()"/>
                                            </md-input-container>
                                            ' drawn from the code system '
                                            <md-input-container>
                                                <label>Code System</label>
                                                <input ng-model="b.code.codeSystem" ng-change="setChanged()"/>
                                            </md-input-container>
                                            '.
                                        </td>
                                        <td class="col-md-1" align="center">
                                            <a ng-click="deleteBinding(b)" class="point">
                                                <span title="Delete ValueSet Binding"><i
                                                        class="icon-size-15 fa-times fa"></i></span>
                                            </a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                            <br/>

                            <span ng-show="isSingleValueSetAllowed">
                                <h4>Select a value set or single code</h4>
                            </span>

                            <span ng-show="!isSingleValueSetAllowed">
                                <h4>Select one or more value set(s)</h4>
                            </span>

                            <md-tabs md-dynamic-height md-border-bottom>
                                <md-tab label="Value Set">
                                    <md-content class="md-padding">
                                        <table st-safe-src="tables" st-table="displayCollection"
                                               class="table table-striped table-bordered normal-table">
                                            <thead>
                                            <tr class="tbl-header">
                                                <th st-sort="scope" class="col-md-1">Scope/Version</th>
                                                <th st-sort="bindingIdentifier" class="col-md-3">Binding Identifier</th>
                                                <th class="col-md-7">Name</th>
                                                <th class="col-md-1">Action</th>
                                            </tr>
                                            <tr>
                                                <th colspan="5">
                                                    <input st-search="bindingIdentifier" placeholder="search for BindingIdentifier" class="input-sm form-control" type="search"/>
                                                </th>
                                            </tr>
                                            </thead>

                                            <tbody>
                                            <tr ng-repeat="v in displayCollection track by $index">
                                                <td class="col-md-1">
                                                    <span class="badge" ng-class="{'label-HL7' : getScopeLabel(v)==='HL7', 'label-USE': getScopeLabel(v)==='USR','label-MASTER':getScopeLabel(v)==='MAS','label-PRL':getScopeLabel(v)==='PRL','label-PVS':getScopeLabel(v)==='PVS'}">{{getScopeLabel(v)}} {{hasSameVersion(v)}}</span>
                                                </td>
                                                <td class="col-md-3">
                                                    {{v.bindingIdentifier}}
                                                </td>
                                                <td class="col-md-7">
                                                    {{v.name}}
                                                </td>
                                                <td class="col-md-1" align="center">
                                                    <span><md-checkbox ng-checked="isSelected(v)" ng-click="toggle(v);"></md-checkbox></span>
                                                </td>
                                            </tr>
                                            </tbody>
                                            <tr style="float:center !important;" ng-if="tables.length > 10">
                                                <td colspan="5" class="text-center" style="float:center !important;">
                                                    <div st-pagination="" st-items-by-page="10" st-displayed-pages="10"
                                                         style="float:center !important;"></div>
                                                </td>
                                            </tr>
                                        </table>
                                    </md-content>
                                </md-tab>
                                <md-tab label="Single Code" ng-if="isSingleValueSetAllowed"  md-on-select="singleCodeInit();">
                                    <md-content class="md-padding">
                                        <div ng-if="selectedValueSetBindings.length == 0 || selectedValueSetBindings[0].type == 'valueset'">
                                            <md-button ng-click="addManualCode()" class="md-primary">
                                                <i class="fa fa-plus fa-fw"></i> Create Single Code directly
                                            </md-button>
                                        </div>
                                        <div ng-show="!valueSetSelectedForSingleCode">
                                            <table st-safe-src="tables" st-table="displayTables"
                                                   class="table table-striped table-bordered normal-table">
                                                <thead>
                                                <tr class="tbl-header">
                                                    <th st-sort="scope" class="col-md-1">Scope/Version</th>
                                                    <th st-sort="bindingIdentifier" class="col-md-3">Binding
                                                        Identifier
                                                    </th>
                                                    <th class="col-md-7">Name</th>
                                                    <th class="col-md-1">Action</th>
                                                </tr>
                                                <tr>
                                                    <th colspan="5">
                                                        <input st-search="bindingIdentifier"
                                                               placeholder="search for BindingIdentifier"
                                                               class="input-sm form-control" type="search"/>
                                                    </th>
                                                </tr>
                                                </thead>

                                                <tbody>
                                                <tr ng-repeat="v in displayTables track by $index">
                                                    <td class="col-md-1">
                                                        <span class="badge"
                                                              ng-class="{'label-HL7' : getScopeLabel(v)==='HL7', 'label-USE': getScopeLabel(v)==='USR','label-MASTER':getScopeLabel(v)==='MAS','label-PRL':getScopeLabel(v)==='PRL','label-PVS':getScopeLabel(v)==='PVS'}">{{getScopeLabel(v)}} {{hasSameVersion(v)}}</span>
                                                    </td>
                                                    <td class="col-md-3">
                                                        {{v.bindingIdentifier}}
                                                    </td>
                                                    <td class="col-md-7">
                                                        {{v.name}}
                                                    </td>
                                                    <td class="col-md-1" align="center">
                                                        <span><md-checkbox ng-checked="valueSetSelectedForSingleCode" ng-click="selectValueSetForSingleCode(v)" ></md-checkbox></span>
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tr style="float:center !important;" ng-if="tables.length > 10">
                                                    <td colspan="5" class="text-center"
                                                        style="float:center !important;">
                                                        <div st-pagination="" st-items-by-page="10"
                                                             st-displayed-pages="10"
                                                             style="float:center !important;"></div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div ng-show="valueSetSelectedForSingleCode">
                                            <table class="table table-striped table-bordered normal-table">
                                                <thead>
                                                <tr class="tbl-header">
                                                    <th class="col-md-1">Scope/Version</th>
                                                    <th class="col-md-3">Binding Identifier</th>
                                                    <th class="col-md-7">Name</th>
                                                    <th class="col-md-1">Action</th>
                                                </tr>
                                                </thead>
                                                <tr>
                                                    <td class="col-md-1">
                                                        <span class="badge" ng-class="{'label-HL7' : getScopeLabel(valueSetSelectedForSingleCode)==='HL7', 'label-USE': getScopeLabel(valueSetSelectedForSingleCode)==='USR','label-MASTER':getScopeLabel(valueSetSelectedForSingleCode)==='MAS','label-PRL':getScopeLabel(valueSetSelectedForSingleCode)==='PRL','label-PVS':getScopeLabel(valueSetSelectedForSingleCode)==='PVS'}">{{getScopeLabel(valueSetSelectedForSingleCode)}} {{hasSameVersion(valueSetSelectedForSingleCode)}}</span>
                                                    </td>
                                                    <td class="col-md-3">
                                                        {{valueSetSelectedForSingleCode.bindingIdentifier}}
                                                    </td>
                                                    <td class="col-md-7">
                                                        {{valueSetSelectedForSingleCode.name}}
                                                    </td>
                                                    <td class="col-md-1" align="center">
                                                       <span><md-checkbox ng-checked="valueSetSelectedForSingleCode" ng-click="valueSetSelectedForSingleCode = null;">
                                                       </md-checkbox></span>
                                                    </td>
                                                </tr>
                                            </table>
                                            <table st-safe-src="valueSetSelectedForSingleCode.codes"
                                                   st-table="displayCodes"
                                                   class="table table-striped table-condensed table-bordered normal-table">
                                                <thead>
                                                <tr class="tbl-header">
                                                    <th st-sort="value" class="col-md-3">Code</th>
                                                    <th st-sort="label" class="col-md-5">Description</th>
                                                    <th class="col-md-3">CodeSystem</th>
                                                    <th class="col-md-1" style="text-align:center">Status</th>
                                                </tr>
                                                <tr>
                                                    <th>
                                                        <div layout="row">
                                                            <md-input-container flex="100" class="normal">
                                                                <label></label>
                                                                <input st-search="'value'" placeholder="Search for Code" type="search" />
                                                            </md-input-container>
                                                        </div>
                                                    </th>
                                                    <th>
                                                        <div layout="row">
                                                            <md-input-container flex="100" class="normal">
                                                                <label></label>
                                                                <input st-search="'label'" placeholder="Search for description" type="search" />
                                                            </md-input-container>
                                                        </div>
                                                    </th>
                                                    <th>
                                                        <div layout="row">
                                                            <md-input-container flex="100" class="normal">
                                                                <label></label>
                                                                <input st-search="'codeSystem'" placeholder="Search for CodeSystem" type="search" />
                                                            </md-input-container>
                                                        </div>
                                                    </th>
                                                    <th/>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr ng-repeat="c in displayCodes track by $index">
                                                    <td class="col-md-3">
                                                        <span>{{c.value}}</span>
                                                    </td>
                                                    <td class="col-md-5">
                                                        <span>{{c.label}}</span>
                                                    </td>
                                                    <td class="col-md-3">
                                                        <span>{{c.codeSystem}}</span>
                                                    </td>
                                                    <td class="col-md-1" style="text-align:center">
                                                        <span>
                                                            <md-checkbox ng-checked="isCodeSelected(c)" ng-click="toggleCode(c)"> </md-checkbox>
                                                        </span>
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tr style="float:center !important;"
                                                    ng-if="valueSetSelectedForSingleCode.codes.length > 10">
                                                    <td colspan="6" class="text-center"
                                                        style="float:center !important;">
                                                        <div st-pagination="" st-items-by-page="10"
                                                             st-displayed-pages="7"
                                                             style="float:center !important;"></div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </md-content>
                                </md-tab>
                            </md-tabs>
                        </md-content>
                </div>
            </md-dialog-content>
            <md-dialog-actions layout="row">
                <md-button ng-disabled="!changed" type="button" ng-click="saveMapping()" class="md-primary md-raised"><i class="fa fa-plus fa-fw">&nbsp; </i>Save</md-button>

            </md-dialog-actions>
        </form>
    </md-dialog>
</script>
