<div ng-controller="MessageListCtrl" ng-init="init()">


    <div ng-show="loading" style="text-align:center">
        <i class="fa fa-spinner fa-spin"></i>
    </div>

    <div ng-show="!loading">
        <div class="row">
            <div class="page-header">
                <h3>Messages List</h3>
            </div>
            <div class="table-responsive">
                <table st-table="profile.messages.children"
                       class="table table-striped table-bordered">
                    <thead>
                    <tr class="tbl-header">
                        <th></th>
                        <th st-sort="type">Type</th>
                        <th st-sort="event">Event</th>
                        <th st-sort="structID">Struct ID</th>
                        <th st-sort="description">Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr st-select-row="row" st-select-mode="single" ng-repeat="row in profile.messages.children">
                        <td cs-select="row"><input ng-click="select(row.id)" ng-checked="row.id == message.id" type="radio"></td>
                        <td ng-bind="row.type"></td>
                        <td ng-bind-html="row.event"></td>
                        <td ng-bind-html="row.structID"></td>
                        <td ng-bind-html="row.description"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div ng-show="loadingSelection" style="text-align:center">
            <img class="ajax-loading" ng-src="images/ajax.gif" alt="loading..."/>
        </div>
        <div ng-show="!loadingSelection">
            <div ng-show="message !== null">
                <div class="row">
                    <div class="page-header">
                        <h3>Selected Message: {{message.type}}^{{message.event}}^{{message.structID}}:{{message.description}}</h3>
                        <pre>
                        {{changes | json}}
                            </pre>

                    </div>
                    <div>
                        <div  style="margin-top: 20px">
                            <div class="table-responsive">
                            <table tt-table tt-params="params" class="table table-striped table-bordered">
                                <thead>
                                <tr class="tbl-header row">
                                    <th class="col-md-5">Name</th>
                                    <th class="col-md-1">Usage</th>
                                    <th  class="col-md-1">Cardinality</th>
                                    <th  class="col-md-1">Ref</th>
                                    <th  class="col-md-2">Predicate</th>
                                    <th  class="col-md-2">Conformance Statement</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                            <script type="text/ng-template" id="MessageEditTree.html">
                                <tr tt-node is-branch="hasChildren(node)" class="row">
                                    <td class="col-md-5">
                                        <span ng-show="node.type !== 'segment' && node.type !== 'group'">
                                            <span>{{node.type}}^{{node.event}}^{{node.structID}}:{{node.description}}</span>
                                         </span>
                                        <span ng-show="node.type === 'segment' || node.type === 'group'">
                                            <img
                                                 style="width:15px; height:15px"
                                                 ng-src="images/{{node.type}}.png">
                                            <span ng-if="node.type === 'segment'">{{node.position}}.{{node.ref.name}}:{{node.ref.description}}</span>
                                            <span ng-if="node.type === 'group'">{{node.position}}.{{node.name}}</span>
                                        </span>
                                    </td>
                                    <td class="col-md-1">
                                    <div ng-show="node.type === 'segment' || node.type === 'group'">
                                            <span ng-show="!node.predicates || node.predicates == null || node.predicates.length == 0">
                                                <select class="form-control input-sm"
                                                        name="usage"
                                                        ng-change="recordChange(node,'usage')"
                                                        required
                                                        ng-model="node.usage"
                                                        ng-options="usage for usage in usages">
                                                </select>
                                            </span>
                                        <span ng-show="node.predicates != null && node.predicates.length > 0">C({{node.predicates[0].trueUsage}}, {{node.predicates[0].falseUsage}})</span>

                                    </div>
                                    <div ng-show="node.type !== 'segment' && node.type !== 'group'">-</div>
                                    </td>
                                    <td class="col-md-1">
                                        <div ng-show="node.type === 'segment' || node.type === 'group'" ng-controller="MessageRowCtrl">
                                            <span ng-form name="{{formName}}">
                                                <input style="width:45%" class="igl-input"
                                                       name="min"
                                                       ng-change="recordChange(node,'min')"
                                                       ng-pattern="/^\d+$/"
                                                       ng-class="{ 'has-error' : {{formName}}.min.$invalid}"
                                                       ng-model="node.min" required ng-minlength="1">
                                                <input style="width:45%" class="igl-input" type="text"
                                                       name="max"
                                                       ng-change="recordChange(node,'max')"
                                                       ng-class="{ 'has-error' : {{formName}}.max.$invalid}"
                                                       ng-pattern="/^\d+$|^\*?$/"
                                                       ng-model="node.max" required>
                                            </span>
                                        </div>
                                        <div ng-show="node.type !== 'segment' && node.type !== 'group'">-</div>
                                    </td>
                                    <td class="col-md-1">
                                        <span ng-show="node.type === 'segment'">
                                            <a class="point"
                                                ng-click="goToSegment(node.ref.id)"
                                                ng-bind="node.ref.label"></a>
                                        </span>
                                        <div ng-show="node.type !== 'segment'">-</div>
                                    </td>
                                    <td class="col-md-2"></td>
                                    <td class="col-md-2"></td>
                                </tr>
                            </script>
                        </div>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>