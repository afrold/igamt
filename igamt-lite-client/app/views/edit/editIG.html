<div class="container bs-docs-container ig-doc">

<div ng-show="loading" style="text-align:center">
    <i class="fa fa-spinner fa-spin"></i>
</div>
<div ng-show="!loading">
    <div class="row" style="margin-left: 0px">
        <div class="col-md-3" role="complementary">
            <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix-top">
                <ul class="nav bs-docs-sidenav">
                    <li>
                        <a href="#info" target="_self">Implementation Guide Information</a>
                    </li>
                    <li class="active">
                        <a href="#messages" target="_self">Conformance Profiles</a>
                        <ul class="nav">
                            <li ng-repeat="message in profile.messages.children">
                                <a href="#message_{{message.id}}" target="_self">{{message.identifier}}</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>


        <div class="col-md-9" role="main">
            <div class="bs-docs-section">
                <h1 id="info" class="page-header">Implementation Guide Information</h1>

                <form name="igMetaDataForm" novalidate>
                    <div class="col-sm-6">

                        <div class="form-group"
                             ng-class="{'has-error' : igMetaDataForm.identifier.$invalid && !igMetaDataForm.identifier.$pristine }">
                            <label>Idenfifier</label>
                            <input type="text"
                                   ng-change="recordChange2('profile',profile.id,'identifier', profile.metaData.identifier)"
                                   name="profileIndentifier" class="form-control"
                                   ng-model="profile.metaData.identifier"
                                   required>
                        </div>

                        <div class="form-group"
                             ng-class="{'has-error' : igMetaDataForm.name.$invalid && !igMetaDataForm.name.$pristine }">
                            <label>Title</label>
                            <input type="text"
                                   ng-change="recordChange2('profile',profile.id,'name', profile.metaData.name)"
                                   name="name" class="form-control" ng-model="profile.metaData.name"
                                   required>
                        </div>

                        <div class="form-group">
                            <label>Organization Name</label>
                            <input type="text" name="orgName"
                                   ng-change="recordChange2('profile',profile.id,'orgName', profile.metaData.orgName)"
                                   class="form-control" ng-model="profile.metaData.orgName"
                                   required>
                        </div>
                        <div class="form-group"
                             ng-class="{'has-error' : igMetaDataForm.status.$invalid && !igMetaDataForm.status.$pristine }">
                            <label>Status</label>
                            <select class="form-control"
                                    name="status"
                                    ng-change="recordChange2('profile',profile.id,'status', profile.metaData.status)"
                                    ng-model="profile.metaData.status"
                                    ng-options="status for status in statuses">
                            </select>
                        </div>

                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label>Type</label>
                            <input type="text"
                                   ng-change="recordChange2('profile',profile.id,'type', profile.metaData.type)"
                                   name="type" class="form-control" ng-model="profile.metaData.type"
                                   required>
                        </div>

                        <div class="form-group"
                             ng-class="{'has-error' : igMetaDataForm.hl7Version.$invalid && !igMetaDataForm.hl7Version.$pristine }">
                            <label>HL7Version</label>
                            <select class="form-control" disabled
                                    name="hl7Version"
                                    required
                                    ng-model="profile.metaData.hl7Version"
                                    ng-options="hl7Version for hl7Version in hl7Versions">
                            </select>
                        </div>

                        <div class="form-group"
                             ng-class="{'has-error' : igMetaDataForm.schemaVersion.$invalid && !igMetaDataForm.schemaVersion.$pristine }">
                            <label>Schema version</label>
                            <select class="form-control" disabled
                                    required
                                    name="schemaVersion"
                                    ng-model="profile.metaData.schemaVersion"
                                    ng-options="schemaVersion for schemaVersion in schemaVersions">
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Topics</label>
                            <input type="text" name="topics"
                                   ng-change="recordChange2('profile',profile.id,'topics', profile.metaData.topics)"
                                   class="form-control" ng-model="profile.metaData.topics">
                        </div>
                    </div>
                </form>

            </div>

            <div class="bs-docs-section">
                <h1 id="messages" class="page-header">Conformance Profiles</h1>
                <!--<h2 class="page-header">Descriptions</h2>-->
                <!--<textarea style="width:100%" class="form-control" ng-model="profile.comment"-->
                          <!--ng-change="recordChange2('profile',profile.id,'comment', profile.comment)"> </textarea>-->
                <div ng-repeat="msg in messagesData">
                    <div>
                        <h2 id="#message_{{msg.message.id}}" class="page-header">{{msg.message.identifier}} Message
                            Definition</h2>

                        <textarea style="width:100%" class="form-control" ng-model="msg.message.comment"
                                  ng-change="recordChange2('message',msg.message.id,'comment', msg.message.comment)"> </textarea>
                        <!--<h3>Message Type</h3>-->
                        <h3>{{msg.message.structID}}</h3>
                        <table class="table table-bordered">
                            <thead>
                            <tr class="ig-tbl-header row">
                                <th class="col-md-2">Segment</th>
                                <th class="col-md-2">Name</th>
                                <th class="col-md-1">Usage</th>
                                <th class="col-md-1">Cardi</th>
                                <th class="col-md-2">Conf. Statement</th>
                                <th class="col-md-2">Predicate</th>
                                <th class="col-md-2">Comment</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="segRefOrGroup in msg.segRefOrGroups" class="row">
                                <td class="col-md-2">
                                    <span ng-show="segRefOrGroup.type === 'segment'" ng-bind="segRefOrGroup.ref.name"></span>
                                </td>
                                <td class="col-md-2">
                                    <span ng-show="segRefOrGroup.type === 'segment'" ng-bind="segRefOrGroup.ref.description"></span>
                    <span ng-show="segRefOrGroup.type === 'group'">
                        -- {{segRefOrGroup.name | uppercase }} begin
                    </span>

                    <span ng-show="segRefOrGroup.type === 'end-group'">
                        -- {{segRefOrGroup.name | uppercase }} end
                    </span>

                                </td>
                                <td class="col-md-1">
                                    <span ng-show="segRefOrGroup.predicates != null && segRefOrGroup.predicates.length > 0">C({{segRefOrGroup.predicates[0].trueUsage}}, {{segRefOrGroup.predicates[0].falseUsage}})</span>
                            <span ng-show="!segRefOrGroup.predicates || segRefOrGroup.predicates == null || segRefOrGroup.predicates.length == 0"
                                  ng-bind="segRefOrGroup.usage"></span>
                                </td>
                                <td class="col-md-1">
                        <span ng-show="segRefOrGroup.type !== 'end-group'">
                        <span>[{{segRefOrGroup.min}}..{{segRefOrGroup.max}}]</span>
                        </span>
                                </td>
                                <td class="col-md-2">

                                </td>
                                <td class="col-md-2">

                                </td>
                                <td class="col-md-2">
                         <span ng-show="segRefOrGroup.type !== 'end-group'">
                        <span ng-bind="segRefOrGroup.comment"></span>
                        </span>
                                </td>
                            </tr>


                            </tbody>
                        </table>
                    </div>


                    <h2 id="#message_{{msg.message.id}}_segments" class="page-header">Segments</h2>
                    <h2 id="#message_{{msg.message.id}}_segments_def">{{msg.message.identifier}} Segments
                        Definition</h2>
                    <!--<textarea style="width:100%" class="form-control" ng-model="msg.message.comment"-->
                              <!--ng-change="recordChange2('message',msg.message.id,'comment', msg.message.comment)"> </textarea>-->


                    <div ng-repeat="segment in msg.segments">
                        <h3>{{segment.name}} - {{segment.description}}</h3>
                        <table class="table table-bordered">
                            <thead>
                            <tr class="ig-tbl-header row">
                                <th class="col-md-1">SEQ</th>
                                <th class="col-md-1">Field</th>
                                <th class="col-md-1">Usage</th>
                                <th class="col-md-1">Cardi</th>
                                <th class="col-md-1">Length</th>
                                <th class="col-md-1">ValueSet</th>
                                <th class="col-md-2">Conf Statement</th>
                                <th class="col-md-2">Predicate</th>
                                <th class="col-md-2">Comments</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="field in segment.fields" class="row">
                                <td class="col-md-1">
                                    <span  ng-bind="field.position"></span>
                                </td>
                                <td class="col-md-2">
                                    <span  ng-bind="field.name"></span>
                                </td>
                                <td class="col-md-1">
                                    <span ng-show="field.predicates != null && field.predicates.length > 0">C({{field.predicates[0].trueUsage}}, {{field.predicates[0].falseUsage}})</span>
                            <span ng-show="!field.predicates || field.predicates == null || field.predicates.length == 0"
                                  ng-bind="field.usage"></span>
                                </td>

                                <td class="col-md-1">
                                    <span>[{{field.min}}..{{field.max}}]</span>
                                 </td>
                                <td class="col-md-1">
                                    <span>[{{field.minLength}},{{field.maxLength}}]</span>
                                </td>
                                <td class="col-md-1">
                                    <span>{{field.table.mappingId}}</span>
                                </td>
                                <td class="col-md-2">
                                </td>
                                <td class="col-md-2">
                                </td>
                                <td class="col-md-2">
                                        <span ng-bind="field.comment"></span>
                                 </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>



                    <h2 id="#message_{{msg.message.id}}_datatypes" class="page-header">Datatypes</h2>

                    <h3 id="#message_{{msg.message.id}}_datatypes_def">{{msg.message.identifier}} Datatypes
                        Definition</h3>
                    <!--<textarea style="width:100%" class="form-control" ng-model="msg.message.comment"-->
                              <!--ng-change="recordChange2('message',msg.message.id,'comment', msg.message.comment)"> </textarea>-->

                    <div ng-repeat="datatype in msg.datatypes">
                        <h3 id="#message_{{msg.message.id}}_datatypes_def_{{datatype.id}}">{{datatype.label}} - {{datatype.description}}</h3>
                        <table class="table table-bordered">
                            <thead>
                            <tr class="ig-tbl-header row">
                                <th class="col-md-1">SEQ</th>
                                <th class="col-md-1">Component</th>
                                <th class="col-md-1">Usage</th>
                                <th class="col-md-1">Cardi</th>
                                <th class="col-md-1">Length</th>
                                <th class="col-md-1">ValueSet</th>
                                <th class="col-md-2">Conf Statement</th>
                                <th class="col-md-2">Predicate</th>
                                <th class="col-md-2">Comments</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="component in datatype.children" class="row">
                                <td class="col-md-1">
                                    <span  ng-bind="component.position"></span>
                                </td>
                                <td class="col-md-2">
                                    <span  ng-bind="component.name"></span>
                                </td>
                                <td class="col-md-1">
                                    <span ng-show="component.predicates != null && component.predicates.length > 0">C({{component.predicates[0].trueUsage}}, {{component.predicates[0].falseUsage}})</span>
                            <span ng-show="!component.predicates || component.predicates == null || component.predicates.length == 0"
                                  ng-bind="component.usage"></span>
                                </td>

                                <td class="col-md-1">
                                    <span>[{{component.min}}..{{component.max}}]</span>
                                </td>
                                <td class="col-md-1">
                                    <span>[{{component.minLength}},{{component.maxLength}}]</span>
                                </td>
                                <td class="col-md-1">
                                    <span>{{component.table.mappingId}}</span>
                                </td>
                                <td class="col-md-2">
                                </td>
                                <td class="col-md-2">
                                </td>
                                <td class="col-md-2">
                                    <span ng-bind="component.comment"></span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>







                </div>





            </div>
        </div>


        <a class="back-to-top" href="#top"> Back to top </a>

    </div>
</div>
</div>


<pre>
                        {{changes | json}}
                </pre>

