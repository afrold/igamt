<div ng-controller="TableListCtrl" ng-init="init()" class="container">


<script type="text/ng-template" id="ConfirmValueSetDeleteCtrl.html">
    <div class="modal-header">
        <h3 class="modal-title">Delete Confirmation</h3>
    </div>
    <div class="modal-body">
        <p>Are you sure you want to delete Table {{tableToDelete.bindingIdentifier}} ? </p>
    </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="cancel()"><span><i class="fa fa-times fa-fw">&nbsp; </i>Cancel</span>
        </button>
        <button class="btn btn-danger" ng-click="delete()"><span><i class="fa fa-trash-o fa-fw">&nbsp; </i>Delete</span>
        </button>
    </div>
</script>

<script type="text/ng-template" id="ValueSetReferencesCtrl.html">
    <div class="modal-header">
        <h3 class="modal-title">Table References Found
            <button class="btn btn-primary pull-right" ng-click="ok()"><span><i class="fa fa-times fa-fw">&nbsp; </i>Close</span>
            </button>
        </h3>
    </div>
    <div class="modal-body">
        <p>We cannot delete this table because it is being referenced by elements below:</p>

        <div class="igl-table">
            <table class="table table-striped table-bordered">
                <thead>
                <tr class="tbl-header">
                    <th>Name</th>
                    <th>Path</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="ref in references">
                    <td>
                                        <span>
                                              <img style="width:15px; height:15px"
                                                   ng-src="images/{{ref.type}}.png">
                                             <span style="width:60%"
                                                   name="name"
                                                   ng-bind="ref.name"></span>
                                             <span ng-bind="ref.description"></span>
                                         </span>

                    </td>
                    <td>
                        <div>{{ref.path}}</div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="ok()"><span><i class="fa fa-times fa-fw">&nbsp; </i>Close</span>
        </button>
    </div>
</script>


<div ng-show="loading" style="text-align: center">
    <i class="fa fa-spinner fa-pulse fa-align-center fa-2x"></i>
</div>


<div ng-show="!loading" style="margin-top:20px">

<accordion close-others="true">
<accordion-group is-open="accordion.listStatus" panel-class="panel panel-info">
    <accordion-heading>
        <i class="pull-left glyphicon"
           ng-class="{'fa fa-caret-down': accordion.listStatus, 'fa fa-caret-right': !accordion.listStatus}"></i>ValueSets
        List
    </accordion-heading>
    <div class="container">

        <div class="row" style="padding-bottom: 20px">
            <div class="col-md-12">
                <span class="pull-right">
					<button title="Add new Table" type="button" class="btn btn-sm btn-primary" ng-click="addTable()">
                        <span><i class="fa fa-plus-circle fa-fw"></i>&nbsp; Add Table</span>
                    </button>
				</span>
            </div>
        </div>


        <div class="row">
            <div class="col-md-12">
                <div class="igl-table">
                    <table st-table="tmpTables" st-safe-src="tables" class="table table-striped table-bordered table-condensed">
                        <thead>
                        <tr>
                            <th colspan="9"><input st-search="" placeholder="Search Value Sets" class="form-control"
                                                   type="text"/></th>
                        </tr>
                        <tr class="tbl-header">
                            <th st-sort="bindingIdentifier">ID</th>
                            <th st-sort="name">Name</th>
                            <th st-sort="version">Version</th>
                            <th st-sort="stability">Stability</th>
                            <th st-sort="extensibility">Extensibility</th>
                            <th></th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr st-select-row="row" st-select-mode="single" ng-repeat="row in tmpTables">
                            <td ng-bind-html="row.bindingIdentifier"></td>
                            <td ng-bind="row.name"></td>
                            <td ng-bind="row.version"></td>
                            <td ng-bind="row.stability"></td>
                            <td ng-bind="row.extensibility"></td>
                            <td>

                                <button title="Edit" type="button" class="btn btn-xs btn-default"
                                         ng-click="select(row)">
                                    <span><i class="fa fa-pencil fa-fw"></i></span>
                                </button>
                                <button title="Create Flavor" type="button" class="btn btn-xs btn-info"
                                        ng-click="cloneTable(row)">
                                    <span><i class="fa fa-plus-circle fa-fw"></i></span>
                                </button>
                                <button title="Delete" type="button" class="btn btn-xs btn-danger"
                                        ng-click="delete(row)">
                                    <span><i class="fa fa-trash-o fa-fw"></i></span>
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</accordion-group>

<accordion-group is-open="accordion.tableStatus">

    <accordion-heading>
        <i class="pull-left glyphicon"
           ng-class="{'fa fa-caret-down': accordion.tableStatus, 'fa fa-caret-right': !accordion.tableStatus}"></i>
        ValueSet Definition
    </accordion-heading>

    <!--<div ng-show="error !== null">-->
    <!--<div class="alert alert-danger" role="alert" ng-bind="error"></div>-->
    <!--<br/>-->
    <!--</div>-->
    <div class="container">
        <div ng-show="loadingSelection" style="text-align: center; padding-top:20px">
            <i class="fa fa-spinner fa-pulse fa-align-center fa-2x"></i>
        </div>

        <div ng-show="!loadingSelection">
            <div ng-show="table != null" class="row">
                <div class="col-md-12">
                    <span class="header4">Table {{table.bindingIdentifier}}</span>
							<span class="pull-right">
								<button title="Flavor" type="button" class="btn btn-sm btn-info"
                                        ng-click="cloneTable(table)">
                                    <span><i class="fa fa-plus-circle fa-fw"></i>&nbsp; Flavor</span>
                                </button>
                        		<button title="Delete" type="button" class="btn btn-sm btn-danger"
                                        ng-click="delete(table)">
                                    <span><i class="fa fa-trash-o fa-fw"></i>&nbsp; Delete</span>
                                </button>
								<button title="Close" type="button" class="btn btn-sm btn-warning" ng-click="close()">
                                    <span><i class="fa fa-times fa-fw"></i>&nbsp; Close</span>
                                </button>
							</span>
                    <hr/>
                </div>
                <form class="form-horizontal"
                      name="editTableForm">
                    <div class="col-md-12">
                        <span class="header5">Metadata</span>
                        <hr/>

                        <div class="col-md-6">
                            <label>Mapping Identifier</label>
                            <input type="text" name="tableIndentifier"
                                   ng-change="recordChangeTable(table,'bindingIdentifier', table.bindingIdentifier)"
                                   class="form-control" ng-model="table.bindingIdentifier" required>
                            <label>Version</label>
                            <input type="text" name="version"
                                   ng-change="recordChangeTable(table,'version', table.version)" class="form-control"
                                   ng-model="table.version">
                            <label>OID</label>
                            <input type="text" name="oid" ng-change="recordChangeTable(table,'oid', table.oid)"
                                   class="form-control" ng-model="table.oid">
                            <label>Stability</label>
                            <select class="form-control"
                                    name="stability"
                                    ng-change="recordChangeTable(table,'stability', table.stability)"
                                    ng-model="table.stability"
                                    ng-options="stability for stability in config.tableStabilities">
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label>Name</label>
                            <input type="text" name="name" ng-change="recordChangeTable(table,'name', table.name)"
                                   class="form-control" ng-model="table.name" required>
                            <label>Type</label>
                            <input type="text" name="type"
                                   ng-change="recordChangeTable(table,'tableType', table.tableType)"
                                   class="form-control" ng-model="table.tableType" required>
                            <label>Extensibility</label>
                            <select class="form-control"
                                    name="Extensibility"
                                    ng-change="recordChangeTable(table,'extensibility', table.extensibility)"
                                    ng-model="table.extensibility"
                                    ng-options="extensibility for extensibility in config.tableExtensibilities">
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <br/>
                        <span class="header5">Values</span>
							<span class="pull-right">
								<button title="Add new Value" type="button"
                                        class="btn btn-sm btn-primary" ng-click="addValue()">
                                    <span><i class="fa fa-plus-circle fa-fw"></i>&nbsp; Add Value</span>
                                </button>
							</span>
                        <hr/>

                        <div class="table-responsive">
                            <table class="table table-striped table-bordered">
                                <thead>
                                <tr class="tbl-header">
                                    <th class="col-md-2">Value</th>
                                    <th class="col-md-3">DisplayName</th>
                                    <th class="col-md-2">CodeSystem</th>
                                    <th class="col-md-2">Usage
                                        <div class="btn-group btn-group-xs btn-info" role="group" aria-label="...">
                                            <button type="button" ng-click="setAllCodeUsage(table, 'R')"
                                                    class="btn btn-default btn-info">R
                                            </button>
                                            <button type="button" ng-click="setAllCodeUsage(table, 'P')"
                                                    class="btn btn-default btn-info">P
                                            </button>
                                            <button type="button" ng-click="setAllCodeUsage(table, 'E')"
                                                    class="btn btn-default btn-info">E
                                            </button>
                                        </div>
                                    </th>
                                    <th class="col-md-1">Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="c in table.codes">
                                    <td class="col-md-2">
                                        <input type="text" style="width: 100%" name="Value" class="igl-input"
                                               ng-model="c.value"
                                               ng-change="recordChangeValue(c,'value',c.value ,table.id)">
                                    </td>
                                    <td class="col-md-3">
                                        <input type="text" style="width: 100%" name="DisplayNmae" class="igl-input"
                                               ng-model="c.displayName"
                                               ng-change="recordChangeValue(c,'displayName',c.displayName ,table.id)"></td>
                                    <td class="col-md-2">
                                        <input type="text" style="width: 100%" name="CodeSystem" class="igl-input"
                                               ng-model="c.codeSystem"
                                               ng-change="recordChangeValue(c,'codeSystem',c.codeSystem ,table.id)">
                                    </td>
                                    <td class="col-md-2">
                                        <select class="form-control" name="Usage"
                                                ng-change="recordChangeValue(c,'codeUsage',c.codeUsage, table.id)"
                                                ng-model="c.codeUsage"
                                                ng-options="codeUsage for codeUsage in config.codeUsages">
                                        </select>
                                    </td>
                                    <td class="col-md-1">
                                        <button title="Delete" type="button" class="btn btn-sm btn-danger"
                                                ng-click="deleteValue(c)">
                                            <span><i class="fa fa-trash-o fa-fw">&nbsp; </i>Delete</span>
                                        </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</accordion-group>
</accordion>
</div>
</div>


<!--<pre>-->
<!--{{changes | json}}-->
<!--</pre>-->