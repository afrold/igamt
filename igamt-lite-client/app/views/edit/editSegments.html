<div ng-controller="SegmentListCtrl" ng-init="init()">


	<div ng-show="loading" style="text-align: center">
		<img class="ajax-loading" ng-src="images/ajax.gif" alt="loading..." />
	</div>

	<div ng-show="!loading">
		<div class="row">
			<div class="page-header">
				<h3>Segments List</h3>
			</div>
			<div class="igl-table">
				<table st-table="tmpSegments" st-safe-src="segments"
					class="table table-striped table-bordered">
					<thead>
						<tr class="tbl-header">
							<th></th>
							<th st-sort="name">Name</th>
							<th st-sort="description">Description</th>
							<th st-sort="label">Label</th>
							<!--<th></th>-->
						</tr>
						<!--<tr>-->
						<!--<th colspan="4">-->
						<!--<input st-search placeholder="Search Segment" class="input-sm form-control" type="search"/>-->
						<!--</th>-->
						<!--</tr>-->
					</thead>
					<tbody>
						<tr st-select-row="row" st-select-mode="single"
							ng-repeat="row in tmpSegments">
							<td cs-select="row"><input ng-click="select(row)"
								ng-checked="segment != null && row.id == segment.id"
								type="radio"></td>
							<td ng-bind="row.label"></td>
							<td ng-bind-html="row.name"></td>
							<td ng-bind-html="row.description"></td>

						</tr>
					</tbody>
					<!--<tfoot>-->
					<!--<tr>-->
					<!--<td colspan="4" class="text-center">-->
					<!--<div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="7"></div>-->
					<!--</td>-->
					<!--</tr>-->
					<!--</tfoot>-->
				</table>
			</div>
		</div>

		<div ng-show="loadingSelection" style="text-align: center">
			<i class="fa fa-spinner fa-spin"></i>
		</div>
		<div ng-show="!loadingSelection" style="padding-top: 40px">
			<div ng-show="segment !== null">
				<div class="row">

					<div>
						<span class="igl-title">Edit Segment: {{segment.label}}</span> <span
							class="pull-right">
							<button title="Close" type="button"
								class="btn btn-xs btn-primary" ng-click="close()">
								<span><i class="fa fa-times fa-fw"></i>&nbsp; Close</span>
							</button>
						</span> </span>
					</div>
					<!--<div>-->
					<!--<span>Selected Segment : {{segment.label}}</span>-->
					<!--<span class="pull-right">-->

					<!--&lt;!&ndash;<button title="Clone" type="button" class="btn btn-xs btn-info"&ndash;&gt;-->
					<!--&lt;!&ndash;ng-click="clone()">&ndash;&gt;-->
					<!--&lt;!&ndash;<span><i class="fa fa-plus-circle fa-fw"></i>&nbsp; Clone</span>&ndash;&gt;-->
					<!--&lt;!&ndash;</button>&ndash;&gt;-->

					<!--&lt;!&ndash;<button title="Reset" type="button" class="btn btn-xs btn-warning"&ndash;&gt;-->
					<!--&lt;!&ndash;ng-click="reset()" ng-disabled="true">&ndash;&gt;-->
					<!--&lt;!&ndash;<span><i class="fa fa-times fa-fw">&nbsp; </i>Reset</span>&ndash;&gt;-->
					<!--&lt;!&ndash;</button>&ndash;&gt;-->

					<!--&lt;!&ndash;<button title="Delete" type="button"&ndash;&gt;-->
					<!--&lt;!&ndash;class="btn btn-xs btn-danger"&ndash;&gt;-->
					<!--&lt;!&ndash;ng-click="delete()">&ndash;&gt;-->
					<!--&lt;!&ndash;<span><i class="fa fa-trash-o fa-fw">&nbsp; </i>Delete</span>&ndash;&gt;-->
					<!--&lt;!&ndash;</button>&ndash;&gt;-->
					<!--</span>-->
					<!--<hr/>-->
					<!--&lt;!&ndash;<button title="Save" type="button" class="btn btn-xs btn-success"&ndash;&gt;-->
					<!--&lt;!&ndash;ng-click="save()">&ndash;&gt;-->
					<!--&lt;!&ndash;<span><i class="fa fa-check-circle fa-fw">&nbsp; </i>Save</span>&ndash;&gt;-->
					<!--&lt;!&ndash;</button>&ndash;&gt;-->



					<!--</div>-->

					<form style="margin-top: 20px" class="form-horizontal"
						name="editSegmentForm">
						<!--<div>-->
						<!--<label for="segmentLabel">Name:</label>-->
						<!--<input type="text" ng-model="segment.label" ng-disabled="isFlavor(segment.label)"-->
						<!--ng-focus="isFlavor(segment.label)" class="form-control" id="segmentLabel">-->
						<!--</div>-->
						<div style="margin-top: 20px">
							<div class="table-responsive">
								<table tt-table tt-params="params"
									class="table table-striped table-bordered">
									<thead>
										<tr class="tbl-header row">
											<th class="col-md-3">Name</th>
											<th class="col-md-1">Usage</th>
											<th class="col-md-1">Cardinality</th>
											<th class="col-md-1">Length</th>
											<th class="col-md-1">ConfLength</th>
											<th class="col-md-1">Datatype</th>
											<th class="col-md-1">ValueSet</th>
											<th class="col-md-1">Predicate</th>
											<th class="col-md-1">Conformance Statement</th>
											<th class="col-md-1">Comment</th>
										</tr>
									</thead>
									<tbody></tbody>
								</table>
								<script type="text/ng-template" id="SegmentEditTree.html">
                            <tr tt-node is-branch="hasChildren(node)" class="row">
                                <td class="col-md-3">
                                        <span ng-show="node.type === 'segment'" ng-controller="SegmentRowCtrl">
                                            <span ng-form name="{{formName}}">
                                            <input style="width:60%" type="text"
                                                   name="label"
                                                   ng-change="recordChange(node,'label')"
                                                   ng-class="{ 'has-error' : {{formName}}.label.$invalid}"
                                                   class="igl-input"
                                                   ng-model="node.label" required>
                                            </span>
                                            <span ng-bind="node.description"></span>
                                         </span>
                                        <span ng-show="node.type !== 'segment'">
                                            <img style="width:15px; height:15px"
                                                 ng-src="images/{{node.type}}.png">
                                            <span ng-show="node.type !== 'segment'">{{node.position}}:{{node.name}}</span>
                                        </span>
                                </td>
                                <td class="col-md-1">
                                    <div ng-show="node.type !== 'segment'">
                                            <span ng-show="!node.predicates || node.predicates == null || node.predicates.length == 0">
                                                <select class="form-control input-sm"
                                                        name="usage"
                                                        ng-change="recordChange(node,'usage')"
                                                        required
                                                        ng-model="node.usage"
                                                        ng-options="usage for usage in usages">
                                                </select>
                                            </span>
                                        <span ng-show="node.predicates != null && node.predicates.length > 0">C({{node.predicates[0].trueUsage}}, {{node.predicates[0].falseUsage}})</span>

                                    </div>
                                    <div ng-show="node.type === 'segment'">-</div>
                                    <!--<div ng-show="node.type === 'component' || node.type === 'subcomponent'">-->
                                         <!--<span ng-show="!node.predicates || node.predicates == null || node.predicates.length == 0" ng-bind="node.usage">-->
                                         <!--</span>-->
                                        <!--<span ng-show="node.predicates != null && node.predicates.length > 0">C({{node.predicates[0].trueUsage}}, {{node.predicates[0].falseUsage}})</span>-->
                                    <!--</div>-->
                                </td>
                                <td class="col-md-1">
                                    <div ng-show="node.type === 'field'" ng-controller="SegmentRowCtrl">
                                            <span ng-form name="{{formName}}">
                                                <input style="width:45%" class="igl-input"
                                                       name="min"
                                                       ng-change="recordChange(node,'min')"
                                                       ng-pattern="/^\d+$/"
                                                       ng-class="{ 'has-error' : {{formName}}.min.$invalid}"
                                                       ng-model="node.min" required ng-minlength="1">
                                                <input style="width:45%" class="igl-input" type="text"
                                                       name="max"
                                                       ng-change="recordChange(node,'max')"
                                                       ng-class="{ 'has-error' : {{formName}}.max.$invalid}"
                                                       ng-pattern="/^\d+$|^\*?$/"
                                                       ng-model="node.max" required>
                                            </span>
                                    </div>
                                    <div ng-show="node.type !== 'field'">-</div>
                                    <!--<div ng-show="node.type === 'component' || node.type === 'subcomponent'">-->
                                           <!--[{{node.min}},{{node.max}}]-->
                                    <!--</div>-->
                                </td>
                                <td class="col-md-1">
                                    <div ng-show="node.type !== 'segment'" ng-controller="SegmentRowCtrl">
                                            <span ng-form name="{{formName}}">
                                                <input style="width:45%" class="igl-input"
                                                       name="minLength"
                                                       ng-change="recordChange(node,'minLength')"
                                                       ng-pattern="/^\d+$/"
                                                       ng-class="{ 'has-error' : {{formName}}.minLength.$invalid}"
                                                       ng-model="node.minLength" required ng-minlength="1">
                                                <input style="width:45%" class="igl-input" type="text"
                                                       name="maxLength"
                                                       ng-change="recordChange(node,'maxLength')"
                                                       ng-class="{ 'has-error' : {{formName}}.maxLength.$invalid}"
                                                       ng-pattern="/^\d+$|^\*?$/"
                                                       ng-model="node.maxLength" required>
                                            </span>
                                    </div>
                                    <div ng-show="node.type === 'segment'">-</div>
                                    <!--<div ng-show="node.type === 'component' || node.type === 'subcomponent'">-->
                                        <!--[{{node.minLength}},{{node.maxLength}}]-->
                                    <!--</div>-->
                                </td>
                                <td class="col-md-1">
                                    <div ng-show="node.type !== 'segment'" ng-controller="SegmentRowCtrl">
                                            <span ng-form name="{{formName}}">
                                            <input style="width:50%" class="igl-input" type="text"
                                                   name="confLength"
                                                   ng-change="recordChange(node,'confLength')"
                                                   ng-class="{ 'has-error' : {{formName}}.confLength.$invalid}"
                                                   ng-pattern="/^\d+$/"
                                                   ng-model="node.confLength">
                                            </span>
                                    </div>
                                    <div ng-show="node.type === 'segment'">-</div>
                                    <!--<div ng-show="node.type === 'component' || node.type === 'subcomponent'" ng-bind="node.confLength">-->
                                    <!--</div>-->
                                </td>

                                <td class="col-md-1">
                                    <div ng-show="node.type !== 'segment'">
                                        <select class="form-control input-sm"
                                                name="segment"
                                                ng-change="onDatatypeChange(node)"
                                                required
                                                ng-model="node.datatype"
                                                ng-options="dt as dt.label for dt in datatypes | flavors:node.datatype.name">
                                        </select>
                                        <!--<a class="point"-->
                                        <!--ng-click="goToSegment(node.segment)"-->
                                        <!--ng-bind="node.segment.label"></a>-->
                                    </div>
                                    <div ng-show="node.type === 'segment'">-</div>
                                    <!--<div ng-show="node.type === 'component' || node.type === 'subcomponent'" ng-bind="node.datatype.label">-->
                                    <!--</div>-->
                                </td>

                                <td class="col-md-1">
                                    <div ng-show="node.type === 'field'">
											<span ng-show="node.table != undefined">
												<div class="btn-group" dropdown>
													<button type="button" ng-click="goToTable(node.table)" class="btn btn-info btn-xs">{{node.table.mappingId}}</button>
      												<button type="button" class="btn btn-info btn-xs dropdown-toggle" dropdown-toggle>
        												<span class="caret"></span>
        												<span class="sr-only">Split button!</span>
      												</button>
      												<ul class="dropdown-menu" role="menu">
        												<li><a ng-click="mapTable(node)">Change Table</a></li>
        												<li><a ng-click="deleteTable(node)">Release Table</a></li>
        												<li class="divider"></li>
        												<li><a ng-click="goToTable(node.table)">Details</a></li>
      												</ul>
    											</div>
                                            </span>
											<span ng-show="node.table == undefined"> 
												<button ng-click="mapTable(node)" class="btn btn-xs btn-info">
													<span><i class="fa fa-plus fa-fw"></i></span>
												</button> 
                                            </span>
                                    </div>

									<div ng-show="node.type === 'component' || node.type === 'subcomponent'">
											<span ng-show="node.table != undefined">
												<div class="btn-group" dropdown>
													<button type="button" ng-click="goToTable(node.table)" class="btn btn-info btn-xs">{{node.table.mappingId}}</button>
    											</div>
                                            </span>
									</div>
											
                                    <div ng-show="node.type === 'segment'">-</div>
                                </td>
                                <td class="col-md-1">
									<div ng-show="node.type === 'field'">
										<button ng-click="managePredicate(node.position)" class="btn btn-xs btn-info">
											<span><i class="fa fa-edit fa-fw"></i></span>
										</button>
										<table>
											<tr ng-repeat="p in segment.predicates">
												<td><div ng-show="p.constraintTarget.indexOf(node.position + '[') === 0"><li>{{p.description}}</li></div></td>
											<tr>
										</table>
									</div>
									<div ng-show="node.type === 'component' || node.type === 'subcomponent'">
										<table>
											<tr ng-repeat="p in findDTByComponentId(node.id).predicates">
												<td><div ng-show="p.constraintTarget.indexOf(node.position + '[') === 0"><li>{{p.description}}</li></div></td>
											<tr>
										</table>
									</div>
									<div ng-show="node.type === 'segment'">-</div>
								</td>
                                <td class="col-md-1">
									<div ng-show="node.type === 'field'">
										<button ng-click="manageConformanceStatement(node.position)" class="btn btn-xs btn-info">
											<span><i class="fa fa-edit fa-fw"></i></span>
										</button>
										<table>
											<tr ng-repeat="c in segment.conformanceStatements">
												<td><div ng-show="c.constraintTarget.indexOf(node.position + '[') === 0"><li>{{c.description}}</li></div></td>
											<tr>
										</table>
									</div>
									<div ng-show="node.type === 'component' || node.type === 'subcomponent'">
										<table>
											<tr ng-repeat="c in findDTByComponentId(node.id).conformanceStatements">
												<td><div ng-show="c.constraintTarget.indexOf(node.position + '[') === 0"><li>{{c.description}}</li></div></td>
											<tr>
										</table>
									</div>
									<div ng-show="node.type === 'segment'">-</div>
								</td>
                                <td class="col-md-1">
                                    <div ng-show="node.type !== 'segment'">
                                        <input style="width:100%" class="igl-input" type="text"
                                               name="comment"
                                               ng-change="recordChange(node,'comment')"
                                               ng-model="node.comment">
                                    </div>
                                    <div ng-show="node.type === 'segment'">-</div>
                                </td>
                            </tr>
                        </script>

							</div>
						</div>

					</form>


				</div>
			</div>
		</div>
	</div>
	<modal title="Edit Predicate" visible="showPredicateManagerModal">
		<form role="form">
		<h5>Predicate of {{segment.name}}.{{selectedPosition}}</h5>
		<div class="table-responsive">
			<table class="table table-striped table-bordered">
				<thead>
					<tr class="tbl-header">
						<th class="col-md-3">Desciption</th>
						<th class="col-md-2">True Usage</th>
						<th class="col-md-2">False Usage</th>
						<th class="col-md-1">Action</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="p in segment.predicates | filter:{constraintTarget:selectedPosition + '[1]'}">
						<td class="col-md-3">{{p.description}}</td>
						<td class="col-md-2">{{p.trueUsage}}</td>
						<td class="col-md-2">{{p.falseUsage}}</td>
						<td class="col-md-1">
							<button type="button" ng-click="deletePredicate(p)" class="btn btn-xs btn-warning">
								<span><i class="fa fa-minus-circle fa-fw"></i></span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<h5>Define New Predicate of {{segment.name}}.{{selectedPosition}}</h5>
			If {{newConstraint.segment}}.
			<select name="field"
            	ng-change="updateField_1()"
                ng-model="newConstraint.field_1"
                ng-options="field as field.position for field in segment.fields">
            </select>
            .<select name="component"
            	ng-change="updateComponent_1()"
                ng-model="newConstraint.component_1"
               	ng-options="component as component.position for component in selectedDTofField_1.children">
            </select>
			.<select name="subComponent"
            	ng-change="updateSubComponent_1()"
                ng-model="newConstraint.subComponent_1"
               	ng-options="subComponent as subComponent.position for subComponent in selectedDTofComponent_1.children">
            </select>
            &nbsp;&nbsp;&nbsp;
            <select name="verb"
            	ng-change=""
                ng-model="newConstraint.verb"
               	ng-options="constraintVerb for constraintVerb in constraintVerbs">
            </select>
            
            <select name="contraintType"
            	ng-change=""
                ng-model="newConstraint.contraintType"
               	ng-options="contraintType for contraintType in contraintTypes">
            </select>
            
            , then TrueUsage of {{segment.name}}.{{selectedPosition}} is 
            <select name="trueUsage"
            	ng-change=""
                ng-model="newConstraint.trueUsage"
               	ng-options="usage for usage in usages">
            </select>
            
            , else FalseUsage of {{segment.name}}.{{selectedPosition}} is 
            <select name="falseUsage"
            	ng-change=""
                ng-model="newConstraint.falseUsage"
               	ng-options="usage for usage in usages">
            </select>
            
            <span class="pull-right">
				<button title="Update Predicate" type="button" class="btn btn-xs btn-info" ng-click="updatePredicate()">
					<span><i class="fa fa-plus-circle fa-fw"></i>&nbsp; Update Predicate</span>
				</button>
			</span>
		</form>
	</modal>
	
	<modal title="Edit ConformanceStatement" visible="showConformanceStatementManagerModal">
		<form role="form">
		<h5>ConformanceStatements of {{segment.name}}.{{selectedPosition}}</h5>
		<div class="table-responsive">
			<table class="table table-striped table-bordered">
				<thead>
					<tr class="tbl-header">
						<th class="col-md-2">ID</th>
						<th class="col-md-9">Desciption</th>
						<th class="col-md-1">Action</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="c in segment.conformanceStatements | filter:{constraintTarget:selectedPosition + '[1]'}">
						<td class="col-md-2">{{c.constraintId}}</td>
						<td class="col-md-9">{{c.description}}</td>
						<td class="col-md-1">
							<button type="button" ng-click="deleteConformanceStatement(c)" class="btn btn-xs btn-warning">
								<span><i class="fa fa-minus-circle fa-fw"></i></span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<h5>Define New Conformance Statement of {{segment.name}}.{{selectedPosition}}</h5>
			ID: 
			<input ng-model="newConstraint.constraintId" placeholder="Type Conformance Statement ID" type="text"/>
			<br/>
		
		
			{{newConstraint.segment}}.
			<select name="field"
            	ng-change="updateField_1()"
                ng-model="newConstraint.field_1"
                ng-options="field as field.position for field in segment.fields">
            </select>
            .<select name="component"
            	ng-change="updateComponent_1()"
                ng-model="newConstraint.component_1"
               	ng-options="component as component.position for component in selectedDTofField_1.children">
            </select>
			.<select name="subComponent"
            	ng-change="updateSubComponent_1()"
                ng-model="newConstraint.subComponent_1"
               	ng-options="subComponent as subComponent.position for subComponent in selectedDTofComponent_1.children">
            </select>
            &nbsp;&nbsp;&nbsp;
            <select name="verb"
            	ng-change=""
                ng-model="newConstraint.verb"
               	ng-options="constraintVerb for constraintVerb in constraintVerbs">
            </select>
            
            <select name="contraintType"
            	ng-change=""
                ng-model="newConstraint.contraintType"
               	ng-options="contraintType for contraintType in contraintTypes">
            </select>
            
            <span class="pull-right">
				<button title="Add Conformance Statement" type="button" class="btn btn-xs btn-info" ng-click="addConformanceStatement()">
					<span><i class="fa fa-plus-circle fa-fw"></i>&nbsp; Add Conformance Statement</span>
				</button>
			</span>
		</form>
	</modal>
	
	<modal title="Select Table" visible="showTableMapModal">
		<div class="row">
		<form role="form">
			<div class="col-sm-6">
				<h5>List of Tables</h5>
				<div class="igl-table">
					<table st-table="displayedTableCollection" st-safe-src="tables" class="table table-striped table-bordered">
						<thead>
							<tr class="tbl-header">
								<th st-sort="mappingId">ID</th>
								<th st-sort="Name">Name</th>
							</tr>
							<tr>
                    			<th colspan="2">
                    				<input st-search="" class="form-control" placeholder="search table..." type="text"/>
                    			</th>
                			</tr>
						</thead>

						<tbody>
							<tr ng-repeat="row in displayedTableCollection">
								<td>
									<a ng-click="selectTable(row)">{{row.mappingId}}</a>
								</td>
								<td ng-bind-html="row.name"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
	 		<div class="col-sm-6">
	 			<span ng-show="selectedTable != undefined">
	 				<button type="button" ng-click="mappingTable()" class="btn btn-warning">Select this Table</button>
	 				<hr />
	 				<div class="row">
  						<div class="col-sm-4">
  							<p>ID:</p>
  							<p>Name:</p>
  							<p>Type:</p>
  							<p>Stability:</p>
  							<p>Extensibility:</p>
  							<p>List of Codes:</p>
  						</div>
  						<div class="col-sm-8">
  							<p>{{selectedTable.mappingId}}</p>
  							<p>{{selectedTable.name}}</p>
  							<p>{{selectedTable.tableType}}</p>
  							<p>{{selectedTable.stability}}</p>
  							<p>{{selectedTable.extensibility}}</p>
  						</div>
					</div>
					<div class="igl-table">
						<table st-table="displayedCodeCollection" st-safe-src="selectedTable.codes" class="table table-striped table-bordered">
							<thead>
								<tr class="tbl-header">
									<th st-sort="Code">Code</th>
									<th st-sort="Label">Label</th>
									<th>Codesys</th>
									<th>Usage</th>
								</tr>
								<tr>
                    				<th colspan="2">
                    					<input st-search="" class="form-control" placeholder="search code..." type="text"/>
                    				</th>
                				</tr>
							</thead>

						<tbody>
							<tr ng-repeat="row in displayedCodeCollection">
								<td ng-bind-html="row.code"></td>
								<td ng-bind-html="row.label"></td>
								<td ng-bind-html="row.codesys"></td>
								<td ng-bind-html="row.codeUsage"></td>
							</tr>
						</tbody>
					</table>
				</div>
					
	 			</span>
	 		</div>
		</form>
		</div>
	</modal>
</div>

</div>






<!--<pre>-->
<!--{{changes | json}}-->
<!--</pre>-->