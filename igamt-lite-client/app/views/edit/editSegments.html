<style id="antiClickjack">
body {
    display: none !important;
}
</style>
<script type="text/javascript">
if (self === top) {
    var antiClickjack = document.getElementById("antiClickjack");
    antiClickjack.parentNode.removeChild(antiClickjack);
} else {
    top.location = self.location;
}
</script>
<script type="text/ng-template" id="EditSegments.html">
    <div ng-controller="SegmentListCtrl
" ng-init="init()" class="container">
        <div ng-show="loadingSelection" style="text-align: center;">
            <i class="fa fa-spinner fa-pulse fa-align-center fa-2x"></i>
        </div>
        <div ng-show="!loadingSelection">
            <div ng-show="segment !== null" id="executionPanel">
                <div class="row" style="margin-left:0px; margin-right: 20px">
                    <div class="page-header" style="margin-bottom: 20px">
                        <span class="header4">Segment: {{getSegmentLabel(segment)}}</span>
                        <span class="pull-right">
         <button title="Save Changes" type="button" class="btn btn-sm btn-primary"
                 ng-disabled="editForm.$invalid || !editForm.$dirty "
                 ng-hide="viewSettings.tableReadonly ||(segment.scope !== 'USER' && segment.scope !== 'MASTER')"
                 ng-click="save()">
             <span><i class="fa fa-check fa-fw"></i> Save</span>
         </button>

                         <button title="Reset Changes" type="button" class="btn btn-sm btn-warning"
                                 ng-disabled="!editForm.$dirty"
                                 ng-hide="viewSettings.tableReadonly || (segment.scope !== 'USER' && segment.scope !== 'MASTER') "
                                 ng-click="reset()">
                             <span><i class="fa fa-times fa-fw"></i> Reset</span>
                         </button>
    </span>
</div>
    <tabset>
        <tab heading="Segment MetaData">
            <div style="margin-top: 20px">
                <div class="form-group control-group"
                    ng-class="{'igl-has-error has-feedback' : editForm.name.$invalid}">
                    <label class="col-md-2 control-label">Name</label>

                    <div class="controls col-md-10">
                        <input type="text" disabled
                           name="identifier"
                           class="form-control"
                           ng-model="segment.name"
                            ng-change="setDirty()"
                           required>
                    </div>
                </div>

                <div class="form-group control-group"
                    ng-class="{'igl-has-error has-feedback' : editForm.ext.$invalid}">
                    <label class="col-md-2 control-label">Extension</label>

                    <div class="controls col-md-10">
                        <input type="text" ng-disabled="viewSettings.tableReadonly || (segment.scope !== 'USER' && segment.scope !== 'MASTER')"
                           class="form-control"
                           ng-change="setDirty()"
                           name="label" class="form-control"
                           ng-model="segment.ext"
                           required required aria-describedby="helpBlock2">
                                    <span id="helpBlock2" class="help-block" style="color:red"
                                          ng-show="isDuplicatedTwoContexts(segment,'name', 'ext', segments)">Extension already used</span>
                    </div>
                </div>


                <div class="form-group control-group"
                     ng-class="{'igl-has-error has-feedback' : editForm.description.$invalid}">
                    <label class="col-md-2 control-label">Description</label>

                    <div class="controls col-md-10">
                        <input type="text" disabled
                           ng-change="setDirty()"
                           name="description"
                           class="form-control"
                           ng-model="segment.description" required>
                    </div>
                </div>


                <div class="form-group control-group"
                    ng-class="{'igl-has-error has-feedback' : editForm.comment.$invalid}">
                    <label class="col-md-2 control-label">Comment</label>
                    <div class="controls col-md-10">
                        <textarea rows="3" cols="20"
                              ng-disabled="viewSettings.tableReadonly || segment.scope === 'HL7STANDARD' || segment.scope === 'MASTER'"
                              ng-change="setDirty()"
                              name="comment" id="comment" class="form-control"
                              ng-model="segment.comment"
                            />
                    </div>
                </div>

                <div class="form-group control-group"
                    ng-class="{'igl-has-error has-feedback' : editForm.text1.$invalid}">
                    <label class="col-md-2 control-label">Definition Pre-Text</label>
                    <div class="controls col-md-10">
                        <div ng-if="!viewSettings.tableReadonly && segment.scope === 'USER'">
                            <textarea froala="froalaEditorOptions" ng-model="segment.text1" id="text1"
                              name="text1"
                              ng-change="setDirty()"></textarea>
                        </div>
                        <div ng-if="viewSettings.tableReadonly || (segment.scope !== 'USER' && segment.scope !== 'MASTER')">
                            <div froala-view="segment.text1"></div>
                        </div>
                    </div>
                </div>

                <div class="form-group control-group"
                    ng-class="{'igl-has-error has-feedback' : editForm.text2.$invalid}">
                    <label class="col-md-2 control-label">Definition Post-Text</label>
                    <div class="controls col-md-10">
                        <div ng-if="!viewSettings.tableReadonly && segment.scope === 'USER'">
                            <textarea froala="froalaEditorOptions" ng-model="segment.text2" id="text2"
                              name="text2"
                              ng-change="setDirty()"></textarea>
                        </div>
                        <div ng-if="viewSettings.tableReadonly || (segment.scope === 'MASTER' || segment.scope === 'HL7STANDARD')">
                            <div class="fr-view">
                                <div froala-view="segment.text2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </tab>

        <tab heading="Segment Definition">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table tt-table tt-params="segmentsParams" class="table table-bordered table-fix-header table-condensed profile-table">
                        <thead>
                        <tr class="tbl-header" style="margin-right: {{scrollbarWidth}}px;">
                            <th class="col-xs-2 col-fixed-250">Name</th>
                            <th class="col-xs-1 col-fixed-80" ng-show="viewSettings.isVisibleColumn('usage')">Usage
                                <button ng-show="(segment.scope === 'USER' || segment.scope === 'MASTER')" class="btn-info"> <span ng-click="OtoX(segment)">(O to X)</span></button>
                            </th>
                            <th class="col-xs-1 col-fixed-100" ng-show="viewSettings.isVisibleColumn('cardinality')">Cardinality
                            </th>
                            <th class="col-xs-1 col-fixed-100" ng-show="viewSettings.isVisibleColumn('length')">Length
                            </th>
                            <th class="col-xs-1 col-fixed-80" ng-show="viewSettings.isVisibleColumn('confLength')">Conformance Length
                            </th>
                            <th class="col-xs-1 col-fixed-100" ng-show="viewSettings.isVisibleColumn('datatype')">Data Type
                            </th>
                            <th class="col-xs-1 col-fixed-130" ng-show="viewSettings.isVisibleColumn('valueSet')">Value Set
                            </th>
                            <th class="col-xs-1" ng-style="predWidth" ng-show="viewSettings.isVisibleColumn('predicate')">Predicate
                            </th>
                            <th class="col-xs-1" ng-style="csWidth" ng-show="viewSettings.isVisibleColumn('confStatement')">Conformance Statement
                            </th>
                            <th class="col-xs-1 col-fixed-80" ng-show="viewSettings.isVisibleColumn('defText')">Definition Text
                            </th>
                            <th class="col-xs-1" ng-style="commentWidth" ng-show="viewSettings.isVisibleColumn('comment')">Comment
                            </th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <span class="pull-right">
                        <div class="btn-group">
                            <button ng-show="segment.scope!=='HL7STANDARD'" ng-click="addFieldModal(segment)" type="button" class="btn btn-info btn-md">
                                <span><i class="glyphicon glyphicon-plus"></i> Add Field</span>
                            </button>
                        </div>
                    </span>
                </div>
            </div>

            <div class="row" style="margin-top:20px">
			    <div class="col-md-12 igl-page-header">
				    <span class="pull-left" >
    				    <span class="header5">Conformance Statements</span>
                    </span>
                    <span class="pull-right">
					    <button class="btn btn-primary btn-xs" ng-click="manageConformanceStatement(null);" ng-hide="viewSettings.tableReadonly || (segment.scope !== 'USER' && segment.scope !== 'MASTER')"><span><i class="fa fa-plus fa-fw">&nbsp; </i>Add Conf.Statement</span></button>
                    </span>
				</div>

                <div class="col-md-12">
				    <span ng-hide="segment.conformanceStatements.length > 0">No conformance statement</span>

                    <table class="table table-striped table-bordered" ng-show="segment.conformanceStatements.length > 0">
                        <thead>
                            <tr class="tbl-header">
                                <th class="col-md-1">ID</th>
                                <th class="col-md-2">Location</th>
                                <th class="col-md-8">Desciption</th>
                                <th class="col-md-1"></th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr ng-repeat="c in segment.conformanceStatements | orderBy:'constraintTarget'"">
                                <td class="col-md-1">{{c.constraintId}}</td>
                                <td class="col-md-2">{{c.constraintTarget}}</td>
                                <td class="col-md-8">{{c.description}}</td>
                                <td class="col-md-1" align="center">
                                    <button class="btn btn-danger btn-xxs" ng-click="segment.conformanceStatements.splice(segment.conformanceStatements.indexOf(c), 1);" ng-disabled="viewSettings.tableReadonly"><span><i class="fa fa-trash fa-fw">&nbsp; </i>Del</span></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="col-md-12 igl-page-header">
                    <span class="pull-left">
                        <span class="header5">Conditional Predicates</span>
                    </span>
                    <span class="pull-right">
                        <button class="btn btn-primary btn-xs" ng-click="managePredicate(null);" ng-disabled="viewSettings.tableReadonly || (segment.scope !== 'USER' && segment.scope !== 'MASTER')"><span><i class="fa fa-plus fa-fw">&nbsp; </i>Add Predicate</span></button>
                    </span>
                </div>

                <div class="col-md-12">
                    <span ng-hide="segment.predicates.length > 0">No conditional predicate</span>

                    <table class="table table-striped table-bordered" ng-show="segment.predicates.length > 0">
                        <thead>
                            <tr class="tbl-header">
                                <th class="col-md-2">Location</th>
                                <th class="col-md-7">Desciption</th>
                                <th class="col-md-1">True usage</th>
                                <th class="col-md-1">False usage</th>
                                <th class="col-md-1"></th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr ng-repeat="p in segment.predicates | orderBy:'constraintTarget'"">
                                <td class="col-md-2">{{p.constraintTarget}}</td>
            					<td class="col-md-7">{{p.description}}</td>
								<td class="col-md-1">{{p.trueUsage}}</td>
								<td class="col-md-1">{{p.falseUsage}}</td>
                                <td class="col-md-1" align="center">
                                    <button class="btn btn-danger btn-xxs" ng-click="segment.predicates.splice(segment.predicates.indexOf(p), 1);" ng-disabled="viewSettings.tableReadonly"><span><i class="fa fa-trash fa-fw">&nbsp; </i>Del</span></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="col-md-12 igl-page-header">
                    <span class="pull-left" >
                        <span class="header5">CoConstraints Table</span>
                    </span>
                    <span class="pull-right">
                        <button class="btn btn-danger btn-xs" ng-click="deleteCoConstraints();" ng-disabled="viewSettings.tableReadonly || (segment.scope !== 'USER' && segment.scope !== 'MASTER')"><span><i class="fa fa-trash fa-fw">&nbsp; </i>Delete CoConstraints</span></button>
                    </span>
                </div>

                <span class="col-md-12">
                    <span class="pull-right">
                            <select class="form-control" name="newColumnField"
                                ng-model="newColumnField"
                                ng-options="field as segment.name + '-' + field.position + ' : ' + field.name for field in segment.fields">
                                <option value="">Select Field</option>
                            </select>
                            <select class="form-control" name="newColumnConstraintType"
                                ng-model="newColumnConstraintType">
                                <option value="">Select Constraint Type</option>
                                <option value="v">Value</option>
                                <option value="vs">Value Set</option>
                            </select>
                            <span class="pull-right">
                                <button class="btn btn-primary btn-xs" ng-click="addColumnCoConstraints(newColumnField, newColumnConstraintType); newColumnField = null; newColumnConstraintType = ''; " ng-disabled="viewSettings.tableReadonly || (segment.scope !== 'USER' && segment.scope !== 'MASTER')"><span><i class="fa fa-plus fa-fw">&nbsp; </i>Add Column for CoConstraints Table</span></button>
                            </span>
                    </span>

                    <span ng-hide="segment.coConstraints.columnList.length > 0">No CoConstraint</span>
                    <table class="table table-striped table-bordered" ng-show="segment.coConstraints.columnList.length > 0">
                        <thead>
                            <tr class="tbl-header">
                                <th ng-repeat="column in segment.coConstraints.columnList">
                                    {{segment.name}}-{{column.field.position}}
                                    <a ng-click="deleteColumn(column)" class="point">
                                        <span style="color:red"><i class="fa fa-times fa-fw"></i></span>
                                    </a>
                                </th>
                                <th class="col-md-2">Description</th>
                                <th class="col-md-2">Comments</th>
                                <th class="col-md-1">
                                    <button class="btn btn-info btn-xs" ng-click="addCoConstraint();" ng-disabled="viewSettings.tableReadonly || (segment.scope !== 'USER' && segment.scope !== 'MASTER')"><span><i class="fa fa-plus fa-fw">&nbsp; </i>Add</span></button>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="cc in segment.coConstraints.constraints">
                                <td ng-repeat="data in cc.values">
                                    <input ng-show="getConstraintType(data, cc) === 'v'" class="form-control" ng-model="data.value" ng-change="recordChange()" type="text"/>
                                    <select ng-show="getConstraintType(data, cc) === 'vs'" ng-model="data.value" class="form-control" ng-change="recordChange()"
                                            ng-options="link.id as tablesMap[link.id].bindingIdentifier for link in igdocument.profile.tableLibrary.children" />
                                </td>
                                <td class="col-md-2">
                                    <input class="form-control" ng-model="cc.description" ng-change="recordChange()" type="text"/>
                                </td>
                                <td class="col-md-2">
                                    <input class="form-control" ng-model="cc.comments" ng-change="recordChange()" type="text"/>
                                </td>
                                <td class="col-md-1">
                                    <button class="btn btn-danger btn-xs" ng-click="deleteCoConstraint(cc);" ng-disabled="viewSettings.tableReadonly || (segment.scope !== 'USER' && segment.scope !== 'MASTER')"><span><i class="fa fa-trash fa-fw">&nbsp; </i>Del</span></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </tab>
    </tabset>
</div>
</div>
</div>
</div>
</script>

<script type="text/ng-template " id="SegmentEditTree.html ">
    <tr tt-node is-branch="hasChildren(node) " ng-show="isVisible(node) ">
        <td class="col-xs-2 col-fixed-250 ">

            <span ng-if="node.type==='field' " class="label label-field label-icon ">F</span>
            <span ng-if="node.type==='component' " class="label label-component label-icon ">C</span>
            <span ng-if="node.type==='subcomponent' " class="label label-sub-component label-icon ">S</span>

            <span style="width:60% ">{{node.name}}:</span>
            <span ng-bind="node.description "></span>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'usage') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'cardinality') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'length') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'confLength') ">
            <div>-</div>
        </td>

        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'datatype') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-130 " ng-show="viewSettings.isVisibleColumn( 'valueSet') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 " ng-style="predWidth " ng-show="viewSettings.isVisibleColumn( 'predicate') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 " ng-style="csWidth " ng-show="viewSettings.isVisibleColumn( 'confStatement') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'defText') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 " ng-style="commentWidth " ng-show="viewSettings.isVisibleColumn( 'comment') ">
            <div>-</div>
        </td>
    </tr>
</script>

<script type="text/ng-template " id="SegmentReadTree.html ">
    <tr tt-node is-branch="hasChildren(node) " ng-show="isVisible(node) ">
        <td class="col-xs-2 col-fixed-250 ">
            <span ng-if="node.type==='field' " class="label label-field label-icon ">F</span>
            <span ng-if="node.type==='component' " class="label label-component label-icon ">C</span>
            <span ng-if="node.type==='subcomponent' " class="label label-sub-component label-icon ">S</span>
            <span style="width:60% ">{{node.name}}:</span>
            <span ng-bind="node.description "></span>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'usage') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'cardinality') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'length') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'confLength') ">
            <div>-</div>
        </td>

        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'datatype') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-130 " ng-show="viewSettings.isVisibleColumn( 'valueSet') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 " ng-style="predWidth " ng-show="viewSettings.isVisibleColumn( 'predicate') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 " ng-style="csWidth " ng-show="viewSettings.isVisibleColumn( 'confStatement') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'defText') ">
            <div>-</div>
        </td>
        <td class="col-xs-1 " ng-style="commentWidth " ng-show="viewSettings.isVisibleColumn( 'comment') ">
            <div>-</div>
        </td>
    </tr>
</script>


<script type="text/ng-template" id="SegmentCaseReadTree.html">
    <tr tt-node is-branch="hasChildren(node)" ng-show="isVisible(node)">
        <td class="col-xs-2 col-fixed-250">

            <span ng-if="node.type === 'case'" class="label label-dynamicCase label-icon">D</span>
            <span ng-bind="node.value"></span>
        </td>
        <td class="col-xs-1 col-fixed-80" ng-show="viewSettings.isVisibleColumn('usage')">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-100" ng-show="viewSettings.isVisibleColumn('cardinality')">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-100" ng-show="viewSettings.isVisibleColumn('length')">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-80" ng-show="viewSettings.isVisibleColumn('confLength')">
            <div>-</div>
        </td>

        <td class="col-xs-1 col-fixed-100" ng-show="viewSettings.isVisibleColumn('datatype')">
            {{getDatatypeLabel(datatypesMap[node.datatype])}}
        </td>
        <td class="col-xs-1 col-fixed-130" ng-show="viewSettings.isVisibleColumn('valueSet')">
            <div>-</div>
        </td>
        <td class="col-xs-1" ng-style="predWidth" ng-show="viewSettings.isVisibleColumn('predicate')">
            <div>-</div>
        </td>
        <td class="col-xs-1" ng-style="csWidth" ng-show="viewSettings.isVisibleColumn('confStatement')">
            <div>-</div>
        </td>
        <td class="col-xs-1 col-fixed-80" ng-show="viewSettings.isVisibleColumn('defText')">
            <div>-</div>
        </td>
        <td class="col-xs-1" ng-style="commentWidth" ng-show="viewSettings.isVisibleColumn('comment')">
            <div>-</div>
        </td>
    </tr>
</script>



<script type="text/ng-template" id="SegmentFieldEditTree.html">
     <tr tt-node is-branch="hasChildren(node) " ng-show="(isVisible(node) &&( node.usage==='R' ||node.usage==='RE' ||node.usage==='C' )&& $root.usageF) || (isVisible(node) && !$root.usageF) "
        ng-class="{ 'new': isChildNew(node), 'selected': isChildSelected(node)} ">
        <td class="col-xs-2 col-fixed-250 " ng-controller="DatatypeRowCtrl ">
        <a ng-show="editableField!==node.id " ng-click="editField(node) " class="point ">
                    <span><i class="fa fa-pencil fa-fw "></i></span>
            </a>
            <a ng-show="editableField!==node.id " ng-click="deleteField(node,segment) " class="point ">
                    <span><i class="glyphicon glyphicon-trash "></i></span>
            </a>
            <ng-form name="{{formName}} " class="form-inline ">
                <!--<input type="checkbox " ng-checked="isChildSelected(node) " ng-click="selectChild($event,node) ">-->
                <span class="label label-field label-icon ">F</span>

            <span ng-show="editableField!==node.id ">
                <span ng-hide="isChildNew(node) "
                      tooltip-html="getFieldNodeName(node) " tooltip-append-to-body="true "
                      tooltip-class="constraints-tooltip " ng-bind-html="getFieldNodeName(node) " tooltip-trigger
                      tooltip-animation="false " tooltip-placement="left "
                        ></span>
                 <span ng-show="isChildNew(node) ">
                      {{node.position}}.
                    <input
                            class="form-control focus "
                            autofocus
                            style="width:65% "
                            name="name "
                            ng-change="recordDatatypeChange( 'field', 'edit',node.id, 'name', node.name) "
                            ng-class="{ 'igl-has-error has-feedback' : {{formName}}.name.$invalid} "
                            ng-model="node.name " required>
            </span>
            </span >
            <span ng-show="editableField===node.id ">
             <select  ng-model="position " ng-change="selectPos() "  style="width:15% " class="form-control input-sm ">
                    <option ng-repeat="child in segment.fields "  ng-selected="node.position===child.position "> {{child.position}}
                </select>
            

            <input  style="width:55% " class="form-control "  ng-model="fieldName " type="text "/>
            </span>

            <div align="center ">

               
            <a ng-show="editableField===node.id && fieldName "  ng-click="applyField(segment,node,fieldName,position) " class="point ">
                    <span><i class="glyphicon glyphicon-ok "></i></span>
            </a>
            <a ng-show="editableField===node.id "  ng-click="backField() " class="point ">
                    <span><i class="glyphicon glyphicon-remove "></i></span>
            </a>
            </div>
            </ng-form>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'usage') ">
            <div class="form-inline ">
                <span ng-show="node.usage !=='C' || (node.usage==='C' && countPredicate(node.position)===0 ) ">
                    <select class="form-control input-sm " name="usage "
                            ng-change="setUsage(node) "
                            required ng-model="node.usage " ng-options="usage for usage in config.usages "/>
                </span>

                <div ng-show="node.usage==='C' && countPredicate(node.position) !==0 ">
                    <p ng-repeat="p in segment.predicates | filter:{constraintTarget:node.position + '[1]'}:true ">
                        C({{p.trueUsage}}/{{p.falseUsage}})
                    </p>
                </div>
            </div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'cardinality') ">
            <div ng-controller="SegmentRowCtrl ">
                                            <span ng-form name="{{formName}} " class="form-inline ">
                                                <input style="width:45% " class="form-control "
                                                       name="min "
                                                       ng-change="setDirty() "
                                                       ng-pattern="/^\d+$/ "
                                                       ng-class="{ 'has-error' : {{formName}}.min.$invalid} "
                                                       ng-model="node.min " required ng-minlength="1 ">
                                                <input style="width:45% " class="form-control " type="text "
                                                       name="max "
                                                       ng-change="setDirty() "
                                                       ng-class="{ 'has-error' : {{formName}}.max.$invalid} "
                                                       ng-pattern="/^\d+$|^\*?$/ "
                                                       ng-model="node.max " required>
                                            </span>
            </div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'length') ">
            <div ng-controller="SegmentRowCtrl ">
                                            <span ng-form name="{{formName}} " class="form-inline ">
                                                <input style="width:45% " class="form-control "
                                                       name="minLength "
                                                       ng-change="setDirty() "
                                                       ng-pattern="/^\d+$/ "
                                                       ng-class="{ 'has-error' : {{formName}}.minLength.$invalid} "
                                                       ng-model="node.minLength " required ng-minlength="1 ">
                                                <input style="width:45% " class="form-control " type="text "
                                                       name="maxLength "
                                                       ng-change="setDirty() "
                                                       ng-class="{ 'has-error' : {{formName}}.maxLength.$invalid} "
                                                       ng-pattern="/^\d+$|^\*?$/ "
                                                       ng-model="node.maxLength " required>
                                            </span>
            </div>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'confLength') ">
            <div ng-controller="SegmentRowCtrl ">
                                            <span ng-form name="{{formName}} " class="form-inline ">
                                            <input style="width:50% " class="form-control " type="text "
                                                   name="confLength "
                                                   ng-change="setDirty() "
                                                   ng-class="{ 'has-error' : {{formName}}.confLength.$invalid} "
                                                   ng-pattern="/^\d+$/ "
                                                   ng-model="node.confLength ">
                                            </span>
            </div>
        </td>

        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'datatype') " class="form-inline ">
            <!--<select class="form-control input-sm "-->
            <!--name="segment "-->
            <!--ng-change="onDatatypeChange(node) "-->
            <!--required-->
            <!--ng-model="node.datatype "-->
            <!--ng-selected="dt.id===n ode.datatype "-->
            <!--ng-options="dt.id as dt.label for dt in datatypes | flavors:datatypesMap[node.datatype.id].name ">-->
            <!--</select>-->

            <a  class="point " ng-show="editableDT!==node.id " ng-click="redirectDT(node.datatype)">
                {{getDatatypeLabel(datatypesMap[node.datatype.id])}}
            </a>
           
            <div ng-show="editableDT===node.id " >
            <select  ng-model="datatype "  ng-change="selectDT() "  class="form-control input-sm ">
                <option ng-repeat="datatype in results "   value="{{datatype}} " ng-selected="node.datatype.ext===datatype.ext "> {{getDatatypeLabel(datatype)}} FROM {{datatype.libraryName}}</option>
            </select>
            

            </div>
            <div align="center ">
            <a ng-show="editableDT===node.id && DTselected "ng-click="applyDT(node,datatype) " >
                    <span><i class="glyphicon glyphicon-ok "></i></span>
            </a>
            <a ng-show="editableDT===node.id "ng-click="backDT() " class="point ">
                    <span><i class="glyphicon glyphicon-remove "></i></span>
            </a>
            </div>
           
              <a ng-show="editableDT!==node.id "ng-click="editDT(node) " class="point ">
                    <span><i class="fa fa-pencil fa-fw "></i></span>
            </a>
            
                
           

            <a ng-show="datatypesMap[node.datatype.id].name === 'varies'" ng-click="showEditDynamicMappingDlg(node)" class="point">
                <span><i class="glyphicon glyphicon-link"></i></span>
            </a>

        </td>






        <td class="col-xs-1 col-fixed-130 " ng-show="viewSettings.isVisibleColumn( 'valueSet') " style="text-align:center ">
            <div ng-show="node.table !=undefined && node.table !==null ">
                <a ng-show="editableVS!==node.id "  class="point " ng-click="redirectVS(node.table)">
                    <span>{{getTableLabel(tablesMap[node.table.id])}}</span>
                </a>
                 <a ng-show="editableVS!==node.id " ng-click="editVS(node) " class="point ">
                    <span><i class="fa fa-pencil fa-fw "></i></span>
            </a>
                <a ng-show="editableVS!==node.id " ng-click="deleteTable(node) " class="point ">
                    <span><i class="glyphicon glyphicon-trash "></i></span>
                </a>
            </div>

            <input  class="form-control col-md-4 "  type="text " ng-model="searchVS.name " ng-hide="editableVS!==node.id || VSselected " />
            <li   class="form-control col-md-4 " ng-show="editableVS===node.id && VSselected ">
                {{selectedValueSet.name}}
                <button type="button " class="close " aria-label="Close " ng-click="unselectVS() ">
                    <span aria-hidden="true ">&times;</span>
                </button>
            </li>
            <div ng-if="searchVS.name && !VSselected && editableVS===node.id ">
                <li  class="form-control col-md-4 " ng-class="{ 'active':isActive(valueSet.id)} " ng-click="selectVS(valueSet) " ng-repeat="valueSet in tables | filter:searchVS ">
                    {{valueSet.name}}
                </li>
            </div>
            <div align="center ">
            <a ng-show="editableVS===node.id && VSselected "ng-click="applyVS(node,valueSet) " >
                    <span><i class="glyphicon glyphicon-ok "></i></span>
            </a>
            
            <a ng-show="editableVS===node.id "ng-click="backVS() " class="point ">
                    <span><i class="glyphicon glyphicon-remove "></i></span>
            </a>
            </div>







            <div ng-show="(node.table==undefined || node.table===null) && isAvailableDTForTable(datatypesMap[node.datatype.id]) ">
                <a ng-click="mapTable(node) " class="point ">
                    <span><i class="fa fa-plus fa-fw "></i></span>
                </a>
            </div>
        </td>
        <td class="col-xs-1 " ng-style="predWidth " ng-show="viewSettings.isVisibleColumn( 'predicate') ">
            <div>
                <div ng-show="countPredicate(node.position)===0 && node.usage==='C' ">
                    <a ng-click="managePredicate(node) " class="point ">
                        <i class="fa fa-plus fa-fw "></i>

                        <p class="warning ">Need predicate</p>
                    </a>
                </div>
                <div ng-show="countPredicate(node.position) !==0 && node.usage==='C' ">
                    <p ng-repeat="p in segment.predicates | filter:{constraintTarget:node.position + '[1]'}:true ">
                        <a ng-click="managePredicate(node) " tooltip-html="getPredicateAsString(p) "
                           tooltip-append-to-body="true "
                           tooltip-class="constraints-tooltip " ng-bind-html="getPredicateAsString(p) " tooltip-trigger
                           tooltip-animation="false " tooltip-placement="left "></a>
                    </p>
                </div>
            </div>
        </td>
        <td class="col-xs-1 " ng-style="csWidth " ng-show="viewSettings.isVisibleColumn( 'confStatement') ">
            <div ng-show="countConformanceStatements(node.position)==0 ">
                <a ng-click="manageConformanceStatement(node) " class="point ">
                    <span><i class="fa fa-plus fa-fw "></i></span>
                </a>
            </div>

            <p ng-repeat="c in segment.conformanceStatements | filter:{constraintTarget:node.position + '[1]'}:true ">
                <a ng-click="manageConformanceStatement(node) "
                   tooltip-html="getConformanceStatementAsString(c) " tooltip-append-to-body="true "
                   tooltip-class="constraints-tooltip " ng-bind-html="getConformanceStatementAsString(c) " tooltip-trigger
                   tooltip-animation="false " tooltip-placement="left "></a>
            </p>
        </td>

        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'defText') " style="text-align:center ">
            <div>
                <a ng-click="openRichTextDlg(node, 'text', 'Definition Text', false) "
                   class="point ">
                    <i class="fa fa-pencil fa-fw " ng-show="node.text !=='' && node.text !==null "></i>
                    <i class="fa fa-plus fa-fw " ng-show="node.text==='' || node.text===null "></i>
                </a>
                <a ng-click="node.text='' " ng-show="node.text !=='' && node.text !==null ">
                    <i class="fa fa-times fa-fw "></i>
                </a>
            </div>
        </td>

        <td class="col-xs-1 " ng-style="commentWidth " ng-show="viewSettings.isVisibleColumn( 'comment') "
            style="text-align:center ">
            <a
                    ng-show="node.comment===null || node.comment==undefined || node.comment=='' "
                    ng-click="node.comment=' ' " class="point ">
                <i class="fa fa-plus fa-fw "></i>
            </a>
            <textarea style="width:100%;height:100% "
                      class="form-control "
                      ng-model="node.comment "
                      ng-change="setDirty() "
                      ng-show="node.comment !==null && node.comment !=undefined && node.comment !='' ">
            </textarea>
            <a
                    ng-show="node.comment !==null && node.comment !==undefined && node.comment !='' "
                    ng-click="node.comment=null "
                    class="point ">
                <i class="fa fa-times fa-fw "></i>
            </a>

        </td>
    </tr>
</script>

<script type="text/ng-template " id="SegmentFieldReadTree.html ">
    <tr tt-node is-branch="hasChildren(node) " ng-show="isVisible(node) ">

        <td class="col-xs-2 col-fixed-250 ">
            <span ng-if="node.type==='field' " class="label label-field label-icon ">F</span>
            <span ng-if="node.type==='component' " class="label label-component label-icon ">C</span>
            <span ng-if="node.type==='subcomponent' " class="label label-sub-component label-icon ">S</span>
             <span
                     tooltip-html="getFieldNodeName(node) " tooltip-append-to-body="true "
                     tooltip-class="constraints-tooltip " ng-bind-html="getFieldNodeName(node) " tooltip-trigger
                     tooltip-animation="false " tooltip-placement="left "
                     ></span>
        </td>

        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'usage') ">
            <div>
                <span ng-show="node.usage !=='C' || (node.usage==='C' && countPredicate(node.position)===0 ) ">
                    <span>{{node.usage}}</span>
                </span>

                <div ng-show="node.usage==='C' && countPredicate(node.position) !==0 ">
                    <p ng-repeat="p in datatype.predicates | filter:{constraintTarget:node.position + '[1]'}:true ">
                        C({{p.trueUsage}}/{{p.falseUsage}})
                    </p>
                </div>
            </div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'cardinality') ">
            [{{::node.min}}, {{::node.max}}]
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'length') ">
            [{{::node.minLength}}, {{::node.maxLength}}]
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'confLength') ">
            {{::node.confLength}}
        </td>

        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'datatype') ">
            <span ng-click="redirectDT(node.datatype) ">{{::getDatatypeLabel(datatypesMap[node.datatype.id])}}
            </span>
        </td>
        <td class="col-xs-1 col-fixed-130 " ng-show="viewSettings.isVisibleColumn( 'valueSet') ">
            <a ng-click="redirectVS(node.table) " class="point "
               ng-show="node.table !=undefined && node.table !==null ">
                {{::getTableLabel(tablesMap[node.table.id])}}
            </a>
        </td>
        <td class="col-xs-1 " ng-style="predWidth " ng-show="viewSettings.isVisibleColumn( 'predicate') ">
            <p ng-repeat="p in segment.predicates | filter:{constraintTarget:node.position + '[1]'}:true ">
                <span
                        tooltip-html="getPredicateAsString(p) " tooltip-append-to-body="true "
                        tooltip-class="constraints-tooltip " ng-bind-html="getPredicateAsString(p) " tooltip-trigger
                        tooltip-animation="false " tooltip-placement="left "/>
            </p>
        </td>
        <td class="col-xs-1 " ng-style="csWidth " ng-show="viewSettings.isVisibleColumn( 'confStatement') ">
            <p ng-repeat="c in segment.conformanceStatements | filter:{constraintTarget:node.position + '[1]'}:true ">
                <span
                        tooltip-html="getConformanceStatementAsString(c) " tooltip-append-to-body="true "
                        tooltip-class="constraints-tooltip " ng-bind-html="getConformanceStatementAsString(c) "
                        tooltip-trigger
                        tooltip-animation="false " tooltip-placement="left "></span>
            </p>
        </td>

        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'defText') ">
            <a ng-click="openRichTextDlg(node, 'text', 'Definition Text', false) "
               class="point ">
                <i class="fa fa-pencil fa-fw "></i>
            </a>
            <a ng-click="node.text='' " ng-show="node.text !=='' && node.text !==null ">
                <i class="fa fa-times fa-fw "></i>
            </a>
        </td>

        <td class="col-xs-1 " ng-style="commentWidth " ng-show="viewSettings.isVisibleColumn( 'comment') ">
            <span class="form-control " style="width:100%;height:100% " ng-bind="node.comment "
                  ng-show="node.comment !=='' && node.comment !==null " disabled>
            </span>
        </td>
    </tr>
</script>

<script type="text/ng-template " id="SegmentComponentEditTree.html ">
    <tr tt-node is-branch="hasChildren(node) " ng-show="isVisible(node) ">
        <td class="col-xs-2 col-fixed-250 ">
                             <span>
                                 <span ng-if="node.type==='field' " class="label label-field label-icon ">F</span>
             <span ng-if="node.type==='component' " class="label label-component label-icon ">C</span>
            <span ng-if="node.type==='subcomponent' " class="label label-sub-component label-icon ">S</span>
                                  <span
                                          tooltip-html="getComponentNodeName(node) " tooltip-append-to-body="true "
                                          tooltip-class="constraints-tooltip " ng-bind-html="getComponentNodeName(node) "
                                          tooltip-trigger
                                          tooltip-animation="false " tooltip-placement="left "
                                          ></span>
                                 </span>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'usage') ">
            <span ng-show="node.usage !=='C' || (node.usage==='C' && countPredicateOnComponent(node.position, node.id)===0 ) ">
                {{node.usage}}
            </span>

            <div ng-show="node.usage==='C' && countPredicateOnComponent(node.position, node.id) !==0 ">
                <p ng-repeat="p in parentsMap[node.id].predicates | filter:{constraintTarget:node.position + '[1]'}:true ">
                    C({{p.trueUsage}}/{{p.falseUsage}})
                </p>
            </div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'cardinality') ">
            <div>
                -
            </div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'length') ">
            <div>
                [{{node.minLength}},{{node.maxLength}}]
            </div>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'confLength') ">
            <div ng-bind="node.confLength ">
            </div>
        </td>

        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'datatype') ">
            <div>
                <span ng-click="redirectDT(node.datatype)">{{getDatatypeLabel(datatypesMap[node.datatype.id])}}</span>
            </div>
        </td>
        <td class="col-xs-1 col-fixed-130 " ng-show="viewSettings.isVisibleColumn( 'valueSet') ">
            <div>
                <span ng-show="node.table !=undefined && node.table !=null ">
                    <a  ng-click="redirectVS(node.table) " class="point ">
                        <span>{{getTableLabel(tablesMap[node.table.id])}}</span>
                    </a>
                </span>
            </div>

            <div ng-show="node.type==='segment' ">-</div>
        </td>
        <td class="col-xs-1 " ng-style="predWidth " ng-show="viewSettings.isVisibleColumn( 'predicate') ">
            <div>
                <p ng-repeat="p in parentsMap[node.id].predicates | filter:{constraintTarget:node.position + '[1]'}:true "
                   tooltip-html="getPredicateAsString(p) " tooltip-append-to-body="true "
                   tooltip-class="constraints-tooltip " ng-bind-html="getPredicateAsString(p) " tooltip-trigger
                   tooltip-animation="false " tooltip-placement="left ">
                </p>
            </div>
        </td>
        <td class="col-xs-1 " ng-style="csWidth " ng-show="viewSettings.isVisibleColumn( 'confStatement') ">
            <div>
                <p ng-repeat="c in parentsMap[node.id].conformanceStatements | filter:{constraintTarget:node.position + '[1]'}:true "
                   tooltip-html="getConformanceStatementAsString(c) " tooltip-append-to-body="true "
                   tooltip-class="constraints-tooltip " ng-bind-html="getConformanceStatementAsString(c) " tooltip-trigger
                   tooltip-animation="false " tooltip-placement="left ">
                </p>
            </div>
        </td>

        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'defText') ">
            <div>
                <a ng-click="openRichTextDlg(node, 'text', 'Definition Text', true) "
                   class="point ">
                    <i class="fa fa-eye fa-fw "></i>
                </a>
            </div>
        </td>
        <td class="col-xs-1 " ng-style="commentWidth " ng-show="viewSettings.isVisibleColumn( 'comment') ">
            <span class="form-control " style="width:100%;height:100% " ng-bind="node.comment " disabled
                  ng-show="node.comment !=null && node.comment !='' ">
            </span>
        </td>
    </tr>
</script>

<script type="text/ng-template " id="SegmentComponentReadTree.html ">
    <tr tt-node is-branch="hasChildren(node) " ng-show="isVisible(node) ">
        <td class="col-xs-2 col-fixed-250 ">
                             <span>
                                <span ng-if="node.type==='field' " class="label label-field label-icon ">F</span>
            <span ng-if="node.type==='component' " class="label label-component label-icon ">C</span>
            <span ng-if="node.type==='subcomponent' " class="label label-sub-component label-icon ">S</span>
                                   <span
                                           tooltip-html="getComponentNodeName(node) " tooltip-append-to-body="true "
                                           tooltip-class="constraints-tooltip " ng-bind-html="getComponentNodeName(node) "
                                           tooltip-trigger
                                           tooltip-animation="false " tooltip-placement="left "
                                           ></span>
                                 </span>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'usage') ">
            <span ng-show="node.usage !=='C' || (node.usage==='C' && countPredicateOnComponent(node.position, node.id)===0 ) ">
                {{node.usage}}
            </span>

            <div ng-show="node.usage==='C' && countPredicateOnComponent(node.position, node.id) !==0 ">
                <p ng-repeat="p in parentsMap[node.id].predicates | filter:{constraintTarget:node.position + '[1]'}:true ">
                    C({{p.trueUsage}}/{{p.falseUsage}})
                </p>
            </div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'cardinality') ">
            <div>
                -
            </div>
        </td>
        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'length') ">
            <div>
                [{{::node.minLength}},{{::node.maxLength}}]
            </div>
        </td>
        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'confLength') ">
            <div ng-bind="node.confLength ">
            </div>
        </td>

        <td class="col-xs-1 col-fixed-100 " ng-show="viewSettings.isVisibleColumn( 'datatype') ">
            <span ng-click="redirectDT(node.datatype) ">{{::getDatatypeLabel(datatypesMap[node.datatype.id])}}
            </span>
        </td>
        <td class="col-xs-1 col-fixed-130 " ng-show="viewSettings.isVisibleColumn( 'valueSet') ">
            <a type="button " ng-click="redirectVS(node.table) "
               ng-show="node.table !=undefined && node.table !=null "
               class="point ">
                {{::getTableLabel(tablesMap[node.table.id])}}
            </a>
        </td>

        <td class="col-xs-1 " ng-style="predWidth " ng-show="viewSettings.isVisibleColumn( 'predicate') ">
            <div>
                <p ng-repeat="p in parentsMap[node.id].predicates | filter:{constraintTarget:node.position + '[1]'}:true "
                   tooltip-html="getPredicateAsString(p) " tooltip-append-to-body="true "
                   tooltip-class="constraints-tooltip " ng-bind-html="getPredicateAsString(p) " tooltip-trigger
                   tooltip-animation="false " tooltip-placement="left ">
                </p>
            </div>
        </td>
        <td class="col-xs-1 " ng-style="csWidth " ng-show="viewSettings.isVisibleColumn( 'confStatement') ">
            <div>
                <p ng-repeat="c in parentsMap[node.id].conformanceStatements | filter:{constraintTarget:node.position + '[1]'}:true "
                   tooltip-html="getConformanceStatementAsString(c) " tooltip-append-to-body="true "
                   tooltip-class="constraints-tooltip " ng-bind-html="getConformanceStatementAsString(c) " tooltip-trigger
                   tooltip-animation="false " tooltip-placement="left ">
                </p>
            </div>
        </td>

        <td class="col-xs-1 col-fixed-80 " ng-show="viewSettings.isVisibleColumn( 'defText') ">
            <a ng-show="node.text !=null "
               ng-click="openRichTextDlg(node, 'text', 'Definition Text', true) "
               class="point ">
                <i class="fa fa-eye fa-fw "></i>
            </a>
        </td>
        <td class="col-xs-1 " ng-style="commentWidth " ng-show="viewSettings.isVisibleColumn( 'comment') ">
            <span class="form-control " style="width:100%;height:100% " ng-bind="node.comment "
                  ng-show="node.comment !=='' && node.comment !==null " disabled>
            </span>
        </td>
    </tr>
</script>

<script type="text/ng-template " id="ConformanceStatementSegmentCtrl.html ">
<div class="modal-header ">
    <h3 ng-show="selectedNode===null " class="header4 ">Conformance statement for {{segment.name}}</h3>
    <h3 ng-show="selectedNode !==null " class="header4 ">Conformance statement for {{segment.name}}}-{{selectedNode.position}}</h3>
</div>
<div class="modal-body ">
    <form role="form ">
        <span class="pull-right ">
            <select class="form-control input-sm " ng-model="selectedNode " ng-options="field as (segment.name + '-' + field.position + ': ' + field.name) for field in segment.fields ">
                <option value=" ">Root of {{segment.name}}</option>
            </select>
        </span>
<div class="table-responsive ">
    <div class="page-header ">
        <span class="header5 ">List of conformance statments</span>
    </div>
    <table class="table table-striped table-bordered ">
        <thead>
        <tr class="tbl-header ">
            <th class="col-md-1 " style="width: 4.1667% ">Draggable</th>
            <th class="col-md-2 ">ID</th>
            <th class="col-md-8 ">Desciption ( <input type="checkbox " ng-model="viewAssertion "> view assertion )</th>
            <th class="col-md-1 "></th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="c in tempComformanceStatements | filter:{constraintTarget:selectedNode==null ? '.' : selectedNode.position + '[1]'}:true ">
            <td class="col-md-1 " align="center " style="width: 4.1667% ">
                <i class="fa fa-bullseye fa-lg " data-drag="true " data-jqyoui-options="{revert: 'invalid',helper: 'clone'} " ng-model="c " jqyoui-draggable="{placeholder: 'keep',animate:true} "></i>
            </td>
            <td class="col-md-2 ">
                <input class="form-control form-control-short80 " ng-model="c.constraintId " ng-change="setChanged(); targetId=c .constraintId; " type="text " ng-readonly="targetId !==c .constraintId "/>
                <i class="fa fa-pencil " ng-hide="targetId==c .constraintId " ng-click="targetId=c .constraintId; conformanceStatementIdList.splice(conformanceStatementIdList.indexOf(c.constraintId), 1); "></i>
                <i class="fa fa-paper-plane " ng-hide="targetId !=c .constraintId || conformanceStatementIdList.indexOf(c.constraintId) !=- 1 " ng-click="conformanceStatementIdList.push(c.constraintId); targetId='' "></i>
                <span style="color:red " ng-show="conformanceStatementIdList.indexOf(c.constraintId) !=- 1 && targetId==c .constraintId ">Duplicated ID</span>
            </td>
            <td class="col-md-8 ">
                <input class="form-control " ng-model="c.description " ng-change="setChanged() " type="text "/>
                <span ng-show="viewAssertion ">{{c.assertion}}</span>
            </td>
            <td class="col-md-1 " align="center ">
                <button class="btn btn-danger btn-xxs " ng-click="deleteConformanceStatement(c) "><span><i class="fa fa-trash fa-fw ">&nbsp; </i>Del</span></button>
            </td>
        </tr>
        </tbody>
    </table>

        <span class="pull-left ">
            <span class="header5 " ng-show="constraintType==='Plain' ">Add new plain conformance statement</span>
            <span class="header5 " ng-show="constraintType==='Complex' ">Add new complex conformance statement</span>
        </span>

        <span class="pull-right ">
            <div class="btn-group btn-group-sm " data-toggle="buttons ">
                <label class="btn btn-primary btn-xs " ng-click="constraintType='Plain' ; newConstraint.constraintId=c alNextCSID(); " ng-class="{ 'active':constraintType==='Plain' } ">
                    <input type="radio " ng-value="constraintType ">Add new plain Conf.Statement
                </label>
                <label class="btn btn-primary btn-xs " ng-click="constraintType='Complex' ; newComplexConstraintId=c alNextCSID(); " ng-class="{ 'active':constraintType==='Complex' } ">
                    <input type="radio " ng-value="constraintType ">Add new complex Conf.Statement
                </label>
            </div>
        </span>
    
        <table class="table table-striped table-bordered " ng-show="constraintType==='Plain' "> 
            <thead>
                <tr class="tbl-header ">
                    <th class="col-md-1 " style="width: 4.1667% "></th>
                    <th class="col-md-2 ">ID</th>
                    <th class="col-md-2 ">Node</th>
                    <th class="col-md-2 ">Verb</th>
                    <th class="col-md-2 ">Constraint Pattern</th>
                    <th class="col-md-2 ">Value</th>
                    <th class="col-md-1 "></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="col-md-1 " style="width: 4.1667% " align="center ">
                        <button class="btn btn-info btn-xxs " ng-click="initConformanceStatement() "><span><i class="fa fa-refresh fa-fw ">&nbsp; </i>Reset</span></button>
                    </td>
                    <td class="col-md-2 ">
                        <input class="form-control form-control-short80 " ng-class="{ 'form-control-invalid': isEmptyConstraintID(newConstraint) || isDuplicatedConstraintID(newConstraint, targetPlainId)} " 
                            ng-model="newConstraint.constraintId " ng-change="targetPlainId=n ewConstraint.constraintId; " type="text " ng-readonly="targetPlainId !==n ewConstraint.constraintId "/>
                        <i class="fa fa-pencil " ng-hide="targetPlainId==n ewConstraint.constraintId " ng-click="targetPlainId=n ewConstraint.constraintId; "></i>
                        <i class="fa fa-paper-plane " ng-hide="targetPlainId !=n ewConstraint.constraintId || conformanceStatementIdList.indexOf(newConstraint.constraintId) !=- 1 " ng-click="conformanceStatementIdList.push(newConstraint.constraintId); targetPlainId='' "></i>
                        <span style="color:red; " ng-show="isEmptyConstraintID(newConstraint) ">ID Empty</span>
                        <span style="color:red; " ng-show="isDuplicatedConstraintID(newConstraint, targetPlainId) ">ID Duplicated</span>
                    </td>
                    <td class="col-md-2 ">
                        <span>{{newConstraint.segment}}-</span>
                        <select class="form-control form-control-short " ng-class="{ 'form-control-invalid': isEmptyConstraintNode(newConstraint, 'segment')} " ng-change="updateField_1() " ng-model="newConstraint.field_1 " placeholder="Field " ng-options="field as field.position for field in segment.fields "/>

                        <span ng-show="datatypesMap[newConstraint.field_1.datatype].components.length> 0">.
                                                <select class="form-control form-control-short" placeholder="Component" ng-change="updateComponent_1()" ng-model="newConstraint.component_1" ng-options="component as component.position for component in datatypesMap[newConstraint.field_1.datatype].components">
                                                </select>
                                                </span>
                                                <span ng-show="datatypesMap[newConstraint.component_1.datatype].components.length > 0">.
                            <select class="form-control form-control-short"
                                    placeholder="SubComponent"
                                    ng-model="newConstraint.subComponent_1"
                                    ng-options="subComponent as subComponent.position for subComponent in datatypesMap[newConstraint.component_1.datatype].components">
                            </select>
                        </span>
                                                <span style="color:red;" ng-show="isEmptyConstraintNode(newConstraint, 'segment')">Empty node</span>
                                                </td>
                                                <td class="col-md-2">
                                                    <select class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintVerb(newConstraint)}" ng-model="newConstraint.verb" ng-options="constraintVerb for constraintVerb in config.constraintVerbs | orderBy:'toString()'" />
                                                    <span style="color:red;" ng-show="isEmptyConstraintVerb(newConstraint)">Empty verb</span>
                                                </td>
                                                <td class="col-md-2">
                                                    <select class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintPattern(newConstraint)}" ng-model="newConstraint.contraintType" ng-options="contraintType for contraintType in config.constraintTypes | orderBy:'toString()'" />
                                                    <span style="color:red;" ng-show="isEmptyConstraintPattern(newConstraint)">Empty contraint pattern</span>
                                                </td>
                                                <td class="col-md-2">
                                                    <span ng-show="newConstraint.contraintType == 'a literal value' || 
                                       newConstraint.contraintType == 'equal to' ||
                                       newConstraint.contraintType == 'not-equal to' ||
                                       newConstraint.contraintType == 'greater than' ||
                                       newConstraint.contraintType == 'equal to or greater than' ||
                                       newConstraint.contraintType == 'less than' ||
                                       newConstraint.contraintType == 'equal to or less than'">
                            <input class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintValue(newConstraint)}" ng-model="newConstraint.value" type="text"/>
                            <span style="color:red;" ng-show="isEmptyConstraintValue(newConstraint)">Empty value</span>
                                                    </span>
                                                    <span ng-show="newConstraint.contraintType == 'one of list values'">
                            <input class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintValue(newConstraint)}" ng-model="newConstraint.value" placeholder="Comma-Separated Values(CSV)" type="text"/>
                            <span style="color:red;" ng-show="isEmptyConstraintValue(newConstraint)">Empty list value</span>
                                                    </span>
                                                    <span ng-show="newConstraint.contraintType == 'formatted value'">
                            <select class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintValue(newConstraint)}" 
                                ng-model="newConstraint.value" ng-options="predefinedFormat for predefinedFormat in config.predefinedFormats | orderBy:'toString()'" />
                            <div ng-show="newConstraint.value === 'Regular expression'">
                                <input class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintValue2(newConstraint)}" ng-model="newConstraint.value2" placeholder="Regular expression" type="text"/>
                            </div>
                            <span style="color:red;" ng-show="isEmptyConstraintValue(newConstraint)">Empty format</span>
                                                    <span style="color:red;" ng-show="isEmptyConstraintValue2(newConstraint)">Empty regular expression</span>
                                                    </span>
                                                    <span ng-show="newConstraint.contraintType == 'identical to another node' ||
                                       newConstraint.contraintType == 'equal to another node' ||
                                       newConstraint.contraintType == 'not-equal to another node' ||
                                       newConstraint.contraintType == 'greater than another node' ||
                                       newConstraint.contraintType == 'equal to or greater than another node' ||
                                       newConstraint.contraintType == 'less than another node' ||
                                       newConstraint.contraintType == 'equal to or less than another node'">
                            <span>{{newConstraint.segment}}-</span>
                                                    <select class="form-control form-control-short" ng-class="{'form-control-invalid': isEmptyConstraintAnotherNode(newConstraint, 'segment')}" ng-change="updateField_2()" ng-model="newConstraint.field_2" ng-options="field as field.position for field in segment.fields">
                                                    </select>
                                                    <span ng-show="datatypesMap[newConstraint.field_2.datatype].components.length > 0">.
                                <select class="form-control form-control-short"
                                        ng-change="updateComponent_2()"
                                        ng-model="newConstraint.component_2"
                                        ng-options="component as component.position for component in datatypesMap[newConstraint.field_2.datatype].components">
                                </select>
                            </span>
                                                    <span ng-show="datatypesMap[newConstraint.component_2.datatype].components.length > 0">.
                                <select class="form-control form-control-short"
                                        ng-model="newConstraint.subComponent_2"
                                        ng-options="subComponent as subComponent.position for subComponent in datatypesMap[newConstraint.component_2.datatype].components">
                                </select>
                            </span>
                                                    <span style="color:red;" ng-show="isEmptyConstraintAnotherNode(newConstraint, 'segment')">Empty another node</span>
                                                    </span>
                                                    <span ng-show="newConstraint.contraintType == 'one of codes in ValueSet'">
                            <span>ValueSet ID: </span>
                                                    <select class="form-control form-control-short" ng-class="{'form-control-invalid': isEmptyConstraintValueSet(newConstraint)}" ng-model="newConstraint.valueSetId">
                                                        <option ng-repeat="table in tables|orderBy:'+bindingIdentifier'" value="{{table.bindingIdentifier}}">
                                                            {{table.bindingIdentifier}}
                                                        </option>
                                                    </select>
                                                    <span style="color:red;" ng-show="isEmptyConstraintValueSet(newConstraint)">Empty valueset</span>
                                                    <br/>
                                                    <span>BindingStrength: </span>
                                                    <select name="bindingStrength" class="form-control form-control-short" ng-model="newConstraint.bindingStrength">
                                                        <option value="R">R</option>
                                                        <option value="S">S</option>
                                                        <option value="U">U</option>
                                                    </select>
                                                    <br/>
                                                    <span>BindingLocation: </span>
                                                    <input class="form-control form-control-short" ng-model="newConstraint.bindingLocation" type="text" />
                                                    </span>
                                                </td>
                                                <td class="col-md-1" align="center">
                                                    <button class="btn btn-primary btn-xxs" ng-click="addConformanceStatement();" ng-disabled="erorrForConfStatement(newConstraint, targetPlainId, 'segment')"><span><i class="fa fa-plus fa-fw">&nbsp; </i>Add</span></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class="table table-striped table-bordered" ng-show="constraintType === 'Complex'">
                                        <thead>
                                            <tr class="tbl-header">
                                                <th class="col-md-1" style="width: 4.1667%"></th>
                                                <th class="col-md-2">ID</th>
                                                <th class="col-md-2">Complex Type</th>
                                                <th class="col-md-1" style="width: 4.1667%"></th>
                                                <th class="col-md-2">First Constraint</th>
                                                <th class="col-md-1" style="width: 4.1667%"></th>
                                                <th class="col-md-2">Second Constraint</th>
                                                <th class="col-md-1"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="col-md-1" style="width: 4.1667%" align="center">
                                                    <button class="btn btn-info btn-xxs" ng-click="initComplexStatement()"><span><i class="fa fa-refresh fa-fw">&nbsp; </i>Reset</span></button>
                                                </td>
                                                <td class="col-md-2">
                                                    <input class="form-control form-control-short80" ng-class="{'form-control-invalid': isEmptyComplexConstraintID(newComplexConstraintId) || isDuplicatedComplexConstraintID(newComplexConstraintId, targetComplexId)}" ng-model="newComplexConstraintId" ng-change="targetComplexId = newComplexConstraintId;" type="text" ng-readonly="targetComplexId !== newComplexConstraintId" />
                                                    <i class="fa fa-pencil" ng-hide="targetComplexId == newComplexConstraintId" ng-click="targetComplexId = newComplexConstraintId;"></i>
                                                    <i class="fa fa-paper-plane" ng-hide="targetComplexId != newComplexConstraintId || conformanceStatementIdList.indexOf(newComplexConstraintId) != -1" ng-click="conformanceStatementIdList.push(newComplexConstraintId); targetComplexId = ''"></i>
                                                    <span style="color:red;" ng-show="isEmptyConstraintID(newConstraint)">ID Empty</span>
                                                    <span style="color:red;" ng-show="isDuplicatedConstraintID(newConstraint, targetPlainId)">ID Duplicated</span>
                                                </td>
                                                <td class="col-md-2">
                                                    <select class="form-control" ng-class="{'form-control-invalid': isEmptyCompositeType(compositeType)}" ng-model="compositeType">
                                                        <option value="AND">AND</option>
                                                        <option value="OR">OR</option>
                                                        <option value="IFTHEN">IFTHEN</option>
                                                    </select>
                                                    <span style="color:red;" ng-show="isEmptyCompositeType(compositeType)">Empty composite type</span>
                                                </td>
                                                <td class="col-md-1" align="center" style="width: 4.1667%">
                                                    <span ng-show="compositeType == 'IFTHEN'">IF</span>
                                                </td>
                                                <td class="col-md-2" data-drop="true" data-jqyoui-options ng-model="firstConstraint" jqyoui-droppable>
                                                    <span style="color:red;" ng-hide="firstConstraint">Drop the first constraint here!</span>
                                                    <span data-drag="false" data-jqyoui-options ng-model="firstConstraint" jqyoui-draggable ng-hide="!firstConstraint">{{firstConstraint.description}}</span>
                                                </td>
                                                <td class="col-md-1" align="center" style="width: 4.1667%">
                                                    <span ng-show="compositeType == 'AND'">AND</span>
                                                    <span ng-show="compositeType == 'OR'">OR</span>
                                                    <span ng-show="compositeType == 'IFTHEN'">THEN</span>
                                                </td>
                                                <td class="col-md-2" data-drop="true" data-jqyoui-options ng-model="secondConstraint" jqyoui-droppable>
                                                    <span style="color:red;" ng-hide="secondConstraint">Drop the second constraint here!</span>
                                                    <span data-drag="false" data-jqyoui-options ng-model="secondConstraint" jqyoui-draggable ng-hide="!secondConstraint">{{secondConstraint.description}}</span>
                                                </td>
                                                <td class="col-md-1" align="center">
                                                    <button class="btn btn-primary btn-xxs" ng-click="addComplexConformanceStatement()" ng-disabled="erorrForComplexConfStatement(newComplexConstraintId, targetComplexId, compositeType, firstConstraint, secondConstraint)"><span><i class="fa fa-plus fa-fw">&nbsp; </i>Add</span></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                    </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary btn-sm" ng-show="changed" ng-click="saveclose()"><span><i class="fa fa-plus fa-fw">
        &nbsp; </i>Save</span></button>
                    <button class="btn btn-warning btn-sm" ng-show="changed" ng-click="ok()"><span><i class="fa fa-times fa-fw">
        &nbsp; </i>Close</span></button>
                    <button class="btn btn-warning btn-sm" ng-hide="changed" ng-click="ok()"><span><i class="fa fa-times fa-fw">
        &nbsp; </i>Close</span></button>
                </div>
</script>
<script type="text/ng-template" id="PredicateSegmentCtrl.html">
    <div class="modal-header">
        <h3 ng-show="selectedNode === null" class="header4">Predicate for {{segment.name}}</h3>
        <h3 ng-show="selectedNode !== null" class="header4">Predicate for {{segment.name}}-{{selectedNode.position}}</h3>
    </div>
    <div class="modal-body">
        <form role="form">
            <span class="pull-right">
    <select class="form-control input-sm" ng-model="selectedNode" ng-options="field as (segment.name + '.' + field.position + ': ' + field.name) for field in segment.fields | filter:{usage : 'C'}">
        <option value="">Root of {{segment.name}}</option>
    </select>
</span>
            <div class="table-responsive">
                <div class="page-header">
                    <span class="header5">List of Predicates</span>
                </div>
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr class="tbl-header">
                            <th class="col-md-1" style="width: 4.1667%">Draggable</th>
                            <th class="col-md-8">Desciption (
                                <input type="checkbox" ng-model="viewAssertion"> view assertion )</th>
                            <th class="col-md-1">True Usage</th>
                            <th class="col-md-1">False Usage</th>
                            <th class="col-md-1"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="p in tempPredicates | filter:{constraintTarget:selectedNode == null ? '.' : selectedNode.position + '[1]'}:true">
                            <td class="col-md-1" align="center" style="width: 4.1667%">
                                <i class="fa fa-bullseye fa-lg" data-drag="true" data-jqyoui-options="{revert: 'invalid',helper:'clone'}" ng-model="p" jqyoui-draggable="{placeholder:'keep',animate:true}"></i>
                            </td>
                            <td class="col-md-8">
                                <input class="form-control" ng-model="p.description" ng-change="setChanged()" type="text" />
                                <span ng-show="viewAssertion">{{p.assertion}}</span>
                            </td>
                            <td class="col-md-1">
                                <select class="form-control" ng-model="p.trueUsage" ng-change="setChanged()" ng-options="usage for usage in config.usages" />
                            </td>
                            <td class="col-md-1">
                                <select class="form-control" ng-model="p.falseUsage" ng-change="setChanged()" ng-options="usage for usage in config.usages" />
                            </td>
                            <td class="col-md-1" align="center">
                                <button class="btn btn-danger btn-xxs" ng-click="deletePredicate(p)"><span><i class="fa fa-trash fa-fw">&nbsp; </i>Del</span></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <span class="pull-left">
        <span class="header5" ng-show="constraintType === 'Plain'">Add new plain predicate</span>
                <span class="header5" ng-show="constraintType === 'Complex'">Add new complex predicate</span>
                </span>
                <span class="pull-right">
        <div class="btn-group btn-group-sm" data-toggle="buttons">
            <label class="btn btn-primary btn-xs" ng-click="constraintType = 'Plain'" ng-class="{'active':constraintType === 'Plain'}">
                <input type="radio" ng-value="constraintType">Add plain predicate
            </label>
            <label class="btn btn-primary btn-xs" ng-click="constraintType = 'Complex'" ng-class="{'active':constraintType === 'Complex'}">
                <input type="radio" ng-value="constraintType">Add complex predicate
            </label>
        </div>
    </span>
                <table class="table table-striped table-bordered" ng-show="constraintType === 'Plain'">
                    <thead>
                        <tr class="tbl-header">
                            <th class="col-md-1" style="width: 4.1667%"></th>
                            <th class="col-md-2">Node</th>
                            <th class="col-md-2">Verb</th>
                            <th class="col-md-2">Constraint Pattern</th>
                            <th class="col-md-2">Value</th>
                            <th class="col-md-1">True Usage</th>
                            <th class="col-md-1">False Usage
                                <</th>
                                    <th class="col-md-1"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="col-md-1" align="center" style="width: 4.1667%">
                                <button class="btn btn-info btn-xxs" ng-click="initPredicate()"><span><i class="fa fa-refresh fa-fw">&nbsp; </i>Reset</span></button>
                            </td>
                            <td class="col-md-2">
                                <span>{{newConstraint.segment}}-</span>
                                <select class="form-control form-control-short" ng-class="{'form-control-invalid': isEmptyConstraintNode(newConstraint, 'segment')}" ng-change="updateField_1()" ng-model="newConstraint.field_1" placeholder="Field" ng-options="field as field.position for field in segment.fields" />
                                <span ng-show="datatypesMap[newConstraint.field_1.datatype].components.length > 0">.
                        <select class="form-control form-control-short"
                                    placeholder="Component"
                                    ng-change="updateComponent_1()"
                                    ng-model="newConstraint.component_1"
                                    ng-options="component as component.position for component in datatypesMap[newConstraint.field_1.datatype].components">
                        </select>
                    </span>
                                <span ng-show="datatypesMap[newConstraint.component_1.datatype].components.length > 0">.
                        <select class="form-control form-control-short"
                                    placeholder="SubComponent"
                                    ng-model="newConstraint.subComponent_1"
                                    ng-options="subComponent as subComponent.position for subComponent in datatypesMap[newConstraint.component_1.datatype].components">
                        </select>
                    </span>
                                <span style="color:red;" ng-show="isEmptyConstraintNode(newConstraint, 'segment')">Empty node</span>
                            </td>
                            <td class="col-md-2">
                                <select class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintVerb(newConstraint)}" ng-model="newConstraint.verb" ng-options="constraintVerb for constraintVerb in config.constraintVerbs | orderBy:'toString()'" />
                                <span style="color:red;" ng-show="isEmptyConstraintVerb(newConstraint)">Empty verb</span>
                            </td>
                            <td class="col-md-2">
                                <select class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintPattern(newConstraint)}" ng-model="newConstraint.contraintType" ng-options="contraintType for contraintType in config.constraintTypes | orderBy:'toString()'" />
                                <span style="color:red;" ng-show="isEmptyConstraintPattern(newConstraint)">Empty constraint pattern</span>
                            </td>
                            <td class="col-md-2">
                                <span ng-show="newConstraint.contraintType == 'a literal value' || 
                                   newConstraint.contraintType == 'equal to' ||
                                   newConstraint.contraintType == 'not-equal to' ||
                                   newConstraint.contraintType == 'greater than' ||
                                   newConstraint.contraintType == 'equal to or greater than' ||
                                   newConstraint.contraintType == 'less than' ||
                                   newConstraint.contraintType == 'equal to or less than'">
                        <input class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintValue(newConstraint)}" ng-model="newConstraint.value" type="text"/>
                        <span style="color:red;" ng-show="isEmptyConstraintValue(newConstraint)">Empty value</span>
                                </span>
                                <span ng-show="newConstraint.contraintType == 'one of list values'">
                        <input class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintValue(newConstraint)}" ng-model="newConstraint.value" placeholder="Comma-Separated Values(CSV)" type="text"/>
                        <span style="color:red;" ng-show="isEmptyConstraintValue(newConstraint)">Empty list of values</span>
                                </span>
                                <span ng-show="newConstraint.contraintType == 'formatted value'">
                        <select class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintValue(newConstraint)}" ng-model="newConstraint.value" ng-options="predefinedFormat for predefinedFormat in config.predefinedFormats | orderBy:'toString()'" />
                        <div ng-show="newConstraint.value === 'Regular expression'">
                            <input class="form-control" ng-class="{'form-control-invalid': isEmptyConstraintValue2(newConstraint)}" ng-model="newConstraint.value2" placeholder="Regular expression" type="text"/>
                        </div>
                        <span style="color:red;" ng-show="isEmptyConstraintValue(newConstraint)">Empty format</span>
                                <span style="color:red;" ng-show="isEmptyConstraintValue2(newConstraint)">Empty regular expression</span>
                                </span>
                                <span ng-show="newConstraint.contraintType == 'identical to another node' ||
                                   newConstraint.contraintType == 'equal to another node' ||
                                   newConstraint.contraintType == 'not-equal to another node' ||
                                   newConstraint.contraintType == 'greater than another node' ||
                                   newConstraint.contraintType == 'equal to or greater than another node' ||
                                   newConstraint.contraintType == 'less than another node' ||
                                   newConstraint.contraintType == 'equal to or less than another node'">
                        <span>{{newConstraint.segment}}-</span>
                                <select class="form-control form-control-short" ng-class="{'form-control-invalid': isEmptyConstraintAnotherNode(newConstraint, 'segment')}" ng-change="updateField_2()" ng-model="newConstraint.field_2" ng-options="field as field.position for field in segment.fields">
                                </select>
                                <span ng-show="datatypesMap[newConstraint.field_2.datatype].components.length > 0">.
                            <select class="form-control form-control-short"
                                        ng-change="updateComponent_2()"
                                        ng-model="newConstraint.component_2"
                                        ng-options="component as component.position for component in datatypesMap[newConstraint.field_2.datatype].components">
                            </select>
                        </span>
                                <span ng-show="datatypesMap[newConstraint.component_2.datatype].components.length > 0">.
                            <select class="form-control form-control-short"
                                        ng-model="newConstraint.subComponent_2"
                                        ng-options="subComponent as subComponent.position for subComponent in datatypesMap[newConstraint.component_2.datatype].components">
                            </select>
                        </span>
                                <span style="color:red;" ng-show="isEmptyConstraintAnotherNode(newConstraint, 'segment')">Empty another node</span>
                                </span>
                                <span ng-show="newConstraint.contraintType == 'one of codes in ValueSet'">
                        <span>ValueSet ID: </span>
                                <select class="form-control form-control-short" ng-class="{'form-control-invalid': isEmptyConstraintValueSet(newConstraint)}" ng-model="newConstraint.valueSetId">
                                    <option ng-repeat="table in tables|orderBy:'+bindingIdentifier'" value="{{table.bindingIdentifier}}">
                                        {{table.bindingIdentifier}}
                                    </option>
                                </select>
                                <span style="color:red;" ng-show="isEmptyConstraintValueSet(newConstraint)">Empty value set</span>
                                <br/>
                                <span>BindingStrength: </span>
                                <select name="bindingStrength" class="form-control form-control-short" ng-model="newConstraint.bindingStrength">
                                    <option value="R">R</option>
                                    <option value="S">S</option>
                                    <option value="U">U</option>
                                </select>
                                <br/>
                                <span>BindingLocation: </span>
                                <input class="form-control form-control-short" ng-model="newConstraint.bindingLocation" type="text" />
                                </span>
                            </td>
                            <td class="col-md-1">
                                <select class="form-control" ng-class="{'form-control-invalid': !newConstraint.trueUsage}" ng-model="newConstraint.trueUsage" ng-options="usage for usage in config.usages" />
                                <span style="color:red;" ng-show="!newConstraint.trueUsage">Empty true usage</span>
                            </td>
                            <td class="col-md-1">
                                <select class="form-control" ng-class="{'form-control-invalid': !newConstraint.falseUsage}" ng-model="newConstraint.falseUsage" ng-options="usage for usage in config.usages" />
                                <span style="color:red;" ng-show="!newConstraint.falseUsage">Empty false usage</span>
                            </td>
                            <td class="col-md-1" align="center">
                                <button class="btn btn-primary btn-xxs" ng-click="addPredicate();" ng-disabled="erorrForPredicate(newConstraint, 'segment')"><span><i class="fa fa-plus fa-fw">&nbsp; </i>Add</span></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table class="table table-striped table-bordered" ng-show="constraintType === 'Complex'">
                    <thead>
                        <tr class="tbl-header">
                            <th class="col-md-1" style="width: 4.1667%"></th>
                            <th class="col-md-2">Complex Type</th>
                            <th class="col-md-1" style="width: 4.1667%"></th>
                            <th class="col-md-2">First Constraint</th>
                            <th class="col-md-1" style="width: 4.1667%"></th>
                            <th class="col-md-2">Second Constraint</th>
                            <th class="col-md-1">True Usage</th>
                            <th class="col-md-1">False Usage
                                <</th>
                                    <th class="col-md-1"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="col-md-1" style="width: 4.1667%" align="center">
                                <button class="btn btn-info btn-xxs" ng-click="initComplexPredicate()"><span><i class="fa fa-refresh fa-fw">&nbsp; </i>Reset</span></button>
                            </td>
                            <td class="col-md-2">
                                <select class="form-control" ng-class="{'form-control-invalid': isEmptyCompositeType(compositeType)}" ng-model="compositeType">
                                    <option value="AND">AND</option>
                                    <option value="OR">OR</option>
                                    <option value="IFTHEN">IFTHEN</option>
                                </select>
                                <span style="color:red;" ng-show="isEmptyCompositeType(compositeType)">Empty composite type</span>
                            </td>
                            <td class="col-md-1" align="center" style="width: 4.1667%">
                                <span ng-show="compositeType == 'IFTHEN'">IF</span>
                            </td>
                            <td class="col-md-2" data-drop="true" data-jqyoui-options ng-model="firstConstraint" jqyoui-droppable>
                                <span style="color:red;" ng-hide="firstConstraint">Drop the first constraint here!</span>
                                <span data-drag="false" data-jqyoui-options ng-model="firstConstraint" jqyoui-draggable ng-hide="!firstConstraint">{{firstConstraint.description}}</span>
                            </td>
                            <td class="col-md-1" align="center" style="width: 4.1667%">
                                <span ng-show="compositeType == 'AND'">AND</span>
                                <span ng-show="compositeType == 'OR'">OR</span>
                                <span ng-show="compositeType == 'IFTHEN'">THEN</span>
                            </td>
                            <td class="col-md-2" data-drop="true" data-jqyoui-options ng-model="secondConstraint" jqyoui-droppable>
                                <span style="color:red;" ng-hide="secondConstraint">Drop the second constraint here!</span>
                                <span data-drag="false" data-jqyoui-options ng-model="secondConstraint" jqyoui-draggable ng-hide="!secondConstraint">{{secondConstraint.description}}</span>
                            </td>
                            <td class="col-md-1">
                                <select class="form-control" ng-class="{'form-control-invalid': !complexConstraintTrueUsage}" ng-model="complexConstraintTrueUsage" ng-options="usage for usage in config.usages" />
                                <span style="color:red;" ng-show="!complexConstraintTrueUsage">Empty true usage</span>
                            </td>
                            <td class="col-md-1">
                                <select class="form-control" ng-class="{'form-control-invalid': !complexConstraintFalseUsage}" ng-model="complexConstraintFalseUsage" ng-options="usage for usage in config.usages" />
                                <span style="color:red;" ng-show="!complexConstraintFalseUsage">Empty true usage</span>
                            </td>
                            <td class="col-md-1" align="center">
                                <button class="btn btn-primary btn-xxs" ng-click="addComplexPredicate()" ng-disabled="erorrForComplexPredicate(compositeType, firstConstraint, secondConstraint, complexConstraintTrueUsage, complexConstraintFalseUsage)"><span><i class="fa fa-plus fa-fw">&nbsp; </i>Add</span></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary btn-sm" ng-show="changed" ng-click="saveclose()"><span><i class="fa fa-check fa-fw">
        &nbsp; </i>Save</span></button>
        <button class="btn btn-warning btn-sm" ng-show="changed" ng-click="ok()"><span><i class="fa fa-times fa-fw">
        &nbsp; </i>Close</span></button>
        <button class="btn btn-warning btn-sm" ng-hide="changed" ng-click="ok()"><span><i class="fa fa-times fa-fw">
        &nbsp; </i>Close</span></button>
    </div>
</script>

<script type="text/ng-template" id="DynamicMappingCtrl.html">
    <div class="modal-header">
        <h3 class="modal-title">Edit Dynamic Mapping for {{segment.name}}-{{selectedNode.position}}</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <form role="form">

                <div class="col-md-4">
                    Reference:
                </div>

                <div class="col-md-8">
                    <select class="form-control" name="reference"
                            ng-change="recordChange()"
                            ng-model="selectedMapping.reference"
                            ng-options="field.position as segment.name + '-' + field.position + ' : ' + field.name for field in segment.fields"/>
                </div>

                <div ng-show="selectedMapping.reference" class="col-md-12">
                    <table class="table table-striped table-bordered">
                        <thead>
                            <tr class="tbl-header">
                                <th class="col-md-4">Reference Value</th>
                                <th class="col-md-7">Datatype</th>
                                <th class="col-md-1">
                                    <button title="Add" type="button" class="btn btn-xs btn-info" ng-click="addCase()">
                                        <i class="fa fa-plus fa-fw"></i>
                                    </button>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="case in selectedMapping.cases">
                                <td class="col-md-4">
                                    <input type="text" class="form-control" ng-model="case.value" ng-change="recordChange()"/>
                                </td>
                                <td class="col-md-7">
                                    <select ng-model="case.datatype" class="form-control" ng-change="recordChange()"
                                            ng-options="link.id as getDatatypeLabel(datatypesMap[link.id]) for link in igdocument.profile.datatypeLibrary.children | filter: {name: case.value}" />
                                </td>
                                <td class="col-md-1">
                                    <button title="Delete" type="button" class="btn btn-xs btn-danger" ng-click="deleteCase(case)">
                                        <i class="fa fa-trash-o fa-fw"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </form>
        </div>
    </div>

    <div class="modal-footer">
        <button ng-show="changed" type="button" ng-click="updateMapping()" class="btn btn-primary btn-sm"><i
                class="fa fa-check fa-fw">&nbsp; </i>Update
        </button>
        <button ng-show="changed" type="button" ng-click="ok()" class="btn btn-warning btn-sm"><i
                class="fa fa-times fa-fw">&nbsp; </i>Cancel
        </button>
        <button ng-show="!changed" class="btn btn-warning btn-sm" ng-click="ok()"><span><i class="fa fa-times fa-fw">
            &nbsp; </i>Cancel</span></button>
    </div>
</script>

<script type="text/ng-template" id="TableMappingSegmentCtrl.html">
    <div class="modal-header">
        <h3 class="modal-title">Bind Value Set to {{segment.name}}-{{selectedNode.position}}</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <form role="form">
                <div class="col-md-6">
                    <h5>List of Tables</h5>
                    <div class="igl-table">
                        <table class="table table-striped table-bordered table-condensed hl7-versions-valueset">
                            <thead>
                                <tr class="tbl-header">
                                    <th data-ng-click="predicate = 'bindingIdentifier'; reverse=!reverse">ID
                                        <i ng-show="reverse && predicate==='bindingIdentifier'" class="fa fa-sort-desc"></i>
                                        <i ng-show="!reverse && predicate==='bindingIdentifier'" class="fa fa-sort-asc"></i>
                                        <i ng-show="predicate!=='bindingIdentifier'" class="fa fa-sort"></i>
                                    </th>
                                    <th data-ng-click="predicate = 'name'; reverse=!reverse">Name
                                        <i ng-show="reverse && predicate==='name'" class="fa fa-sort-desc"></i>
                                        <i ng-show="!reverse && predicate==='name'" class="fa fa-sort-asc"></i>
                                        <i ng-show="predicate!=='name'" class="fa fa-sort"></i>
                                    </th>
                                </tr>
                                <tr>
                                    <th>
                                        <input type="text" class="form-control" placeholder="Search by id" ng-model="searchTableValue.bindingIdentifier" />
                                    </th>
                                    <th>
                                        <input type="text" class="form-control" placeholder="Search by name" ng-model="searchTableValue.name" />
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="table in tables|filter:searchTableValue|orderBy:predicate:reverse">
                                    <td>
                                        <a ng-click="selectTable(table)">{{table.bindingIdentifier}}</a>
                                    </td>
                                    <td ng-bind-html="table.name"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-md-6">
                    <h5>Selected Table for {{segment.name}}-{{selectedNode.position}}</h5>
                    <span ng-show="selectedTable != undefined">
                    <div class="row">
                        <div class="col-sm-2">
                            <p>ID:</p>

                            <p>Extensibility:</p>
                        </div>
                        <div class="col-sm-4">
                            <p>{{selectedTable.bindingIdentifier}}</p>

                            <p>{{selectedTable.extensibility}}</p>
                        </div>
                        <div class="col-sm-2">
                            <p>Name:</p>

                            <p>Stability:</p>
                        </div>
                        <div class="col-sm-4">
                            <p>{{selectedTable.name}}</p>

                            <p>{{selectedTable.stability}}</p>
                        </div>
                    </div>

                    <h5>List of Codes</h5>
                    
                    <div class="igl-table">
                        <table class="table table-striped table-bordered table-condensed hl7-versions-valueset">
                            <thead>
                            <tr class="tbl-header">
                                <th data-ng-click="predicate = 'value'; reverse=!reverse">Value
                                    <i ng-show="reverse && predicate==='value'" class="fa fa-sort-desc"></i>
                                    <i ng-show="!reverse && predicate==='value'" class="fa fa-sort-asc"></i>
                                    <i ng-show="predicate!=='value'" class="fa fa-sort"></i>
                                </th>
                                <th data-ng-click="predicate = 'label'; reverse=!reverse">Description
                                    <i ng-show="reverse && predicate==='label'" class="fa fa-sort-desc"></i>
                                    <i ng-show="!reverse && predicate==='label'" class="fa fa-sort-asc"></i>
                                    <i ng-show="predicate!=='label'" class="fa fa-sort"></i>
                                </th>
                                <th>Codesys</th>
                                <th>Usage</th>
                            </tr>
                            <tr>
                                <th>
                                    <input type="text" class="form-control" placeholder="Search by value"
                                           ng-model="searchCodeValue.value"/>
                                </th>
                                <th>
                                    <input type="text" class="form-control" placeholder="Search by description"
                                           ng-model="searchCodeValue.label"/>
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="c in selectedTable.codes|filter:searchCodeValue|orderBy:predicate:reverse">
                                <td ng-bind-html="c.value"></td>
                                <td ng-bind-html="c.label"></td>
                                <td ng-bind-html="c.codeSystem"></td>
                                <td ng-bind-html="c.codeUsage"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </span>
                </div>
            </form>
        </div>
    </div>
    <div class="modal-footer">
        <button ng-show="changed" type="button" ng-click="mappingTable()" class="btn btn-primary btn-sm"><i class="fa fa-check fa-fw">&nbsp; </i>Bind
        </button>
        <button ng-show="changed" type="button" ng-click="ok()" class="btn btn-warning btn-sm"><i class="fa fa-times fa-fw">&nbsp; </i>Cancel
        </button>
        <button ng-show="!changed" class="btn btn-warning btn-sm" ng-click="ok()"><span><i class="fa fa-times fa-fw">
            &nbsp; </i>Cancel</span></button>
    </div>
</script>
<script type="text/ng-template" id="ConfirmSegmentDeleteCtrl.html">
    <div class="modal-header">
        <h3 class="modal-title">Delete Confirmation</h3>
    </div>
    <div class="modal-body">
        <p>Are you sure you want to delete Segment {{getSegmentLabel(segToDelete)}} ? </p>
    </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-default btn-sm" ng-click="cancel()"><span><i class="fa fa-times fa-fw">&nbsp; </i>Cancel</span>
        </button>
        <button class="btn btn-danger btn-sm" ng-click="delete()"><span><i class="fa fa-trash-o fa-fw">&nbsp; </i>Delete</span>
        </button>
    </div>
</script>
<script type="text/ng-template" id="SegmentReferencesCtrl.html">
    <div class="modal-header">
        <h3 class="modal-title">Segment References Found
            <button class="btn btn-primary pull-right" ng-click="ok()"><span><i class="fa fa-times fa-fw">&nbsp; </i>Close</span>
            </button>
        </h3>
    </div>
    <div class="modal-body">
        <p>We cannot delete this segment because it is being referenced by the messages below:</p>
        <div class="igl-table">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr class="tbl-header">
                        <th>Name</th>
                        <th>Path</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="ref in references">
                        <td>
                            <span>

                                            <span ng-show="ref.type === 'group'"
                                                  class="label label-success label-icon">G</span>
                            <span ng-show="ref.type === 'segmentRef'" class="label label-segment label-icon">S</span>
                            <span style="width:60%" name="name" ng-bind="ref.name"></span>
                            <span ng-bind="ref.description"></span>
                            </span>
                        </td>
                        <td>
                            <div>{{ref.path}}</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</script>
<script type="text/ng-template" id="AddFieldModal.html">
    <div class="modal-header modal-wide">
        <div class="form-inline">
            <span class="header4 ">Add Field</span>
        </div>
    </div>
    <hr/>
    <div class="modal-body">
    <form name="addFieldForm">
        <div class="row" style="margin-bottom: 20px">
            <div class="form-group control-group">
                <label class="col-md-3 control-label col-md-offset-3">Name*</label>
                <input style="width:30% " class="form-control col-md-4 " ng-model="newField.name " required/>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px">
            <div class="form-group control-group">
                <label class="col-md-3 control-label col-md-offset-3">Position*</label>
                <div class="controls ">
                    <select ng-model="position " ng-change="selectPos() " style="width:30% " class="form-control input-sm " required>
                        <option  ng-repeat="field in segment.fields "> {{field.position}}
                         <option value="{{segment.fields.length+1}}">{{segment.fields.length+1}}
                    </select>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px">
            <div class="form-group control-group">
                <label class="col-md-3 control-label col-md-offset-3">Usage*</label>
                <div class="controls ">
                    <select style="width:30% " class="form-control input-sm " name="usage " ng-change="setDirty() " required ng-model="newField.usage " ng-options="usage for usage in config.usages " required />
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px">
            <div class="form-group control-group">
                <label class="col-md-3 control-label col-md-offset-3">Cardinality*</label>
                <div class="controls " ng-controller="SegmentRowCtrl ">
                    <span ng-form name="{{formName}} " class="form-inline ">
                                                <input  style="width:15% " class="form-control col-md-2 "
                                                    placeholder="Min"
                                                       name="min "
                                                       ng-change="setDirty() "
                                                       ng-pattern="/^\d+$/ "
                                                       ng-model="newField.min " required ng-minlength="1 ">
                                                <input  style="width:15% " class="form-control col-md-2 " type="text "
                                                    placeholder="Max"
                                                       name="max "
                                                       ng-change="setDirty() "
                                                       
                                                       ng-pattern="/^\d+$|^\*?$/ "
                                                       ng-model="newField.max " required>
                                            </span>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px">
            <div class="form-group control-group">
                <label class="col-md-3 control-label col-md-offset-3">Length*</label>
                <div class="controls " ng-controller="SegmentRowCtrl ">
                    <span ng-form name="{{formName}} " class="form-inline ">
                                                <input  style="width:15% " class="form-control col-md-2 "
                                                    placeholder="Min Length"
                                                       name="min "
                                                       ng-change="setDirty() "
                                                       ng-pattern="/^\d+$/ "
                                                       ng-model="newField.minLength " required ng-minlength="0 ">
                                                <input  style="width:15% " class="form-control col-md-2 " type="text "
                                                    placeholder="Max Length"
                                                       name="max "
                                                       ng-change="setDirty() "
                                                       
                                                       ng-pattern="/^\d+$|^\*?$/ "
                                                       ng-model="newField.maxLength " required>
                                            </span>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px">
            <div class="form-group control-group">
                <label class="col-md-3 control-label col-md-offset-3">Conf Length*</label>
                <input style="width:30% " class="form-control col-md-4 " name="confLength " ng-change="setDirty() " ng-pattern="/^\d+$/ " ng-model="newField.confLength " required ng-minlength="0 ">
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px">
            <div class="form-group control-group">
                <label class="col-md-3 control-label col-md-offset-3">Datatype</label>
                <div class="controls ">
                    <input style="width:30% " class="form-control col-md-4 " type="text" ng-model="searchDT.name" ng-hide="selectedDT()" />
                    <li style="width:30% " class="form-control col-md-4 col-md-offset-6" ng-show="selectedDT()">
                        {{DT.name}} <span ng-show="DT.ext">_{{DT.ext}}</span>
                        <button type="button" class="close" aria-label="Close" ng-click="unselectDT()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </li>
                </div>
                <div ng-if="searchDT.name  && !selectedDT()">
                    <li style="width:30% " class="form-control col-md-4 col-md-offset-6" ng-class="{'active':isDTActive(datatype.id)}" ng-click="selectDT(datatype)" ng-repeat="datatype in datatypes | filter:searchDT ">
                        {{datatype.name}} <span ng-show="datatype.ext">_{{datatype.ext}}</span>
                    </li>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px">
            <div class="form-group control-group">
                <label class="col-md-3 control-label col-md-offset-3">ValueSet</label>
                <div class="controls ">
                    <input style="width:30% " class="form-control col-md-4 " type="text" ng-model="searchVS.name" ng-hide="selectedVS()" />
                    <li style="width:30% " class="form-control col-md-4 col-md-offset-6" ng-show="selectedVS()">
                        {{VS.name}}
                        <button type="button" class="close" aria-label="Close" ng-click="unselectVS()">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </li>
                </div>
                <div ng-if="searchVS.name && !selectedVS()">
                    <li style="width:30% " class="form-control col-md-4 col-md-offset-6" ng-class="{'active':isDTActive(valueSet.id)}" ng-click="selectVS(valueSet)" ng-repeat="valueSet in valueSets | filter:searchVS ">
                        {{valueSet.name}}
                    </li>
                </div>
            </div>
        </div>
        <div class="row" style="margin-bottom: 20px">
            <div class="form-group control-group">
                <label class="col-md-3 control-label col-md-offset-3">Comment</label>
                <textarea style="width:30% " class="form-control col-md-4 " ng-model="newSegment.comment ">
                </textarea>
            </div>
        </div>
    </form>
        <hr/>
        <div class="modal-footer">
            <button class="btn btn-primary btn-sm" ng-click="addField()" ng-disabled="addFieldForm.$invalid"><span><i
                    class="fa fa-play fa-fw">
                &nbsp; </i>Add</span>
            </button>
            <button class="btn btn-warning btn-sm" ng-click="cancel()"><span><i class="fa fa-times fa-fw">
                &nbsp; </i>Cancel</span>
            </button>
        </div>
    </div>
</script>
<script type="text/ng-template" id="DeleteField.html">
    <div class="modal-header">
        <h3 class="modal-title">Delete Confirmation</h3>
    </div>
    <div class="modal-body">
        <p>Are you sure you want to delete Field: {{fieldToDelete.name}} ? </p>
    </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-default btn-sm" ng-click="cancel()"><span><i class="fa fa-times fa-fw">&nbsp; </i>Cancel</span>
        </button>
        <button class="btn btn-danger btn-sm" ng-click="delete()"><span><i class="fa fa-trash-o fa-fw">&nbsp; </i>Delete</span>
        </button>
    </div>
</script>
